(function(){this.TC={}}).call(this),function(){TC.AcademicTitles=function(){function t(){}return t.list=["Adjunct assistant professor","Adjunct associate","Adjunct professor","Assistant lecturer","Assistant professor emeritus","Assistant researcher","Assistant scientist","Associate dean","Associate lecturer","Associate professor","Associate professor emeritus","Associate research scientist","Chair professor","Chancellor","Chief executive officer","Clinical assistant professor","Clinical associate professor","Clinical professor","Course coordinator","Dean","Dean of faculties","Deputy Principal","Deputy chancellor","Deputy vice-chancellor","Emeritus professor","Emeritus reader","Faculty dean","Faculty deputy dean","Fellow","Head of department","Head of school","Instructor","Junior scientist","Lecturer","Postdoctoral associate","Postdoctoral fellow","Postdoctoral research associate","Postdoctoral research fellow","Principal","Pro-vice-chancellor","Professor","Professor emeritus","Professorial fellow","Program director","Provost","Reader","Rector","Registrar","Research assistant","Research assistant professor","Research associate","Research associate professor","Research fellow","Research officer","Research professor","Research scientist","Senior fellow","Senior lecturer","Senior research associate","Senior research fellow","Senior research scientist","Senior research technician","Senior scientist","Senior tutor","Tutor","Vice chancellor","Vice-principal","Visiting assistant professor","Visiting associate professor","Visiting professor","Visitor"],t}()}.call(this),function(){TC.analytics={track:function(t,e,n,i,r){return null==n&&(n=""),null==i&&(i=1),null==r&&(r=!0),_gaq.push(["_trackEvent",t,e,n,i,r])}},$(document.body).on("click","a",function(t){var e;return e=$(this).attr("href"),"#"===e&&(e=$(this).attr("id")),(null!=e?e.match(/^https?\:\/\/(?!theconversation)/):void 0)?TC.analytics.track("External link clicks",document.location.pathname,e,1):TC.analytics.track("Internal link clicks",document.location.pathname,e,1)})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};TC.Autocorrector=function(){function e(){this.processLine=t(this.processLine,this)}return e.prototype.rightSingleQuoteRegex=/^[^\s]'$/,e.prototype.rightDoubleQuoteRegex=/^[^\s]"$/,e.prototype.startsWithHtmlRegex=/^\s*</,e.prototype.processLine=function(t){var e,n,i;if(!this.startsWithHtmlRegex.test(t))return n=t.slice(-3),i=t.slice(-2),e=t.slice(-1),"--"===i?{replaceWith:"\u2013",replaceCount:2}:"..."===n?{replaceWith:"\u2026",replaceCount:3}:"'"===e&&this.rightSingleQuoteRegex.test(i)?{replaceWith:"\u2019",replaceCount:1}:"'"===e?{replaceWith:"\u2018",replaceCount:1}:'"'===e&&this.rightDoubleQuoteRegex.test(i)?{replaceWith:"\u201d",replaceCount:1}:'"'===e?{replaceWith:"\u201c",replaceCount:1}:void 0},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};TC.AwesomeFileUploader=function(){function e(e){this._isCorrectFileSize=t(this._isCorrectFileSize,this),this._isCorrectFileType=t(this._isCorrectFileType,this),this._onFileProcessed=t(this._onFileProcessed,this),this._onUploadFailure=t(this._onUploadFailure,this),this._onUploadSuccess=t(this._onUploadSuccess,this),this._onDropZoneHover=t(this._onDropZoneHover,this),this._ajaxXhr=t(this._ajaxXhr,this),this._uploadNextFile=t(this._uploadNextFile,this),this._queueFile=t(this._queueFile,this),this._prepareFiles=t(this._prepareFiles,this),this.container=e.container,this.tokenUrl=e.tokenUrl,this.createUrl=e.createUrl,this.inputEl=e.inputEl,this.dropEl=e.dropEl,this.maxSize=e.maxSize||0,this.expireAfter=e.expireAfter||0,this.allowedTypes=e.allowedTypes||[],this.queue=[],this.invalidFiles=[],this._initDropZone(),this._initInput(),this._initCallbacks()}return e.prototype._initDropZone=function(){return this.dropEl?(this.dropEl.on("dragenter dragover dragleave mouseenter mouseleave",this._onDropZoneHover),this.dropEl.on("click",function(t){return function(){return t.inputEl.click()}}(this)),this.dropEl.on("drop",this._prepareFiles)):void 0},e.prototype._initInput=function(){return this.inputEl.on("change",this._prepareFiles)},e.prototype._initCallbacks=function(){return this.container.on("uploader.upload_success",this._onUploadSuccess),this.container.on("uploader.upload_failure",this._onUploadFailure),this.container.on("uploader.file_processed",this._onFileProcessed)},e.prototype._prepareFiles=function(t){var e,n,i,r;if(t.stopPropagation(),t.preventDefault(),"change"===t.type?n=t.target.files:"drop"===t.type&&(n=t.dataTransfer?t.dataTransfer.files:t.originalEvent.dataTransfer.files),n.length>0){for(i=0,r=n.length;r>i;i++)e=n[i],this._queueFile(e);return this.container.trigger("uploader.uploads_queued",[this.queue,this.invalidFiles]),this._uploadNextFile()}},e.prototype._queueFile=function(t){var e,n;return e=this._getFilename(t),n=this._getFilesize(t),this._isCorrectFileSize(n)?this._isCorrectFileType(t)?this.queue.push(t):this.invalidFiles.push([t,"File '"+e+"' is of type '"+t.type+"', which cannot be used."]):this.invalidFiles.push([t,"File '"+e+"' is too big ("+this._humanBytes(n)+"). Maximum is "+this._humanBytes(this.maxSize)+"."])},e.prototype._uploadNextFile=function(){return this.queue.length>0?(this.container.trigger("uploader.next_upload"),this._prepareUpload(this.queue.shift())):this.container.trigger("uploader.queue_empty")},e.prototype._prepareUpload=function(t){return $.ajax(this.tokenUrl,{type:"GET"}).done(function(e){return function(n){return e._upload(t,n)}}(this))},e.prototype._upload=function(t,e){var n;return n=this.expireAfter>0?{"X-Delete-After":this.expireAfter}:{},$.ajax(e.url,{type:"PUT",data:t,headers:n,processData:!1,xhr:this._ajaxXhr}).done(function(n){return function(i){return n.container.trigger("uploader.upload_success",[t,e.temporary_filename])}}(this)).fail(function(e){return function(n){return e.container.trigger("uploader.upload_failure",[t])}}(this))},e.prototype._ajaxXhr=function(){var t;return t=$.ajaxSettings.xhr(),t.upload&&t.upload.addEventListener("progress",function(t){return function(e){var n;return e.lengthComputable?(n=Math.floor(e.loaded/e.total*100),t.container.trigger("uploader.upload_progress",[n])):void 0}}(this)),t},e.prototype._notifyApp=function(t,e){var n;return n=this._getFilename(t),$.ajax(this.createUrl,{type:"POST",data:{temporary_filename:e,real_filename:n,additional:this.additionalData||{}}}).done(function(e){return function(n){return e.container.trigger("uploader.notification_sent",[t,n])}}(this))},e.prototype._onDropZoneHover=function(t){return t.stopPropagation(),t.preventDefault(),"dragover"===t.type||"mouseenter"===t.type?this.dropEl.addClass("hover"):this.dropEl.removeClass("hover")},e.prototype._onUploadSuccess=function(t,e,n){return this._notifyApp(e,n)},e.prototype._onUploadFailure=function(t,e){return this._uploadNextFile()},e.prototype._onFileProcessed=function(t,e,n){return this._uploadNextFile()},e.prototype._isCorrectFileType=function(t){return 0===this.allowedTypes.length||this.allowedTypes.length>0&&$.inArray(t.type,this.allowedTypes)>-1?!0:!1},e.prototype._isCorrectFileSize=function(t){return 0===this.maxSize||t<=this.maxSize?!0:!1},e.prototype._getFilename=function(t){return t.fileName?t.fileName:t.name},e.prototype._getFilesize=function(t){return t.fileSize?t.fileSize:t.size},e.prototype._humanBytes=function(t){var e,n;return n=["bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],0===t?"0":(e=parseInt(Math.floor(Math.log(t)/Math.log(1024))),(0===e?t/Math.pow(1024,e):(t/Math.pow(1024,e)).toFixed(1))+" "+n[e])},e}()}.call(this),function(){TC.CampaignContentSearcher=function(){function t(t){this.defaultsUrl="/editorial/beta/campaigns/"+t+"/suggested_content",this.searchUrl="/editorial/beta/campaigns/content_search"}return t.prototype.fetch=function(t){return null==t&&(t={}),$.ajax({url:this.defaultsUrl,dataType:"html",error:function(){return t.error(i18n.t("draft.message.could_not_load_scheduled_content"))},success:function(e){return t.success(e)}})},t.prototype.search=function(t){return null==t&&(t={}),$.ajax({url:this.searchUrl,dataType:"html",data:t.data,error:function(){return t.error(i18n.t("draft.message.search_error"))},success:function(e){return t.success(e)}})},t}()}.call(this),function(){function g(t){throw t}function aa(){return function(){}}function p(t){return function(e){this[t]=e}}function ba(t){return function(){return this[t]}}function ca(t){return function(){return t}}function ea(t){for(var e,t=t.split("."),n=r;e=t.shift();){if(n[e]==k)return k;n=n[e]}return n}function fa(){}function ga(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&"undefined"!=typeof t.splice&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||"undefined"!=typeof t.call&&"undefined"!=typeof t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&"undefined"==typeof t.call)return"object";return e}function s(t){return"array"==ga(t)}function ha(t){var e=ga(t);return"array"==e||"object"==e&&"number"==typeof t.length}function t(t){return"string"==typeof t}function ia(t){return t[ja]||(t[ja]=++ka)}function la(t,e,n){return t.call.apply(t.bind,arguments)}function ma(t,e,n){if(t||g(Error()),arguments.length>2){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function u(t,e,n){return u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?la:ma,u.apply(k,arguments)}function w(t,e){function n(){}n.prototype=e.prototype,t.za=e.prototype,t.prototype=new n}function na(t){this.stack=Error().stack||"",t&&(this.message=String(t))}function oa(t,e){for(var n=1;n<arguments.length;n++)var i=String(arguments[n]).replace(/\$/g,"$$$$"),t=t.replace(/\%s/,i);return t}function qa(t){return t=String(t),pa.test(t)?t:encodeURIComponent(t)}function ra(t){return sa.test(t)?(-1!=t.indexOf("&")&&(t=t.replace(ta,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(ua,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(va,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(xa,"&quot;")),t):t}function ya(t,e){return e>t?-1:t>e?1:0}function za(t,e){e.unshift(t),na.call(this,oa.apply(k,e)),e.shift(),this.rc=t}function Aa(t,e){g(new za("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1)))}function Ca(t){var e,n=z;for(e in n)t.call(h,n[e],e,n)}function Da(t){var e,n=[],i=0;for(e in t)n[i++]=t[e];return n}function Ea(t){var e,n=[],i=0;for(e in t)n[i++]=e;return n}function Ga(t,e){for(var n,i,r=1;r<arguments.length;r++){i=arguments[r];for(n in i)t[n]=i[n];for(var o=0;o<Fa.length;o++)n=Fa[o],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function Ja(t){return A.concat.apply(A,arguments)}function Ka(t){if(s(t))return Ja(t);for(var e=[],n=0,i=t.length;i>n;n++)e[n]=t[n];return e}function La(t,e){for(var n=1;n<arguments.length;n++){var i,r=arguments[n];if(s(r)||(i=ha(r))&&r.hasOwnProperty("callee"))t.push.apply(t,r);else if(i)for(var o=t.length,a=r.length,l=0;a>l;l++)t[o+l]=r[l];else t.push(r)}}function Ma(e){if("function"==typeof e.$)return e.$();if(t(e))return e.split("");if(ha(e)){for(var n=[],i=e.length,r=0;i>r;r++)n.push(e[r]);return n}return Da(e)}function B(e,n,i){if("function"==typeof e.forEach)e.forEach(n,i);else if(ha(e)||t(e))Ia(e,n,i);else{var r;if("function"==typeof e.ga)r=e.ga();else if("function"!=typeof e.$)if(ha(e)||t(e)){r=[];for(var o=e.length,s=0;o>s;s++)r.push(s)}else r=Ea(e);else r=h;for(var o=Ma(e),s=o.length,a=0;s>a;a++)n.call(i,o[a],r&&r[a],e)}}function Na(t,e){this.O={},this.j=[];var n=arguments.length;if(n>1){n%2&&g(Error("Uneven number of arguments"));for(var i=0;n>i;i+=2)this.set(arguments[i],arguments[i+1])}else if(t){t instanceof Na?(n=t.ga(),i=t.$()):(n=Ea(t),i=Da(t));for(var r=0;r<n.length;r++)this.set(n[r],i[r])}}function Oa(t){if(t.c!=t.j.length){for(var e=0,n=0;e<t.j.length;){var i=t.j[e];C(t.O,i)&&(t.j[n++]=i),e++}t.j.length=n}if(t.c!=t.j.length){for(var r={},n=e=0;e<t.j.length;)i=t.j[e],C(r,i)||(t.j[n++]=i,r[i]=1),e++;t.j.length=n}}function C(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function D(t,e){var n;t instanceof D?(this.la(e==k?t.H:e),Pa(this,t.V),Qa(this,t.Da),Ra(this,t.L),Sa(this,t.ba),Ta(this,t.r),Ua(this,t.D.l()),Va(this,t.ra)):t&&(n=String(t).match(Ba))?(this.la(!!e),Pa(this,n[1]||"",j),Qa(this,n[2]||"",j),Ra(this,n[3]||"",j),Sa(this,n[4]),Ta(this,n[5]||"",j),Ua(this,n[6]||"",j),Va(this,n[7]||"",j)):(this.la(!!e),this.D=new Wa(k,this,this.H))}function Pa(t,e,n){E(t),delete t.w,t.V=n?e?decodeURIComponent(e):"":e,t.V&&(t.V=t.V.replace(/:$/,""))}function Qa(t,e,n){E(t),delete t.w,t.Da=n?e?decodeURIComponent(e):"":e}function Ra(t,e,n){E(t),delete t.w,t.L=n?e?decodeURIComponent(e):"":e}function Sa(t,e){E(t),delete t.w,e?(e=Number(e),(isNaN(e)||0>e)&&g(Error("Bad port number "+e)),t.ba=e):t.ba=k}function Ta(t,e,n){E(t),delete t.w,t.r=n?e?decodeURIComponent(e):"":e}function Ua(t,e,n){E(t),delete t.w,e instanceof Wa?(t.D=e,t.D.kb=t,t.D.la(t.H)):(n||(e=Xa(e,cb)),t.D=new Wa(e,t,t.H))}function G(t,e,n){E(t),delete t.w,t.D.set(e,n)}function db(t,e,n){if(E(t),delete t.w,s(n)||(n=[String(n)]),t=t.D,H(t),eb(t),e=I(t,e),t.K(e)){var i=t.g.get(e);s(i)?t.c-=i.length:t.c--}n.length>0&&(t.g.set(e,n),t.c+=n.length)}function Va(t,e,n){E(t),delete t.w,t.ra=n?e?decodeURIComponent(e):"":e}function J(t){return E(t),G(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^v()).toString(36)),t}function E(t){t.$b&&g(Error("Tried to modify a read-only Uri"))}function bb(t,e,n,i,r,o,s,a){return a=new D(k,a),t&&Pa(a,t),e&&Qa(a,e),n&&Ra(a,n),i&&Sa(a,i),r&&Ta(a,r),o&&Ua(a,o),s&&Va(a,s),a}function Xa(e,n){var i=k;return t(e)&&(i=e,fb.test(i)||(i=encodeURI(e)),i.search(n)>=0&&(i=i.replace(n,gb))),i}function gb(t){return t=t.charCodeAt(0),"%"+(t>>4&15).toString(16)+(15&t).toString(16)}function Wa(t,e,n){this.M=t||k,this.kb=e||k,this.H=!!n}function H(t){if(!t.g&&(t.g=new Na,t.c=0,t.M))for(var e=t.M.split("&"),n=0;n<e.length;n++){var i=e[n].indexOf("="),r=k,o=k;i>=0?(r=e[n].substring(0,i),o=e[n].substring(i+1)):r=e[n],r=decodeURIComponent(r.replace(/\+/g," ")),r=I(t,r),t.add(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}function eb(t){delete t.ab,delete t.M,t.kb&&delete t.kb.w}function I(t,e){var n=String(e);return t.H&&(n=n.toLowerCase()),n}function hb(){}function jb(){}function kb(t){return(t=lb(t))?new ActiveXObject(t):new XMLHttpRequest}function mb(t){var e={};return lb(t)&&(e[0]=j,e[1]=j),e}function lb(t){if(!t.eb&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var i=e[n];try{return new ActiveXObject(i),t.eb=i}catch(r){}}g(Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed"))}return t.eb}function qb(){return r.navigator?r.navigator.userAgent:k}function N(t){var e;if(!(e=Eb[t])){e=0;for(var n=String(xb).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),i=String(t).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),r=Math.max(n.length,i.length),o=0;0==e&&r>o;o++){var s=n[o]||"",a=i[o]||"",l=RegExp("(\\d*)(\\D*)","g"),c=RegExp("(\\d*)(\\D*)","g");do{var u=l.exec(s)||["","",""],h=c.exec(a)||["","",""];if(0==u[0].length&&0==h[0].length)break;e=ya(0==u[1].length?0:parseInt(u[1],10),0==h[1].length?0:parseInt(h[1],10))||ya(0==u[2].length,0==h[2].length)||ya(u[2],h[2])}while(0==e)}e=Eb[t]=e>=0}return e}function Gb(){return Fb[9]||(Fb[9]=L&&document.documentMode&&document.documentMode>=9)}function Hb(){}function O(){}function Kb(t){for(var e=0,n=arguments.length;n>e;++e){var i=arguments[e];ha(i)?Kb.apply(k,i):i&&"function"==typeof i.Ga&&i.Ga()}}function P(t,e){this.type=t,this.currentTarget=this.target=e}function Lb(t){return Lb[" "](t),t}function Mb(t,e){t&&this.La(t,e)}function Ob(t,e,n,i,o){if(e){if(s(e)){for(var a=0;a<e.length;a++)Ob(t,e[a],n,i,o);return k}var i=!!i,l=R;e in l||(l[e]={c:0,A:0}),l=l[e],i in l||(l[i]={c:0,A:0},l.c++);var c,l=l[i],u=ia(t);if(l.A++,l[u]){for(c=l[u],a=0;a<c.length;a++)if(l=c[a],l.wa==n&&l.cb==o){if(l.ja)break;return c[a].key}}else c=l[u]=[],l.c++;return a=Pb(),a.src=t,l=new Hb,l.La(n,a,t,e,i,o),n=l.key,a.key=n,c.push(l),Q[n]=l,z[u]||(z[u]=[]),z[u].push(l),t.addEventListener?(t==r||!t.rb)&&t.addEventListener(e,a,i):t.attachEvent(e in Nb?Nb[e]:Nb[e]="on"+e,a),n}g(Error("Invalid event type"))}function Pb(){var t=Qb,e=Jb?function(n){return t.call(e.src,e.key,n)}:function(n){return n=t.call(e.src,e.key,n),n?void 0:n};return e}function Rb(t,e,n,i,r){if(s(e))for(var o=0;o<e.length;o++)Rb(t,e[o],n,i,r);else if(i=!!i,o=R,t=e in o&&(o=o[e],i in o&&(o=o[i],t=ia(t),o[t]))?o[t]:k,t)for(o=0;o<t.length;o++)if(t[o].wa==n&&t[o].capture==i&&t[o].cb==r){Sb(t[o].key);break}}function Sb(t){if(!Q[t])return o;var e=Q[t];if(e.ja)return o;var n=e.src,i=e.type,s=e.Lb,a=e.capture;if(n.removeEventListener?(n==r||!n.rb)&&n.removeEventListener(i,s,a):n.detachEvent&&n.detachEvent(i in Nb?Nb[i]:Nb[i]="on"+i,s),n=ia(n),s=R[i][a][n],z[n]){var l=z[n],c=Ha(l,e);c>=0&&A.splice.call(l,c,1),0==l.length&&delete z[n]}return e.ja=j,s.Fb=j,Tb(i,a,n,s),delete Q[t],j}function Tb(t,e,n,i){if(!i.Ma&&i.Fb){for(var r=0,s=0;r<i.length;r++)i[r].ja?i[r].Lb.src=k:(r!=s&&(i[s]=i[r]),s++);i.length=s,i.Fb=o,0==s&&(delete R[t][e][n],R[t][e].c--,0==R[t][e].c&&(delete R[t][e],R[t].c--),0==R[t].c&&delete R[t])}}function Ub(t){var e,n=0,i=e==k;if(e=!!e,t==k)Ca(function(t){for(var r=t.length-1;r>=0;r--){var o=t[r];(i||e==o.capture)&&(Sb(o.key),n++)}});else if(t=ia(t),z[t])for(var t=z[t],r=t.length-1;r>=0;r--){var o=t[r];(i||e==o.capture)&&(Sb(o.key),n++)}}function Vb(t,e,n,i,r){var s=1,e=ia(e);if(t[e]){t.A--,t=t[e],t.Ma?t.Ma++:t.Ma=1;try{for(var a=t.length,l=0;a>l;l++){var c=t[l];c&&!c.ja&&(s&=Wb(c,r)!==o)}}finally{t.Ma--,Tb(n,i,e,t)}}return Boolean(s)}function Wb(t,e){var n=t.handleEvent(e);return t.pb&&Sb(t.key),n}function Qb(t,e){if(!Q[t])return j;var n=Q[t],i=n.type,r=R;if(!(i in r))return j;var s,a,r=r[i];if(!Jb){s=e||ea("window.event");var l=j in r,c=o in r;if(l){if(s.keyCode<0||s.returnValue!=h)return j;t:{var u=o;if(0==s.keyCode)try{s.keyCode=-1;break t}catch(p){u=j}(u||s.returnValue==h)&&(s.returnValue=j)}}u=new Mb,u.La(s,this),s=j;try{if(l){for(var d=[],f=u.currentTarget;f;f=f.parentNode)d.push(f);a=r[j],a.A=a.c;for(var m=d.length-1;!u.ia&&m>=0&&a.A;m--)u.currentTarget=d[m],s&=Vb(a,d[m],i,j,u);if(c)for(a=r[o],a.A=a.c,m=0;!u.ia&&m<d.length&&a.A;m++)u.currentTarget=d[m],s&=Vb(a,d[m],i,o,u)}else s=Wb(n,u)}finally{d&&(d.length=0),u.Ga()}return s}i=new Mb(e,this);try{s=Wb(n,i)}finally{i.Ga()}return s}function Xb(){}function Yb(t,e){this.sa=t||1,this.Ba=e||Zb,this.Xa=u(this.nc,this),this.ib=v()}function ac(t){this.e=t,this.j=[]}function S(t,e,n,i,r){this.h=t,this.a=e,this.X=n,this.B=i,this.ya=r||1,this.Aa=cc,this.ub=new ac(this),this.Oa=new Yb,this.Oa.setInterval(dc)}function ec(t,e){switch(t){case 0:return"Non-200 return code ("+e+")";case 1:return"XMLHTTP failure (no data)";case 2:return"HttpConnection timeout";default:return"Unknown error"}}function hc(t,e,n){t.Ca=1,t.S=J(e.l()),t.U=n,t.sb=j,ic(t,k)}function jc(t,e,n,i,r){t.Ca=1,t.S=J(e.l()),t.U=k,t.sb=n,r&&(t.Ob=o),ic(t,i)}function ic(t,e){t.ka=v(),kc(t),t.u=t.S.l(),db(t.u,"t",t.ya),t.Ea=0,t.p=t.h.$a(t.h.Sa()?e:k),Ob(t.p,"readystatechange",t.Sb,o,t);var n;if(t.t){n=t.t;var i,r={};for(i in n)r[i]=n[i];n=r}else n={};if(t.U?(t.ma="POST",n["Content-Type"]="application/x-www-form-urlencoded",t.p.send(t.u,t.ma,t.U,n)):(t.ma="GET",t.Ob&&!M&&(n.Connection="close"),t.p.send(t.u,t.ma,k,n)),r=t.U)for(n="",r=r.split("&"),i=0;i<r.length;i++){var s=r[i].split("=");if(s.length>1){var a=s[0],s=s[1],l=a.split("_");n+=l.length>=2&&"type"==l[1]?a+"="+s+"&":a+"=redacted&"}}else n=k;t.a.info("XMLHTTP REQ ("+t.B+") [attempt "+t.ya+"]: "+t.ma+"\n"+t.u+"\n"+n)}function pc(t,e,n){for(var i=j;!t.ea&&t.Ea<n.length;){var r=wc(t,n);if(r==gc){4==e&&(t.q=4,U(xc),i=o),qc(t.a,t.B,k,"[Incomplete Response]");break}if(r==fc){t.q=4,U(yc),qc(t.a,t.B,n,"[Invalid Chunk]"),i=o;break}qc(t.a,t.B,r,k),rc(t,r)}4==e&&0==n.length&&(t.q=1,U(zc),i=o),t.F=t.F&&i,i||(qc(t.a,t.B,n,"[Invalid Chunked Response]"),oc(t),uc(t))}function wc(t,e){var n=t.Ea,i=e.indexOf("\n",n);if(-1==i)return gc;if(n=Number(e.substring(n,i)),isNaN(n))return fc;if(i+=1,i+n>e.length)return gc;var r=e.substr(i,n);return t.Ea=i+n,r}function Ac(t,e){t.ka=v(),kc(t),t.G=new ActiveXObject("htmlfile");var n="",i="<html><body>";e&&(n=window.location.hostname,i+='<script>document.domain="'+n+'"</script>'),i+="</body></html>",t.G.open(),t.G.write(i),t.G.close(),t.G.parentWindow.m=u(t.hc,t),t.G.parentWindow.d=u(t.Kb,t,j),t.G.parentWindow.rpcClose=u(t.Kb,t,o),i=t.G.createElement("div"),t.G.parentWindow.document.body.appendChild(i),t.u=t.S.l(),G(t.u,"DOMAIN",n),G(t.u,"t",t.ya),i.innerHTML='<iframe src="'+t.u+'"></iframe>',t.a.info("TRIDENT REQ ("+t.B+") [ attempt "+t.ya+"]: GET\n"+t.u)}function kc(t){t.mb=v()+t.Aa,Cc(t,t.Aa)}function Cc(t,e){t.oa!=k&&g(Error("WatchDog timer not null")),t.oa=V(u(t.ic,t),e)}function mc(t){t.oa&&(r.clearTimeout(t.oa),t.oa=k)}function uc(t){!t.h.Ab()&&!t.ea&&t.h.ha(t)}function oc(t){t.Oa.stop();var e=t.ub;Ia(e.j,Sb),e.j.length=0,t.p&&(e=t.p,t.p=k,Rb(e,"readystatechange",t.Sb,o,t),e.abort()),t.G&&(t.G=k)}function rc(t,e){try{t.h.Hb(t,e)}catch(n){vc(t.a,n,"Error in httprequest callback")}}function Ec(a){return eval("("+a+")")}function Fc(){this.Qa=h}function Gc(t){var e=[];return Hc(new Fc,t,e),e.join("")}function Hc(t,e,n){switch(typeof e){case"string":Ic(e,n);break;case"number":n.push(isFinite(e)&&!isNaN(e)?e:"null");break;case"boolean":n.push(e);break;case"undefined":n.push("null");break;case"object":if(e==k){n.push("null");break}if(s(e)){var i=e.length;n.push("[");for(var r="",o=0;i>o;o++)n.push(r),r=e[o],Hc(t,t.Qa?t.Qa.call(e,String(o),r):r,n),r=",";n.push("]");break}n.push("{"),i="";for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&(r=e[o],"function"!=typeof r&&(n.push(i),Ic(o,n),n.push(":"),Hc(t,t.Qa?t.Qa.call(e,o,r):r,n),i=","));n.push("}");break;case"function":break;default:g(Error("Unknown type: "+typeof e))}}function Ic(t,e){e.push('"',t.replace(Kc,function(t){if(t in Jc)return Jc[t];var e=t.charCodeAt(0),n="\\u";return 16>e?n+="000":256>e?n+="00":4096>e&&(n+="0"),Jc[t]=n+e.toString(16)}),'"')}function Lc(t){return Mc(t||arguments.callee.caller,[])}function Mc(t,e){var n=[];if(Ha(e,t)>=0)n.push("[...circular reference...]");else if(t&&e.length<50){n.push(Nc(t)+"(");for(var i=t.arguments,r=0;r<i.length;r++){r>0&&n.push(", ");var o;switch(o=i[r],typeof o){case"object":o=o?"object":"null";break;case"string":break;case"number":o=String(o);break;case"boolean":o=o?"true":"false";break;case"function":o=(o=Nc(o))?o:"[fn]";break;default:o=typeof o}o.length>40&&(o=o.substr(0,40)+"..."),n.push(o)}e.push(t),n.push(")\n");try{n.push(Mc(t.caller,e))}catch(s){n.push("[exception trying to get caller]\n")}}else t?n.push("[...long stack...]"):n.push("[end]");return n.join("")}function Nc(t){if(Oc[t])return Oc[t];if(t=String(t),!Oc[t]){var e=/function ([^\(]+)/.exec(t);Oc[t]=e?e[1]:"[Anonymous]"}return Oc[t]}function Pc(t,e,n,i,r){this.reset(t,e,n,i,r)}function W(t){this.bc=t}function Rc(t,e){this.name=t,this.value=e}function Xc(t){return t.va?t.va:t.Na?Xc(t.Na):(Aa("Root logger has no level set."),k)}function X(t,e){t.log(Wc,e,h)}function $c(t){Zc||(Zc=new W(""),Yc[""]=Zc,Zc.Pb(Vc));var e;if(!(e=Yc[t])){e=new W(t);var n=t.lastIndexOf("."),i=t.substr(n+1),n=$c(t.substr(0,n));n.Ya||(n.Ya={}),n.Ya[i]=e,e.Na=n,Yc[t]=e}return e}function ad(){this.o=$c("goog.net.BrowserChannel")}function qc(t,e,n,i){t.info("XMLHTTP TEXT ("+e+"): "+Bc(t,n)+(i?" "+i:""))}function bd(t,e){t.info(e)}function vc(t,e,n){t.I((n||"Exception")+e)}function Bc(t,e){if(!e||e==cd)return e;try{for(var n=Ec(e),i=0;i<n.length;i++)if(s(n[i])){var r=n[i];if(!(r.length<2)){var o=r[1];if(s(o)&&!(o.length<1)){var a=o[0];if("noop"!=a&&"stop"!=a)for(var l=1;l<o.length;l++)o[l]=""}}}return Gc(n)}catch(c){return t.info("Exception parsing expected JS array - probably was not JS"),e}}function dd(t){this.headers=new Na,this.pa=t||k}function fd(t,e){t.R=o,t.f&&(t.aa=j,t.f.abort(),t.aa=o),t.q=e,t.ua=5,gd(t),hd(t)}function gd(t){t.bb||(t.bb=j,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function id(t){if(t.R&&"undefined"!=typeof da)if(t.Ua[1]&&4==T(t)&&2==nc(t))X(t.o,Y(t,"Local request error detected and ignored"));else if(t.Ka&&4==T(t))Zb.setTimeout(u(t.Gb,t),0);else if(t.dispatchEvent("readystatechange"),4==T(t)){X(t.o,Y(t,"Request complete")),t.R=o;var e,n=nc(t);t:switch(n){case 200:case 201:case 202:case 204:case 304:case 1223:e=j;break t;default:e=o}if(e||((n=0===n)&&(n=String(t.hb).match(Ba)[1]||k,!n&&self.location&&(n=self.location.protocol,n=n.substr(0,n.length-1)),n=!ed.test(n?n.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.ua=6;var i;try{i=T(t)>2?t.f.statusText:""}catch(r){X(t.o,"Can not get status: "+r.message),i=""}t.q=i+" ["+nc(t)+"]",gd(t)}hd(t)}}function hd(t,e){if(t.f){var n=t.f,i=t.Ua[0]?fa:k;t.f=k,t.Ua=k,t.ca&&(Zb.clearTimeout(t.ca),t.ca=k),e||t.dispatchEvent("ready");try{n.onreadystatechange=i}catch(r){t.o.I("Problem encountered resetting onreadystatechange: "+r.message)}}}function T(t){return t.f?t.f.readyState:0}function nc(t){try{return T(t)>2?t.f.status:-1}catch(e){return t.o.na("Can not get status: "+e.message),-1}}function lc(t){try{return t.f?t.f.responseText:""}catch(e){return X(t.o,"Can not get responseText: "+e.message),""}}function Y(t,e){return e+" ["+t.Cb+" "+t.hb+" "+nc(t)+"]"}function jd(){this.Mb=v()}function kd(t,e,n,i,s){if(bd(new ad,"TestLoadImageWithRetries: "+s),0==i)n(o);else{var a=s||0;i--,ld(t,e,function(o){o?n(j):r.setTimeout(function(){kd(t,e,n,i,a)},a)})}}function ld(t,e,n){var i=new ad;i.info("TestLoadImage: loading "+t);var s=new Image,a=k;createHandler=function(t,e){return function(){try{i.info("TestLoadImage: "+e),s.onload=k,s.onerror=k,s.onabort=k,s.ontimeout=k,r.clearTimeout(a),n(t)}catch(o){vc(i,o)}}},s.onload=createHandler(j,"loaded"),s.onerror=createHandler(o,"error"),s.onabort=createHandler(o,"abort"),s.ontimeout=createHandler(o,"timeout"),a=r.setTimeout(function(){s.ontimeout&&s.ontimeout()},e),s.src=t}function md(t,e){this.h=t,this.a=e}function pd(t){t.a.info("TestConnection: starting stage 2"),t.v=new S(t,t.a,h,h,h),t.v.W(t.t);var e=rd(t.h,t.N,t.r);if(U(sd),L){db(e,"TYPE","html");var n=t.v,t=Boolean(t.N);n.Ca=3,n.S=J(e.l()),Ac(n,t)}else db(e,"TYPE","xmlhttp"),jc(t.v,e,o,t.N,o)}function Dd(t){this.qb=t,this.b=Ed,this.s=[],this.P=[],this.a=new ad}function Fd(t,e){this.Eb=t,this.map=e}function Hd(t,e){P.call(this,"statevent",t),this.vc=e}function Id(t,e,n,i){P.call(this,"timingevent",t),this.size=e,this.uc=n,this.tc=i}function Kd(t){t.Y&&(t.Y.abort(),t.Y=k),t.k&&(t.k.cancel(),t.k=k),t.J&&(r.clearTimeout(t.J),t.J=k),Ld(t),t.n&&(t.n.cancel(),t.n=k),t.C&&(r.clearTimeout(t.C),t.C=k)}function Md(t){t.n||t.C||(t.C=V(u(t.Jb,t),0),t.T=0)}function Pd(t,e){var n,i;e?t.fa>6?(t.s=t.P.concat(t.s),t.P.length=0,n=t.xa-1,i=Nd(t)):(n=e.B,i=e.U):(n=t.xa++,i=Nd(t));var r=t.Ja.l();G(r,"SID",t.X),G(r,"RID",n),G(r,"AID",t.ta),Od(t,r),n=new S(t,t.a,t.X,n,t.T+1),n.W(t.t),n.setTimeout(Math.round(1e4)+Math.round(1e4*Math.random())),t.n=n,hc(n,r,i)}function Od(t,e){if(t.e){var n=t.e.getAdditionalParams(t);n&&B(n,function(t,n){G(e,n,t)})}}function Nd(t){var e,n=Math.min(t.s.length,1e3),i=["count="+n];t.fa>6&&n>0?(e=t.s[0].Eb,i.push("ofs="+e)):e=0;for(var r=0;n>r;r++){var o=t.s[r].Eb,s=t.s[r].map;t.fa<=6?o=r:o-=e;try{B(s,function(t,e){i.push("req"+o+"_"+e+"="+encodeURIComponent(t))})}catch(a){i.push("req"+o+"_type="+encodeURIComponent("_badmap")),t.e&&t.e.badMapError(t,s)}}return t.P=t.P.concat(t.s.splice(0,n)),i.join("&")}function Qd(t){t.k||t.J||(t.nb=1,t.J=V(u(t.Ib,t),0),t.da=0)}function Rd(t){return t.k||t.J?(t.a.I("Request already in progress"),o):t.da>=3?o:(t.a.info("Going to retry GET"),t.nb++,t.J=V(u(t.Ib,t),Sd(t,t.da)),t.da++,j)}function Jd(t){if(t.e){var e=t.e.okToMakeRequest(t);if(0!=e)return t.a.info("Handler returned error code from okToMakeRequest"),Z(t,e),o}return j}function xd(t,e,n){t.a.info("Test Connection Finished"),t.lb=t.Tb&&n,t.i=e.i,t.a.info("connectChannel_()"),t.Xb(Ed,0),t.Ja=nd(t,t.r),Md(t)}function td(t,e){t.a.info("Test Connection Failed"),t.i=e.i,Z(t,2)}function Ld(t){t.Z!=k&&(r.clearTimeout(t.Z),t.Z=k)}function Sd(t,e){var n=5e3+Math.floor(1e4*Math.random());return t.isActive()||(t.a.info("Inactive channel"),n*=2),n*=e}function Z(t,e){if(t.a.info("Error code "+e),2==e||9==e){var n=k;t.e&&(n=t.e.getNetworkTestImageUri(t));var i=u(t.mc,t);n||(n=new D("//www.google.com/images/cleardot.gif"),J(n)),ld(n.toString(),1e4,i)}else U(2);Td(t,e)}function Td(t,e){t.a.info("HttpChannel: error - "+e),t.b=0,t.e&&t.e.channelError(t,e),Ud(t),Kd(t)}function Ud(t){if(t.b=0,t.i=-1,t.e)if(0==t.P.length&&0==t.s.length)t.e.channelClosed(t);else{t.a.info("Number of undelivered maps, pending: "+t.P.length+", outgoing: "+t.s.length);var e=Ka(t.P),n=Ka(t.s);t.P.length=0,t.s.length=0,t.e.channelClosed(t,e,n)}}function nd(t,e){var n=zd(t,k,e);return t.a.info("GetForwardChannelUri: "+n),n}function rd(t,e,n){return e=zd(t,t.Sa()?e:k,n),t.a.info("GetBackChannelUri: "+e),e}function zd(t,e,n){var i=n instanceof D?n.l():new D(n,h);if(""!=i.L)e&&Ra(i,e+"."+i.L),Sa(i,i.ba);else var r=window.location,i=bb(r.protocol,k,e?e+"."+r.hostname:r.hostname,r.port,n);return t.qa&&B(t.qa,function(t,e){G(i,e,t)}),G(i,"VER",t.fa),Od(t,i),i}function V(t,e){return"function"!=ga(t)&&g(Error("Fn must not be null and must be a function")),r.setTimeout(function(){t()},e)}function U(t){Gd.dispatchEvent(new Hd(Gd,t))}function Vd(){}var h=void 0,j=!0,k=null,o=!1,q,da=da||{},r=this,ja="closure_uid_"+Math.floor(2147483648*Math.random()).toString(36),ka=0,v=Date.now||function(){return+new Date};w(na,Error),na.prototype.name="CustomError";var pa=/^[a-zA-Z0-9\-_.!~*'()]*$/,ta=/&/g,ua=/</g,va=/>/g,xa=/\"/g,sa=/[&<>\"]/;w(za,na),za.prototype.name="AssertionError";var Ba=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([\\w\\d\\-\\u0100-\\uffff.%]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),Fa="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),A=Array.prototype,Ha=A.indexOf?function(t,e,n){return A.indexOf.call(t,e,n)}:function(e,n,i){if(i=i==k?0:0>i?Math.max(0,e.length+i):i,t(e))return t(n)&&1==n.length?e.indexOf(n,i):-1;for(;i<e.length;i++)if(i in e&&e[i]===n)return i;return-1},Ia=A.forEach?function(t,e,n){A.forEach.call(t,e,n)}:function(e,n,i){for(var r=e.length,o=t(e)?e.split(""):e,s=0;r>s;s++)s in o&&n.call(i,o[s],s,e)};q=Na.prototype,q.c=0,q.Rb=0,q.$=function(){Oa(this);for(var t=[],e=0;e<this.j.length;e++)t.push(this.O[this.j[e]]);return t},q.ga=function(){return Oa(this),this.j.concat()},q.K=function(t){return C(this.O,t)},q.remove=function(t){return C(this.O,t)?(delete this.O[t],this.c--,this.Rb++,this.j.length>2*this.c&&Oa(this),j):o},q.get=function(t,e){return C(this.O,t)?this.O[t]:e},q.set=function(t,e){C(this.O,t)||(this.c++,this.j.push(t),this.Rb++),this.O[t]=e},q.l=function(){return new Na(this)},q=D.prototype,q.V="",q.Da="",q.L="",q.ba=k,q.r="",q.ra="",q.$b=o,q.H=o,q.toString=function(){if(this.w)return this.w;var e=[];this.V&&e.push(Xa(this.V,Ya),":"),this.L&&(e.push("//"),this.Da&&e.push(Xa(this.Da,Ya),"@"),e.push(t(this.L)?encodeURIComponent(this.L):k),this.ba!=k&&e.push(":",String(this.ba))),this.r&&(this.L&&"/"!=this.r.charAt(0)&&e.push("/"),e.push(Xa(this.r,"/"==this.r.charAt(0)?Za:$a)));var n=String(this.D);return n&&e.push("?",n),this.ra&&e.push("#",Xa(this.ra,ab)),this.w=e.join("")},q.l=function(){return bb(this.V,this.Da,this.L,this.ba,this.r,this.D.l(),this.ra,this.H)},q.la=function(t){return this.H=t,this.D&&this.D.la(t),this};var fb=/^[a-zA-Z0-9\-_.!~*'():\/;?]*$/,Ya=/[#\/\?@]/g,$a=/[\#\?:]/g,Za=/[\#\?]/g,cb=/[\#\?@]/g,ab=/#/g;q=Wa.prototype,q.g=k,q.c=k,q.add=function(t,e){if(H(this),eb(this),t=I(this,t),this.K(t)){var n=this.g.get(t);s(n)?n.push(e):this.g.set(t,[n,e])}else this.g.set(t,e);return this.c++,this},q.remove=function(t){if(H(this),t=I(this,t),this.g.K(t)){eb(this);var e=this.g.get(t);return s(e)?this.c-=e.length:this.c--,this.g.remove(t)}return o},q.K=function(t){return H(this),t=I(this,t),this.g.K(t)},q.ga=function(){H(this);for(var t=this.g.$(),e=this.g.ga(),n=[],i=0;i<e.length;i++){var r=t[i];if(s(r))for(var o=0;o<r.length;o++)n.push(e[i]);else n.push(e[i]);
}return n},q.$=function(t){if(H(this),t)if(t=I(this,t),this.K(t)){var e=this.g.get(t);if(s(e))return e;t=[],t.push(e)}else t=[];else for(var e=this.g.$(),t=[],n=0;n<e.length;n++){var i=e[n];s(i)?La(t,i):t.push(i)}return t},q.set=function(t,e){if(H(this),eb(this),t=I(this,t),this.K(t)){var n=this.g.get(t);s(n)?this.c-=n.length:this.c--}return this.g.set(t,e),this.c++,this},q.get=function(t,e){if(H(this),t=I(this,t),this.K(t)){var n=this.g.get(t);return s(n)?n[0]:n}return e},q.toString=function(){if(this.M)return this.M;if(!this.g)return"";for(var t=[],e=0,n=this.g.ga(),i=0;i<n.length;i++){var r=n[i],o=qa(r),r=this.g.get(r);if(s(r))for(var a=0;a<r.length;a++)e>0&&t.push("&"),t.push(o),""!==r[a]&&t.push("=",qa(r[a])),e++;else e>0&&t.push("&"),t.push(o),""!==r&&t.push("=",qa(r)),e++}return this.M=t.join("")},q.l=function(){var t=new Wa;return this.ab&&(t.ab=this.ab),this.M&&(t.M=this.M),this.g&&(t.g=this.g.l()),t},q.la=function(t){t&&!this.H&&(H(this),eb(this),B(this.g,function(t,e){var n=e.toLowerCase();e!=n&&(this.remove(e),this.add(n,t))},this)),this.H=t},hb.prototype.Fa=k;var ib;w(jb,hb),jb.prototype.eb=k,ib=new jb;var K,nb,ob,pb;pb=ob=nb=K=o;var rb;if(rb=qb()){var sb=r.navigator;K=0==rb.indexOf("Opera"),nb=!K&&-1!=rb.indexOf("MSIE"),ob=!K&&-1!=rb.indexOf("WebKit"),pb=!K&&!ob&&"Gecko"==sb.product}var tb=K,L=nb,ub=pb,M=ob,vb=r.navigator,wb=-1!=(vb&&vb.platform||"").indexOf("Mac"),xb;t:{var yb="",zb;if(tb&&r.opera)var Ab=r.opera.version,yb="function"==typeof Ab?Ab():Ab;else if(ub?zb=/rv\:([^\);]+)(\)|;)/:L?zb=/MSIE\s+([^\);]+)(\)|;)/:M&&(zb=/WebKit\/(\S+)/),zb)var Bb=zb.exec(qb()),yb=Bb?Bb[1]:"";if(L){var Cb,Db=r.document;if(Cb=Db?Db.documentMode:h,Cb>parseFloat(yb)){xb=String(Cb);break t}}xb=yb}var Eb={},Fb={},Ib=0;q=Hb.prototype,q.key=0,q.ja=o,q.pb=o,q.La=function(t,e,n,i,r,s){"function"==ga(t)?this.Bb=j:t&&t.handleEvent&&"function"==ga(t.handleEvent)?this.Bb=o:g(Error("Invalid listener argument")),this.wa=t,this.Lb=e,this.src=n,this.type=i,this.capture=!!r,this.cb=s,this.pb=o,this.key=++Ib,this.ja=o},q.handleEvent=function(t){return this.Bb?this.wa.call(this.cb||this.src,t):this.wa.handleEvent.call(this.wa,t)},!L||Gb();var Jb=!L||Gb();L&&N("8"),!M||N("528"),ub&&N("1.9b")||L&&N("8")||tb&&N("9.5")||M&&N("528"),!ub||N("8"),O.prototype.tb=o,O.prototype.Ga=function(){this.tb||(this.tb=j,this.z())},O.prototype.z=function(){this.Wb&&Kb.apply(k,this.Wb)},w(P,O),P.prototype.z=function(){delete this.type,delete this.target,delete this.currentTarget},P.prototype.ia=o,P.prototype.Ra=j,Lb[" "]=fa,w(Mb,P),q=Mb.prototype,q.target=k,q.relatedTarget=k,q.offsetX=0,q.offsetY=0,q.clientX=0,q.clientY=0,q.screenX=0,q.screenY=0,q.button=0,q.keyCode=0,q.charCode=0,q.ctrlKey=o,q.altKey=o,q.shiftKey=o,q.metaKey=o,q.jc=o,q.vb=k,q.La=function(t,e){var n=this.type=t.type;P.call(this,n),this.target=t.target||t.srcElement,this.currentTarget=e;var i=t.relatedTarget;if(i){if(ub){var r;t:{try{Lb(i.nodeName),r=j;break t}catch(s){}r=o}r||(i=k)}}else"mouseover"==n?i=t.fromElement:"mouseout"==n&&(i=t.toElement);this.relatedTarget=i,this.offsetX=M||t.offsetX!==h?t.offsetX:t.layerX,this.offsetY=M||t.offsetY!==h?t.offsetY:t.layerY,this.clientX=t.clientX!==h?t.clientX:t.pageX,this.clientY=t.clientY!==h?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0,this.button=t.button,this.keyCode=t.keyCode||0,this.charCode=t.charCode||("keypress"==n?t.keyCode:0),this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.jc=wb?t.metaKey:t.ctrlKey,this.state=t.state,this.vb=t,delete this.Ra,delete this.ia},q.z=function(){Mb.za.z.call(this),this.relatedTarget=this.currentTarget=this.target=this.vb=k};var Q={},R={},z={},Nb={};w(Xb,O),q=Xb.prototype,q.rb=j,q.jb=k,q.addEventListener=function(t,e,n,i){Ob(this,t,e,n,i)},q.removeEventListener=function(t,e,n,i){Rb(this,t,e,n,i)},q.dispatchEvent=function(e){var n=e.type||e,i=R;if(n in i){if(t(e))e=new P(e,this);else if(e instanceof P)e.target=e.target||this;else{var r=e,e=new P(n,this);Ga(e,r)}var s,a,r=1,i=i[n],n=j in i;if(n){for(s=[],a=this;a;a=a.jb)s.push(a);a=i[j],a.A=a.c;for(var l=s.length-1;!e.ia&&l>=0&&a.A;l--)e.currentTarget=s[l],r&=Vb(a,s[l],e.type,j,e)&&e.Ra!=o}if(o in i)if(a=i[o],a.A=a.c,n)for(l=0;!e.ia&&l<s.length&&a.A;l++)e.currentTarget=s[l],r&=Vb(a,s[l],e.type,o,e)&&e.Ra!=o;else for(s=this;!e.ia&&s&&a.A;s=s.jb)e.currentTarget=s,r&=Vb(a,s,e.type,o,e)&&e.Ra!=o;e=Boolean(r)}else e=j;return e},q.z=function(){Xb.za.z.call(this),Ub(this),this.jb=k},w(Yb,Xb),Yb.prototype.enabled=o;var Zb=r.window;q=Yb.prototype,q.Q=k,q.setInterval=function(t){this.sa=t,this.Q&&this.enabled?(this.stop(),this.start()):this.Q&&this.stop()},q.nc=function(){if(this.enabled){var t=v()-this.ib;t>0&&t<.8*this.sa?this.Q=this.Ba.setTimeout(this.Xa,this.sa-t):(this.dispatchEvent($b),this.enabled&&(this.Q=this.Ba.setTimeout(this.Xa,this.sa),this.ib=v()))}},q.start=function(){this.enabled=j,this.Q||(this.Q=this.Ba.setTimeout(this.Xa,this.sa),this.ib=v())},q.stop=function(){this.enabled=o,this.Q&&(this.Ba.clearTimeout(this.Q),this.Q=k)},q.z=function(){Yb.za.z.call(this),this.stop(),delete this.Ba};var $b="tick";w(ac,O);var bc=[];ac.prototype.z=function(){ac.za.z.call(this),Ia(this.j,Sb),this.j.length=0},ac.prototype.handleEvent=function(){g(Error("EventHandler.handleEvent not implemented"))},q=S.prototype,q.t=k,q.F=o,q.oa=k,q.mb=k,q.ka=k,q.Ca=k,q.S=k,q.u=k,q.U=k,q.p=k,q.Ea=0,q.G=k,q.ma=k,q.q=k,q.i=-1,q.Ob=j,q.ea=o;var cc=45e3,dc=250,fc={},gc={};q=S.prototype,q.W=p("t"),q.setTimeout=p("Aa"),q.Sb=function(t){t=t.target;try{if(t==this.p)t:{var e=T(this.p);if(L||M&&!N("420+")){if(4>e)break t}else if(3>e||3==e&&!tb&&!lc(this.p))break t;mc(this);var n=nc(this.p);this.i=n;var i=lc(this.p);if(i||this.a.info("No response text for uri "+this.u+" status "+n),this.F=200==n,this.a.info("XMLHTTP RESP ("+this.B+") [ attempt "+this.ya+"]: "+this.ma+"\n"+this.u+"\n"+e+" "+n),this.F){if(4==e&&oc(this),this.sb){if(pc(this,e,i),tb&&3==e){var r=this.ub,a=this.Oa,l=this.kc,n=$b;for(s(n)||(bc[0]=n,n=bc),i=0;i<n.length;i++)r.j.push(Ob(a,n[i],l||r,o,r.e||r));this.Oa.start()}}else qc(this.a,this.B,i,k),rc(this,i);this.F&&!this.ea&&(4==e?this.h.ha(this):(this.F=o,kc(this)))}else 400==n&&i.indexOf("Unknown SID")>0?(this.q=3,U(sc)):(this.q=0,U(tc)),qc(this.a,this.B,i),oc(this),uc(this)}else this.a.na("Called back with an unexpected xmlhttp")}catch(c){this.a.info("Failed call to OnXmlHttpReadyStateChanged_"),this.p&&lc(this.p)?vc(this.a,c,"ResponseText: "+lc(this.p)):vc(this.a,c,"No response text")}finally{}},q.kc=function(){var t=T(this.p),e=lc(this.p);this.Ea<e.length&&(mc(this),pc(this,t,e),this.F&&4!=t&&kc(this))},q.hc=function(t){V(u(this.gc,this,t),0)},q.gc=function(t){if(!this.ea){var e=this.a;e.info("TRIDENT TEXT ("+this.B+"): "+Bc(e,t)),mc(this),rc(this,t),kc(this)}},q.Kb=function(t){V(u(this.fc,this,t),0)},q.fc=function(t){this.ea||(this.a.info("TRIDENT TEXT ("+this.B+"): "+t?"success":"failure"),mc(this),oc(this),this.F=t,this.h.ha(this))},q.Zb=function(){mc(this),this.h.ha(this)},q.cancel=function(){this.ea=j,mc(this),oc(this)},q.ic=function(){this.oa=k;var t=v();t-this.mb>=0?(this.F&&this.a.I("Received watchdog timeout even though request loaded successfully"),this.a.info("TIMEOUT: "+this.u),oc(this),this.q=2,U(Dc),uc(this)):(this.a.na("WatchDog timer called too early"),Cc(this,this.mb-t))},q.yb=ba("q");var Jc={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\u000b"},Kc=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,Oc={};Pc.prototype.lc=0,Pc.prototype.xb=k,Pc.prototype.wb=k;var Qc=0;Pc.prototype.reset=function(t,e,n,i,r){this.lc="number"==typeof r?r:Qc++,this.wc=i||v(),this.va=t,this.ac=e,this.qc=n,delete this.xb,delete this.wb},Pc.prototype.Pb=p("va"),W.prototype.Na=k,W.prototype.va=k,W.prototype.Ya=k,W.prototype.zb=k,Rc.prototype.toString=ba("name");var Sc=new Rc("SEVERE",1e3),Tc=new Rc("WARNING",900),Uc=new Rc("INFO",800),Vc=new Rc("CONFIG",700),Wc=new Rc("FINE",500);q=W.prototype,q.getParent=ba("Na"),q.Pb=p("va"),q.log=function(t,e,n){if(t.value>=Xc(this).value)for(t=this.Yb(t,e,n),e="log:"+t.ac,r.console&&(r.console.timeStamp?r.console.timeStamp(e):r.console.markTimeline&&r.console.markTimeline(e)),r.msWriteProfilerMark&&r.msWriteProfilerMark(e),e=this;e;){var n=e,i=t;if(n.zb)for(var o=0,s=h;s=n.zb[o];o++)s(i);e=e.getParent()}},q.Yb=function(e,n,i){var r=new Pc(e,String(n),this.bc);if(i){r.xb=i;var s,a=arguments.callee.caller;try{var l,c=ea("window.location.href");if(t(i))l={message:i,name:"Unknown error",lineNumber:"Not available",fileName:c,stack:"Not available"};else{var u,h,p=o;try{u=i.lineNumber||i.pc||"Not available"}catch(d){u="Not available",p=j}try{h=i.fileName||i.filename||i.sourceURL||c}catch(f){h="Not available",p=j}l=!p&&i.lineNumber&&i.fileName&&i.stack?i:{message:i.message,name:i.name,lineNumber:u,fileName:h,stack:i.stack||"Not available"}}s="Message: "+ra(l.message)+'\nUrl: <a href="view-source:'+l.fileName+'" target="_new">'+l.fileName+"</a>\nLine: "+l.lineNumber+"\n\nBrowser stack:\n"+ra(l.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+ra(Lc(a)+"-> ")}catch(m){s="Exception trying to expose exception! You win, we lose. "+m}r.wb=s}return r},q.I=function(t,e){this.log(Sc,t,e)},q.na=function(t,e){this.log(Tc,t,e)},q.info=function(t,e){this.log(Uc,t,e)};var Yc={},Zc=k;ad.prototype.info=function(t){this.o.info(t)},ad.prototype.na=function(t){this.o.na(t)},ad.prototype.I=function(t){this.o.I(t)},w(dd,Xb),dd.prototype.o=$c("goog.net.XhrIo");var ed=/^https?$/i;q=dd.prototype,q.R=o,q.f=k,q.Ua=k,q.hb="",q.Cb="",q.ua=0,q.q="",q.bb=o,q.Ka=o,q.fb=o,q.aa=o,q.Ta=0,q.ca=k,q.Nb="",q.oc=o,q.send=function(t,e,n,i){this.f&&g(Error("[goog.net.XhrIo] Object is active with another request")),e=e?e.toUpperCase():"GET",this.hb=t,this.q="",this.ua=0,this.Cb=e,this.bb=o,this.R=j,this.f=kb(this.pa?this.pa:ib),this.Ua=this.pa?this.pa.Fa||(this.pa.Fa=mb(this.pa)):ib.Fa||(ib.Fa=mb(ib)),this.f.onreadystatechange=u(this.Gb,this);try{X(this.o,Y(this,"Opening Xhr")),this.fb=j,this.f.open(e,t,j),this.fb=o}catch(r){return X(this.o,Y(this,"Error opening Xhr: "+r.message)),void fd(this,r)}var t=n||"",s=this.headers.l();i&&B(i,function(t,e){s.set(e,t)}),"POST"==e&&!s.K("Content-Type")&&s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),B(s,function(t,e){this.f.setRequestHeader(e,t)},this),this.Nb&&(this.f.responseType=this.Nb),"withCredentials"in this.f&&(this.f.withCredentials=this.oc);try{this.ca&&(Zb.clearTimeout(this.ca),this.ca=k),this.Ta>0&&(X(this.o,Y(this,"Will abort after "+this.Ta+"ms if incomplete")),this.ca=Zb.setTimeout(u(this.Aa,this),this.Ta)),X(this.o,Y(this,"Sending request")),this.Ka=j,this.f.send(t),this.Ka=o}catch(a){X(this.o,Y(this,"Send error: "+a.message)),fd(this,a)}},q.Aa=function(){"undefined"!=typeof da&&this.f&&(this.q="Timed out after "+this.Ta+"ms, aborting",this.ua=8,X(this.o,Y(this,this.q)),this.dispatchEvent("timeout"),this.abort(8))},q.abort=function(t){this.f&&this.R&&(X(this.o,Y(this,"Aborting")),this.R=o,this.aa=j,this.f.abort(),this.aa=o,this.ua=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),hd(this))},q.z=function(){this.f&&(this.R&&(this.R=o,this.aa=j,this.f.abort(),this.aa=o),hd(this,j)),dd.za.z.call(this)},q.Gb=function(){this.fb||this.Ka||this.aa?id(this):this.ec()},q.ec=function(){id(this)},q.isActive=function(){return!!this.f},q.yb=function(){return t(this.q)?this.q:String(this.q)},new jd,jd.prototype.set=p("Mb"),jd.prototype.reset=function(){this.set(v())},jd.prototype.get=ba("Mb"),q=md.prototype,q.t=k,q.v=k,q.Pa=o,q.Qb=k,q.Ia=k,q.gb=k,q.r=k,q.b=k,q.i=-1,q.N=k,q.Wa=k,q.W=p("t"),q.Za=function(t){this.r=t,t=nd(this.h,this.r),U(od),db(t,"MODE","init"),this.v=new S(this,this.a,h,h,h),this.v.W(this.t),jc(this.v,t,o,k,j),this.b=0,this.Qb=v()},q.Vb=function(t){t?(this.b=2,pd(this)):(U(qd),t=this.h,t.a.info("Test Connection Blocked"),t.i=t.Y.i,Z(t,9))},q.$a=function(t){return this.h.$a(t)},q.abort=function(){this.v&&(this.v.cancel(),this.v=k),this.i=-1},q.Ab=ca(o),q.Hb=function(t,e){if(this.i=t.i,0==this.b)if(this.a.info("TestConnection: Got data for stage 1"),e){try{var n=Ec(e)}catch(i){return vc(this.a,i),void td(this.h,this)}this.N=this.h.correctHostPrefix(n[0]),this.Wa=n[1]}else this.a.info("TestConnection: Null responseText"),td(this.h,this);else 2==this.b&&(this.Pa?(U(ud),this.gb=v()):"11111"==e?(U(vd),this.Pa=j,this.Ia=v(),n=this.Ia-this.Qb,(!L||500>n)&&(this.i=200,this.v.cancel(),this.a.info("Test connection succeeded; using streaming connection"),U(wd),xd(this.h,this,j))):(U(yd),this.Ia=this.gb=v(),this.Pa=o))},q.ha=function(){if(this.i=this.v.i,this.v.F)if(0==this.b)if(this.a.info("TestConnection: request complete for initial check"),this.Wa){this.b=1;var t=zd(this.h,this.Wa,"/mail/images/cleardot.gif");J(t),kd(t.toString(),5e3,u(this.Vb,this),3,2e3)}else this.b=2,pd(this);else 2==this.b&&(this.a.info("TestConnection: request complete for stage 2"),t=o,(t=L?this.gb-this.Ia<200?o:j:this.Pa)?(this.a.info("Test connection succeeded; using streaming connection"),U(wd),xd(this.h,this,j)):(this.a.info("Test connection failed; not using streaming"),U(Ad),xd(this.h,this,o)));else this.a.info("TestConnection: request failed, in state "+this.b),0==this.b?U(Bd):2==this.b&&U(Cd),td(this.h,this)},q.Sa=function(){return this.h.Sa()},q.isActive=function(){return this.h.isActive()},q=Dd.prototype,q.t=k,q.qa=k,q.n=k,q.k=k,q.r=k,q.Ja=k,q.ob=k,q.N=k,q.Ub=j,q.xa=0,q.cc=0,q.Ha=o,q.e=k,q.C=k,q.J=k,q.Z=k,q.Y=k,q.lb=k,q.Tb=j,q.ta=-1,q.Db=-1,q.i=-1,q.T=0,q.da=0,q.fa=8;var Ed=1,Gd=new Xb;w(Hd,P),w(Id,P);var od=3,qd=4,sd=5,vd=6,ud=7,yd=8,Bd=9,Cd=10,Ad=11,wd=12,sc=13,tc=14,xc=15,yc=16,zc=17,Dc=18,cd="y2f%";q=Dd.prototype,q.Za=function(t,e,n,i,r){this.a.info("connect()"),U(0),this.r=e,this.qa=n||{},i&&r!==h&&(this.qa.OSID=i,this.qa.OAID=r),this.a.info("connectTest_()"),Jd(this)&&(this.Y=new md(this,this.a),this.Y.W(this.t),this.Y.Za(t))},q.W=p("t"),q.Ab=function(){return 0==this.b},q.Jb=function(t){if(this.C=k,this.a.info("startForwardChannel_"),Jd(this))if(this.b==Ed)if(t)this.a.I("Not supposed to retry the open");else{this.a.info("open_()"),this.xa=Math.floor(1e5*Math.random());var t=this.xa++,e=new S(this,this.a,"",t,h);e.W(this.t);var n=Nd(this),i=this.Ja.l();G(i,"RID",t),this.qb&&G(i,"CVER",this.qb),Od(this,i),hc(e,i,n),this.n=e,this.b=2}else 3==this.b&&(t?Pd(this,t):0==this.s.length?this.a.info("startForwardChannel_ returned: nothing to send"):this.n?this.a.I("startForwardChannel_ returned: connection already in progress"):(Pd(this),this.a.info("startForwardChannel_ finished, sent request")))},q.Ib=function(){if(this.J=k,Jd(this)){this.a.info("Creating new HttpRequest"),this.k=new S(this,this.a,this.X,"rpc",this.nb),this.k.W(this.t);var t=this.ob.l();if(G(t,"RID","rpc"),G(t,"SID",this.X),G(t,"CI",this.lb?"0":"1"),G(t,"AID",this.ta),Od(this,t),L){G(t,"TYPE","html");var e=this.k,n=Boolean(this.N);e.Ca=3,e.S=J(t.l()),Ac(e,n)}else G(t,"TYPE","xmlhttp"),jc(this.k,t,j,this.N,o);this.a.info("New Request created")}},q.Hb=function(t,e){if(0!=this.b&&(this.k==t||this.n==t))if(this.i=t.i,this.n==t&&3==this.b)if(this.fa>7){var n;try{n=Ec(e)}catch(i){n=k}if(s(n)&&3==n.length){var r=n;if(0==r[0])t:if(this.a.info("Server claims our backchannel is missing."),this.J)this.a.info("But we are currently starting the request.");else{if(this.k){if(!(this.k.ka+3e3<this.n.ka))break t;Ld(this),this.k.cancel(),this.k=k}else this.a.na("We do not have a BackChannel established");Rd(this),U(19)}else this.Db=r[1],n=this.Db-this.ta,n>0&&(r=r[2],this.a.info(r+" bytes (in "+n+" arrays) are outstanding on the BackChannel"),37500>r&&this.lb&&0==this.da&&!this.Z)&&(this.Z=V(u(this.dc,this),6e3))}else this.a.info("Bad POST response data returned"),Z(this,11)}else e!=cd&&(this.a.info("Bad data returned - missing/invald magic cookie"),Z(this,11));else if(this.k==t&&Ld(this),!/^[\s\xa0]*$/.test(e)){n=Ec(e);for(var r=this.e&&this.e.channelHandleMultipleArrays?[]:k,o=0;o<n.length;o++){var a=n[o];this.ta=a[0],a=a[1],2==this.b?"c"==a[0]?(this.X=a[1],this.N=this.correctHostPrefix(a[2]),a=a[3],this.fa=a!=k?a:6,this.b=3,this.e&&this.e.channelOpened(this),this.ob=rd(this,this.N,this.r),Qd(this)):"stop"==a[0]&&Z(this,7):3==this.b&&("stop"==a[0]?(r&&r.length&&(this.e.channelHandleMultipleArrays(this,r),r.length=0),Z(this,7)):"noop"!=a[0]&&(r?r.push(a):this.e&&this.e.channelHandleArray(this,a)),this.da=0)}r&&r.length&&this.e.channelHandleMultipleArrays(this,r)}},q.correctHostPrefix=function(t){return this.Ub?this.e?this.e.correctHostPrefix(t):t:k},q.dc=function(){this.Z!=k&&(this.Z=k,this.k.cancel(),this.k=k,Rd(this),U(20))},q.ha=function(t){this.a.info("Request complete");var e;if(this.k==t)Ld(this),this.k=k,e=2;else{if(this.n!=t)return;this.n=k,e=1}if(this.i=t.i,0!=this.b)if(t.F)1==e?(e=v()-t.ka,Gd.dispatchEvent(new Id(Gd,t.U?t.U.length:0,e,this.T)),Md(this),this.P.length=0):Qd(this);else{var n=t.yb();if(3==n||0==n&&this.i>0)this.a.info("Not retrying due to error type");else{this.a.info("Maybe retrying, last error: "+ec(n,this.i));var i;if((i=1==e)&&(this.n||this.C?(this.a.I("Request already in progress"),i=o):this.b==Ed||this.T>=(this.Ha?0:2)?i=o:(this.a.info("Going to retry POST"),this.C=V(u(this.Jb,this,t),Sd(this,this.T)),this.T++,i=j)),i)return;if(2==e&&Rd(this))return;this.a.info("Exceeded max number of retries")}switch(this.a.info("Error: HTTP request failed"),n){case 1:Z(this,5);break;case 4:Z(this,10);break;case 3:Z(this,6);break;default:Z(this,2)}}},q.Xb=function(t){Ha(arguments,this.b)>=0||g(Error("Unexpected channel state: "+this.b))},q.mc=function(t){t?(this.a.info("Successfully pinged google.com"),U(2)):(this.a.info("Failed to ping google.com"),U(1),Td(this,8))},q.$a=function(t){return t?void g(Error("Can't create secondary domain capable XhrIo object.")):new dd},q.isActive=function(){return!!this.e&&this.e.isActive(this)},q.Sa=function(){return L},q=Vd.prototype,q.channelHandleMultipleArrays=k,q.okToMakeRequest=ca(0),q.channelOpened=aa(),q.channelHandleArray=aa(),q.channelError=aa(),q.channelClosed=aa(),q.getAdditionalParams=function(){return{}},q.getNetworkTestImageUri=ca(k),q.isActive=ca(j),q.badMapError=aa(),q.correctHostPrefix=function(t){return t};var $,Wd;Wd={0:"Ok",4:"User is logging out",6:"Unknown session ID",7:"Stopped by server",8:"General network error",2:"Request failed",9:"Blocked by a network administrator",5:"No data from server",10:"Got bad data from the server",11:"Got a bad response from the server"},$=function(t,e){var n,i,o,a,l,c,p,d,f;return p=this,t||(t="channel"),t.match(/:\/\//)&&t.replace(/^ws/,"http"),e||(e={}),s(e||"string"==typeof e)&&(e={}),l=e.reconnectTime||3e3,f=function(t){p.readyState=p.readyState=t},f(this.CLOSED),d=k,o=e.sc,n=new Vd,n.channelOpened=function(){return o=d,f($.OPEN),"function"==typeof p.onopen?p.onopen():h},i=k,n.channelError=function(t,e){var n;return n=Wd[e],i=e,f($.Va),"function"==typeof p.onerror?p.onerror(n,e):h},c=k,n.channelClosed=function(t,n,r){if(p.readyState!==$.CLOSED){d=k,t=i?Wd[i]:"Closed",f($.CLOSED);try{"function"==typeof p.onclose&&p.onclose(t,n,r)}catch(o){"undefined"!=typeof console&&console!==k&&console.error(o.stack)}return e.reconnect&&7!==i&&0!==i&&(n=6===i?0:l,clearTimeout(c),c=setTimeout(a,n)),i=k}},n.channelHandleArray=function(t,e){try{return"function"==typeof p.onmessage?p.onmessage(e):h}catch(n){return setTimeout(function(){g(n)},0)}},a=function(){if(d&&g(Error("Reconnect() called from invalid state")),f($.CONNECTING),"function"==typeof p.onconnecting&&p.onconnecting(),clearTimeout(c),d=new Dd(e.appVersion),d.e=n,i=k,e.failFast){var s=d;s.Ha=j,s.a.info("setFailFast: true"),(s.n||s.C)&&s.T>(s.Ha?0:2)&&(s.a.info("Retry count "+s.T+" > new maxRetries "+(s.Ha?0:2)+". Fail immediately!"),s.n?(s.n.cancel(),s.ha(s.n)):(r.clearTimeout(s.C),s.C=k,Z(s,2)))}return d.Za(""+t+"/test",""+t+"/bind",k,o!=k?o.X:h,o!=k?o.ta:h)},this.open=function(){return p.readyState!==p.CLOSED&&g(Error("Already open")),a()},this.close=function(){if(clearTimeout(c),i=0,p.readyState!==$.CLOSED){f($.Va);var t=d;if(t.a.info("disconnect()"),Kd(t),3==t.b){var e=t.xa++,n=t.Ja.l();G(n,"SID",t.X),G(n,"RID",e),G(n,"TYPE","terminate"),Od(t,n),e=new S(t,t.a,t.X,e,h),e.Ca=2,e.S=J(n.l()),n=new Image,n.src=e.S,n.onload=n.onerror=u(e.Zb,e),e.ka=v(),kc(e),Ud(t)}}},this.sendMap=function(t){var e;((e=p.readyState)===$.Va||e===$.CLOSED)&&g(Error("Cannot send to a closed connection")),e=d,0==e.b&&g(Error("Invalid operation: sending map when state is closed")),1e3==e.s.length&&e.a.I("Already have 1000 queued maps upon queueing "+Gc(t)),e.s.push(new Fd(e.cc++,t)),(2==e.b||3==e.b)&&Md(e)},this.send=function(t){return this.sendMap({JSON:Gc(t)})},a(),this},$.prototype.CONNECTING=$.CONNECTING=$.CONNECTING=0,$.prototype.OPEN=$.OPEN=$.OPEN=1,$.prototype.CLOSING=$.CLOSING=$.Va=2,$.prototype.CLOSED=$.CLOSED=$.CLOSED=3,("undefined"!=typeof exports&&exports!==k?exports:window).BCSocket=$}(),function(){var t,e,n,i,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,b,w,C=[].slice,T=function(t,e){return function(){return t.apply(e,arguments)}},k=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};window.sharejs=h={version:"0.6.3"},"undefined"==typeof WEB&&(window.WEB=!0),m="undefined"!=typeof WEB&&null!==WEB?function(t){return setTimeout(t,0)}:process.nextTick,i=function(){function t(){}return t.prototype.on=function(t,e){var n;return this._events||(this._events={}),(n=this._events)[t]||(n[t]=[]),this._events[t].push(e),this},t.prototype.removeListener=function(t,e){var n,i,r,o=this;for(this._events||(this._events={}),i=(r=this._events)[t]||(r[t]=[]),n=0;n<i.length;)i[n]===e&&(i[n]=void 0),n++;return m(function(){var e;return o._events[t]=function(){var n,i,r,o;for(r=this._events[t],o=[],n=0,i=r.length;i>n;n++)e=r[n],e&&o.push(e);return o}.call(o)}),this},t.prototype.emit=function(){var t,e,n,i,r,o,s;if(e=arguments[0],t=2<=arguments.length?C.call(arguments,1):[],!(null!=(o=this._events)?o[e]:void 0))return this;for(s=this._events[e],i=0,r=s.length;r>i;i++)n=s[i],n&&n.apply(this,t);return this},t.prototype.once=function(t,e){var n,i=this;return this.on(t,n=function(){var r;return r=1<=arguments.length?C.call(arguments,0):[],i.removeListener(t,n),e.apply(i,r)})},t}(),i.mixin=function(t){var e;return e=t.prototype||t,e.on=i.prototype.on,e.removeListener=i.prototype.removeListener,e.emit=i.prototype.emit,e.once=i.prototype.once,t},("undefined"==typeof WEB||null===WEB)&&(module.exports=i),h._bt=l=function(t,e,n,i){var r,o;return r=function(t,n,i,r){return e(i,t,n,"left"),e(r,n,t,"right")},t.transformX=t.transformX=o=function(t,e){var s,a,l,c,u,h,p,d,f,m,g,y,_,v,b,w,C,T,k;for(n(t),n(e),u=[],m=0,v=e.length;v>m;m++){for(f=e[m],c=[],s=0;s<t.length;){if(h=[],r(t[s],f,c,h),s++,1!==h.length){if(0===h.length){for(T=t.slice(s),g=0,b=T.length;b>g;g++)a=T[g],i(c,a);f=null;break}for(k=o(t.slice(s),h),l=k[0],d=k[1],y=0,w=l.length;w>y;y++)a=l[y],i(c,a);for(_=0,C=d.length;C>_;_++)p=d[_],i(u,p);f=null;break}f=h[0]}null!=f&&i(u,f),t=c}return[t,u]},t.transform=t.transform=function(t,n,i){var r,s,a,l,c;if("left"!==i&&"right"!==i)throw new Error("type must be 'left' or 'right'");return 0===n.length?t:1===t.length&&1===n.length?e([],t[0],n[0],i):"left"===i?(l=o(t,n),r=l[0],a=l[1],r):(c=o(n,t),a=c[0],s=c[1],s)}},"undefined"==typeof WEB&&(h.bootstrapTransform=l),_={},_.name="text",_.create=function(){return""},y=function(t,e,n){return t.slice(0,e)+n+t.slice(e)},c=function(t){var e,n;if("number"!=typeof t.p)throw new Error("component missing position field");if(n=typeof t.i,e=typeof t.d,!("string"===n^"string"===e))throw new Error("component needs an i or d field");if(!(t.p>=0))throw new Error("position cannot be negative")},u=function(t){var e,n,i;for(n=0,i=t.length;i>n;n++)e=t[n],c(e);return!0},_.apply=function(t,e){var n,i,r,o;for(u(e),r=0,o=e.length;o>r;r++)if(n=e[r],null!=n.i)t=y(t,n.p,n.i);else{if(i=t.slice(n.p,n.p+n.d.length),n.d!==i)throw new Error("Delete component '"+n.d+"' does not match deleted text '"+i+"'");t=t.slice(0,n.p)+t.slice(n.p+n.d.length)}return t},_._append=a=function(t,e){var n,i,r;if(""!==e.i&&""!==e.d)return 0===t.length?t.push(e):(n=t[t.length-1],null!=n.i&&null!=e.i&&n.p<=(i=e.p)&&i<=n.p+n.i.length?t[t.length-1]={i:y(n.i,e.p-n.p,e.i),p:n.p}:null!=n.d&&null!=e.d&&e.p<=(r=n.p)&&r<=e.p+e.d.length?t[t.length-1]={d:y(e.d,n.p-e.p,n.d),p:e.p}:t.push(e))},_.compose=function(t,e){var n,i,r,o;for(u(t),u(e),i=t.slice(),r=0,o=e.length;o>r;r++)n=e[r],a(i,n);return i},_.compress=function(t){return _.compose([],t)},_.normalize=function(t){var e,n,i,r,o;for(n=[],(null!=t.i||null!=t.p)&&(t=[t]),i=0,r=t.length;r>i;i++)e=t[i],null==(o=e.p)&&(e.p=0),a(n,e);return n},b=function(t,e,n){return null!=e.i?e.p<t||e.p===t&&n?t+e.i.length:t:t<=e.p?t:t<=e.p+e.d.length?e.p:t-e.d.length},_.transformCursor=function(t,e,n){var i,r,o,s;for(r="right"===n,o=0,s=e.length;s>o;o++)i=e[o],t=b(t,i,r);return t},_._tc=v=function(t,e,n,i){var r,o,s,l,c,h;if(u([e]),u([n]),null!=e.i)a(t,{i:e.i,p:b(e.p,n,"right"===i)});else if(null!=n.i)h=e.d,e.p<n.p&&(a(t,{d:h.slice(0,n.p-e.p),p:e.p}),h=h.slice(n.p-e.p)),""!==h&&a(t,{d:h,p:e.p+n.i.length});else if(e.p>=n.p+n.d.length)a(t,{d:e.d,p:e.p-n.d.length});else if(e.p+e.d.length<=n.p)a(t,e);else{if(l={d:"",p:e.p},e.p<n.p&&(l.d=e.d.slice(0,n.p-e.p)),e.p+e.d.length>n.p+n.d.length&&(l.d+=e.d.slice(n.p+n.d.length-e.p)),s=Math.max(e.p,n.p),o=Math.min(e.p+e.d.length,n.p+n.d.length),r=e.d.slice(s-e.p,o-e.p),c=n.d.slice(s-n.p,o-n.p),r!==c)throw new Error("Delete ops delete different text in the same region of the document");""!==l.d&&(l.p=b(l.p,n),a(t,l))}return t},f=function(t){return null!=t.i?{d:t.i,p:t.p}:{i:t.d,p:t.p}},_.invert=function(t){var e,n,i,r,o;for(r=t.slice().reverse(),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(f(e));return o},"undefined"!=typeof WEB&&null!==WEB?(h.types||(h.types={}),l(_,v,u,a),h.types.text=_):(module.exports=_,require("./helpers").bootstrapTransform(_,v,u,a)),"undefined"==typeof WEB&&(_=require("./text")),_.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(t,e,n){var i;return i=[{p:t,i:e}],this.submitOp(i,n),i},del:function(t,e,n){var i;return i=[{p:t,d:this.snapshot.slice(t,t+e)}],this.submitOp(i,n),i},_register:function(){return this.on("remoteop",function(t){var e,n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],void 0!==e.i?r.push(this.emit("insert",e.p,e.i)):r.push(this.emit("delete",e.p,e.d));return r})}},("undefined"==typeof WEB||null===WEB)&&(w=require("../types")),"undefined"!=typeof WEB&&null!==WEB&&(h.extendDoc=function(t,e){return n.prototype[t]=e}),n=function(){function t(t,e,n){this.connection=t,this.name=e,this.shout=T(this.shout,this),this.flush=T(this.flush,this),n||(n={}),this.version=n.v,this.snapshot=n.snaphot,n.type&&this._setType(n.type),this.state="closed",this.autoOpen=!1,this._create=n.create,this.inflightOp=null,this.inflightCallbacks=[],this.inflightSubmittedIds=[],this.pendingOp=null,this.pendingCallbacks=[],this.serverOps={}}return t.prototype._xf=function(t,e){var n,i;return this.type.transformX?this.type.transformX(t,e):(n=this.type.transform(t,e,"left"),i=this.type.transform(e,t,"right"),[n,i])},t.prototype._otApply=function(t,e){var n;return n=this.snapshot,this.snapshot=this.type.apply(this.snapshot,t),this.emit("change",t,n),e?this.emit("remoteop",t,n):void 0},t.prototype._connectionStateChanged=function(t,e){switch(t){case"disconnected":this.state="closed",this.inflightOp&&this.inflightSubmittedIds.push(this.connection.id),this.emit("closed");break;case"ok":this.autoOpen&&this.open();break;case"stopped":"function"==typeof this._openCallback&&this._openCallback(e)}return this.emit(t,e)},t.prototype._setType=function(t){var e,n,i;if(!this.type){if("string"==typeof t&&(t=w[t]),!t||!t.compose)throw new Error("Support for types without compose() is not implemented");if(this.type=t,t.api){i=t.api;for(e in i)n=i[e],this[e]=n;return"function"==typeof this._register?this._register():void 0}return this.provides={}}},t.prototype._onMessage=function(t){var e,n,i,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,b;switch(!1){case t.open!==!0:return this.state="open",this._create=!1,null==this.created&&(this.created=!!t.create),t.type&&this._setType(t.type),t.create?(this.created=!0,this.snapshot=this.type.create()):(this.created!==!0&&(this.created=!1),void 0!==t.snapshot&&(this.snapshot=t.snapshot)),t.meta&&(this.meta=t.meta),null!=t.v&&(this.version=t.v),this.inflightOp?(a={doc:this.name,op:this.inflightOp,v:this.version},this.inflightSubmittedIds.length&&(a.dupIfSource=this.inflightSubmittedIds),this.connection.send(a)):this.flush(),this.emit("open"),"function"==typeof this._openCallback?this._openCallback(null):void 0;case t.open!==!1:return t.error&&("undefined"!=typeof console&&null!==console&&console.error("Could not open document: "+t.error),this.emit("error",t.error),"function"==typeof this._openCallback&&this._openCallback(t.error)),this.state="closed",this.emit("closed"),"function"==typeof this._closeCallback&&this._closeCallback(),this._closeCallback=null;case!(null===t.op&&"Op already submitted"===i):break;case!(void 0===t.op&&void 0!==t.v||t.op&&(f=t.meta.source,k.call(this.inflightSubmittedIds,f)>=0)):if(r=this.inflightOp,this.inflightOp=null,this.inflightSubmittedIds.length=0,i=t.error)for(this.type.invert?(l=this.type.invert(r),this.pendingOp&&(m=this._xf(this.pendingOp,l),this.pendingOp=m[0],l=m[1]),this._otApply(l,!0)):this.emit("error","Op apply failed ("+i+") and the op could not be reverted"),g=this.inflightCallbacks,u=0,p=g.length;p>u;u++)(e=g[u])(i);else{if(t.v!==this.version)throw new Error("Invalid version from server");for(this.serverOps[this.version]=r,this.version++,this.emit("acknowledge",r),y=this.inflightCallbacks,h=0,d=y.length;d>h;h++)(e=y[h])(null,r)}return this.flush();case!t.op:if(t.v<this.version)return;return t.doc!==this.name?this.emit("error","Expected docName '"+this.name+"' but got "+t.doc):t.v!==this.version?this.emit("error","Expected version "+this.version+" but got "+t.v):(o=t.op,this.serverOps[this.version]=o,n=o,null!==this.inflightOp&&(_=this._xf(this.inflightOp,n),this.inflightOp=_[0],n=_[1]),null!==this.pendingOp&&(v=this._xf(this.pendingOp,n),this.pendingOp=v[0],n=v[1]),this.version++,this._otApply(n,!0));case!t.meta:switch(b=t.meta,s=b.path,c=b.value,null!=s?s[0]:void 0){case"shout":return this.emit("shout",c);default:return"undefined"!=typeof console&&null!==console?console.warn("Unhandled meta op:",t):void 0}break;default:return"undefined"!=typeof console&&null!==console?console.warn("Unhandled document message:",t):void 0}},t.prototype.flush=function(){return"ok"===this.connection.state&&null===this.inflightOp&&null!==this.pendingOp?(this.inflightOp=this.pendingOp,this.inflightCallbacks=this.pendingCallbacks,this.pendingOp=null,this.pendingCallbacks=[],this.connection.send({doc:this.name,op:this.inflightOp,v:this.version})):void 0},t.prototype.submitOp=function(t,e){return null!=this.type.normalize&&(t=this.type.normalize(t)),this.snapshot=this.type.apply(this.snapshot,t),null!==this.pendingOp?this.pendingOp=this.type.compose(this.pendingOp,t):this.pendingOp=t,e&&this.pendingCallbacks.push(e),this.emit("change",t),setTimeout(this.flush,0)},t.prototype.shout=function(t){return this.connection.send({doc:this.name,meta:{path:["shout"],value:t}})},t.prototype.open=function(t){var e,n=this;return this.autoOpen=!0,"closed"===this.state?(e={doc:this.name,open:!0},void 0===this.snapshot&&(e.snapshot=null),this.type&&(e.type=this.type.name),null!=this.version&&(e.v=this.version),this._create&&(e.create=!0),this.connection.send(e),this.state="opening",this._openCallback=function(e){return n._openCallback=null,"function"==typeof t?t(e):void 0}):void 0},t.prototype.close=function(t){return this.autoOpen=!1,"closed"===this.state?"function"==typeof t?t():void 0:(this.connection.send({doc:this.name,open:!1}),this.state="closed",this.emit("closing"),this._closeCallback=t)},t}(),("undefined"==typeof WEB||null===WEB)&&(i=require("./microevent")),i.mixin(n),h.Doc=n,r=function(){function t(t,e,n){var i,r,o=this;null!=e&&"function"==typeof e?(n=e,e=void 0):"function"!=typeof n&&(n=s),this.debug=this.debugAll,this.reconnectInterval=1e3,this.timeoutInterval=2e3,this.forcedClose=!1,this.url=t,this.protocols=e,this.readyState=n.CONNECTING,this.URL=t,r=!1,(i=function(t){var e;return o.ws=new n(o.url),o.debug&&console.debug("ReconnectingWebSocket","attempt-connect",o.url),e=setTimeout(function(){return o.debug&&console.debug("ReconnectingWebSocket","connection-timeout",o.url),r=!0,o.ws.close(),r=!1},o.timeoutInterval),o.ws.onopen=function(i){return clearTimeout(e),o.debug&&console.debug("ReconnectingWebSocket","onopen",o.url),o.readyState=n.OPEN,t=!1,o.onopen(i)},o.ws.onclose=function(s){
return clearTimeout(e),o.ws=null,o.forcedClose?(o.readyState=n.CLOSED,o.onclose(s)):(o.readyState=n.CONNECTING,o.onconnecting(s),t||r||(o.debug&&console.debug("ReconnectingWebSocket","onclose",o.url),o.onclose(s)),setTimeout(function(){return i(!0)},o.reconnectInterval))},o.ws.onmessage=function(t){return o.debug&&console.debug("ReconnectingWebSocket","onmessage",o.url,t.data),o.onmessage(t)},o.ws.onerror=function(t){return o.debug&&console.debug("ReconnectingWebSocket","onerror",o.url,t),o.onerror(t)}})(this.url)}return t.prototype.onopen=function(t){},t.prototype.onclose=function(t){},t.prototype.onconnecting=function(t){},t.prototype.onmessage=function(t){},t.prototype.onerror=function(t){},t.prototype.send=function(t){if(this.ws)return this.debug&&console.debug("ReconnectingWebSocket","send",this.url,t),this.ws.send(t);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},t.prototype.close=function(){return this.ws?(this.forcedClose=!0,this.ws.close()):void 0},t.prototype.debugAll=!1,t.prototype.refresh=function(){return this.ws?this.ws.close():void 0},t}(),"undefined"!=typeof WEB&&null!==WEB?(w=h.types,t=window.BCSocket,o=window.SockJS,s=window.WebSocket,g=t?"channel":o?"sockjs":"websocket"):(w=require("../types"),t=require("browserchannel").BCSocket,n=require("./doc").Doc,s=require("ws"),g=null),e=function(){function e(e,n){var i=this;this.docs={},this.state="connecting",null==g&&e.match(/^ws:/)&&(g="websocket"),this.socket=function(){switch(g){case"channel":return new t(e,{reconnect:!0});case"sockjs":return new r(e,o);case"websocket":return new r(e);default:return new t(e,{reconnect:!0})}}(),this.socket.onmessage=function(t){var e;return("sockjs"===g||"websocket"===g)&&(t=JSON.parse(t.data)),null===t.auth?(i.lastError=t.error,i.disconnect(),i.emit("connect failed",t.error)):t.auth?(i.id=t.auth,void i.setState("ok")):(e=t.doc,void 0!==e?i.lastReceivedDoc=e:t.doc=e=i.lastReceivedDoc,i.docs[e]?i.docs[e]._onMessage(t):"undefined"!=typeof console&&null!==console?console.error("Unhandled message",t):void 0)},this.connected=!1,this.socket.onclose=function(t){return i.setState("disconnected",t),"Closed"===t||"Stopped by server"===t?i.setState("stopped",i.lastError||t):void 0},this.socket.onerror=function(t){return i.emit("error",t)},this.socket.onopen=function(){return i.send({auth:n?n:null}),i.lastError=i.lastReceivedDoc=i.lastSentDoc=null,i.setState("handshaking")},this.socket.onconnecting=function(){return i.setState("connecting")}}return e.prototype.setState=function(t,e){var n,i,r,o;if(this.state!==t){this.state=t,"disconnected"===t&&delete this.id,this.emit(t,e),r=this.docs,o=[];for(i in r)n=r[i],o.push(n._connectionStateChanged(t,e));return o}},e.prototype.send=function(t){var e;return t.doc&&(e=t.doc,e===this.lastSentDoc?delete t.doc:this.lastSentDoc=e),("sockjs"===g||"websocket"===g)&&(t=JSON.stringify(t)),this.socket.send(t)},e.prototype.disconnect=function(){return this.socket.close()},e.prototype.makeDoc=function(t,e,i){var r,o=this;if(this.docs[t])throw new Error("Doc "+t+" already open");return r=new n(this,t,e),this.docs[t]=r,r.open(function(e){return e&&delete o.docs[t],e||r.on("closed",function(){return r.autoOpen?void 0:delete o.docs[t]}),i(e,e?void 0:r)})},e.prototype.openExisting=function(t,e){var n;return"stopped"===this.state?e("connection closed"):this.docs[t]?this._ensureOpenState(this.docs[t],e):n=this.makeDoc(t,{},e)},e.prototype.open=function(t,e,n){var i;if("stopped"===this.state)return n("connection closed");if("connecting"===this.state)return void this.on("handshaking",function(){return this.open(t,e,n),n=null});if("function"==typeof e&&(n=e,e="text"),n||(n=function(){}),"string"==typeof e&&(e=w[e]),!e)throw new Error("OT code for document type missing");if(null==t)throw new Error("Server-generated random doc names are not currently supported");return this.docs[t]?(i=this.docs[t],void(i.type===e?this._ensureOpenState(i,n):n("Type mismatch",i))):this.makeDoc(t,{create:!0,type:e.name},n)},e.prototype._ensureOpenState=function(t,e){switch(t.state){case"open":e(null,t);break;case"opening":this.on("open",function(){return e(null,t)});break;case"closed":t.open(function(n){return e(n,n?void 0:t)})}},e}(),("undefined"==typeof WEB||null===WEB)&&(i=require("./microevent")),i.mixin(e),h.Connection=e,"undefined"!=typeof WEB&&null!==WEB?(p=void 0!==window.BCSocket,d=void 0!==window.SockJS,g=p?"channel":d?"sockjs":"websocket"):e=require("./connection").Connection,h.open=function(){var t,n,i;return t={},n=function(n,i){var r,o,s,a;return"undefined"!=typeof WEB&&null!==WEB&&null==n&&(s=window.location,a="websocket"===g?"ws:":s.protocol,n=""+a+"//"+s.host+"/"+g),t[n]||(r=new e(n,i),o=function(){return delete t[n]},r.on("disconnected",o),r.on("connect failed",o),t[n]=r),t[n]},i=function(t){var e,n,i,r;i=0,r=t.docs;for(n in r)e=r[n],("closed"!==e.state||e.autoOpen)&&i++;return 0===i?t.disconnect():void 0},function(t,e,r,o){var s,a,l;return"function"==typeof r&&(o=r,r={}),"string"==typeof r&&(r={origin:r}),l=r.origin,s=r.authentication,a=n(l,s),a.open(t,e,function(t,e){return t?(o(t),i(a)):(e.on("closed",function(){return i(a)}),o(null,e))}),a.on("connect failed"),a}}(),("undefined"==typeof WEB||null===WEB)&&(h.Doc=require("./doc").Doc,h.Connection=require("./connection").Connection)}.call(this),function(){var t,e,n,i,r,o,s,a,l,c,u=!0,h=[].slice;i=window.sharejs,l="undefined"!=typeof u&&null!==u?i.types.text:require("./text"),s={},s.name="json",s.create=function(){return null},s.invertComponent=function(t){var e;return e={p:t.p},void 0!==t.si&&(e.sd=t.si),void 0!==t.sd&&(e.si=t.sd),void 0!==t.oi&&(e.od=t.oi),void 0!==t.od&&(e.oi=t.od),void 0!==t.li&&(e.ld=t.li),void 0!==t.ld&&(e.li=t.ld),void 0!==t.na&&(e.na=-t.na),void 0!==t.lm&&(e.lm=t.p[t.p.length-1],e.p=t.p.slice(0,t.p.length-1).concat([t.lm])),e},s.invert=function(t){var e,n,i,r,o;for(r=t.slice().reverse(),o=[],n=0,i=r.length;i>n;n++)e=r[n],o.push(s.invertComponent(e));return o},s.checkValidOp=function(t){},o=function(t){return"[object Array]"===Object.prototype.toString.call(t)},s.checkList=function(t){if(!o(t))throw new Error("Referenced element not a list")},s.checkObj=function(t){if(t.constructor!==Object)throw new Error("Referenced element not an object (it was "+JSON.stringify(t)+")")},s.apply=function(t,n){var i,r,o,a,l,c,u,h,p,d,f,m,g,y,_;s.checkValidOp(n),n=e(n),r={data:e(t)};try{for(c=f=0,g=n.length;g>f;c=++f){for(i=n[c],p=null,d=null,a=r,u="data",_=i.p,m=0,y=_.length;y>m;m++)if(h=_[m],p=a,d=u,a=a[u],u=h,null==p)throw new Error("Path invalid");if(void 0!==i.na){if("number"!=typeof a[u])throw new Error("Referenced element not a number");a[u]+=i.na}else if(void 0!==i.si){if("string"!=typeof a)throw new Error("Referenced element not a string (it was "+JSON.stringify(a)+")");p[d]=a.slice(0,u)+i.si+a.slice(u)}else if(void 0!==i.sd){if("string"!=typeof a)throw new Error("Referenced element not a string");if(a.slice(u,u+i.sd.length)!==i.sd)throw new Error("Deleted string does not match");p[d]=a.slice(0,u)+a.slice(u+i.sd.length)}else if(void 0!==i.li&&void 0!==i.ld)s.checkList(a),a[u]=i.li;else if(void 0!==i.li)s.checkList(a),a.splice(u,0,i.li);else if(void 0!==i.ld)s.checkList(a),a.splice(u,1);else if(void 0!==i.lm)s.checkList(a),i.lm!==u&&(o=a[u],a.splice(u,1),a.splice(i.lm,0,o));else if(void 0!==i.oi)s.checkObj(a),a[u]=i.oi;else{if(void 0===i.od)throw new Error("invalid / missing instruction in op");s.checkObj(a),delete a[u]}}}catch(v){throw l=v}return r.data},s.pathMatches=function(t,e,n){var i,r,o,s;if(t.length!==e.length)return!1;for(i=o=0,s=t.length;s>o;i=++o)if(r=t[i],r!==e[i]&&(!n||i!==t.length-1))return!1;return!0},s.append=function(t,n){var i;return n=e(n),0!==t.length&&s.pathMatches(n.p,(i=t[t.length-1]).p)?void 0!==i.na&&void 0!==n.na?t[t.length-1]={p:i.p,na:i.na+n.na}:void 0!==i.li&&void 0===n.li&&n.ld===i.li?void 0!==i.ld?delete i.li:t.pop():void 0!==i.od&&void 0===i.oi&&void 0!==n.oi&&void 0===n.od?i.oi=n.oi:void 0!==n.lm&&n.p[n.p.length-1]===n.lm?null:t.push(n):t.push(n)},s.compose=function(t,n){var i,r,o,a;for(s.checkValidOp(t),s.checkValidOp(n),r=e(t),o=0,a=n.length;a>o;o++)i=n[o],s.append(r,i);return r},s.normalize=function(t){var e,n,i,r,a;for(n=[],o(t)||(t=[t]),i=0,r=t.length;r>i;i++)e=t[i],null==(a=e.p)&&(e.p=[]),s.append(n,e);return n},e=function(t){return JSON.parse(JSON.stringify(t))},s.canOpAffectOp=function(t,e){var n,i,r,o;if(0===t.length)return!0;if(0===e.length)return!1;for(e=e.slice(0,e.length-1),t=t.slice(0,t.length-1),n=r=0,o=t.length;o>r;n=++r){if(i=t[n],n>=e.length)return!1;if(i!==e[n])return!1}return!0},s.transformComponent=function(t,n,i,r){var o,a,c,u,h,p,d,f,m,g,y,_,v,b,w,C,T,k,x;if(n=e(n),void 0!==n.na&&n.p.push(0),void 0!==i.na&&i.p.push(0),s.canOpAffectOp(i.p,n.p)&&(o=i.p.length-1),s.canOpAffectOp(n.p,i.p)&&(a=n.p.length-1),h=n.p.length,m=i.p.length,void 0!==n.na&&n.p.pop(),void 0!==i.na&&i.p.pop(),i.na)return null!=a&&m>=h&&i.p[a]===n.p[a]&&(void 0!==n.ld?(f=e(i),f.p=f.p.slice(h),n.ld=s.apply(e(n.ld),[f])):void 0!==n.od&&(f=e(i),f.p=f.p.slice(h),n.od=s.apply(e(n.od),[f]))),s.append(t,n),t;if(null!=a&&m>h&&n.p[a]===i.p[a]&&(void 0!==n.ld?(f=e(i),f.p=f.p.slice(h),n.ld=s.apply(e(n.ld),[f])):void 0!==n.od&&(f=e(i),f.p=f.p.slice(h),n.od=s.apply(e(n.od),[f]))),null!=o)if(c=h===m,void 0!==i.na);else if(void 0!==i.si||void 0!==i.sd){if(void 0!==n.si||void 0!==n.sd){if(!c)throw new Error("must be a string?");for(u=function(t){var e;return e={p:t.p[t.p.length-1]},null!=t.si?e.i=t.si:e.d=t.sd,e},w=u(n),C=u(i),v=[],l._tc(v,w,C,r),k=0,x=v.length;x>k;k++)b=v[k],d={p:n.p.slice(0,o)},d.p.push(b.p),null!=b.i&&(d.si=b.i),null!=b.d&&(d.sd=b.d),s.append(t,d);return t}}else if(void 0!==i.li&&void 0!==i.ld){if(i.p[o]===n.p[o]){if(!c)return t;if(void 0!==n.ld){if(void 0===n.li||"left"!==r)return t;n.ld=e(i.li)}}}else if(void 0!==i.li)void 0!==n.li&&void 0===n.ld&&c&&n.p[o]===i.p[o]?"right"===r&&n.p[o]++:i.p[o]<=n.p[o]&&n.p[o]++,void 0!==n.lm&&c&&i.p[o]<=n.lm&&n.lm++;else if(void 0!==i.ld){if(void 0!==n.lm&&c){if(i.p[o]===n.p[o])return t;_=i.p[o],p=n.p[o],T=n.lm,(T>_||_===T&&T>p)&&n.lm--}if(i.p[o]<n.p[o])n.p[o]--;else if(i.p[o]===n.p[o]){if(h>m)return t;if(void 0!==n.ld){if(void 0===n.li)return t;delete n.ld}}}else if(void 0!==i.lm)if(void 0!==n.lm&&h===m){if(p=n.p[o],T=n.lm,g=i.p[o],y=i.lm,g!==y)if(p===g){if("left"!==r)return t;n.p[o]=y,p===T&&(n.lm=y)}else p>g&&n.p[o]--,p>y?n.p[o]++:p===y&&g>y&&(n.p[o]++,p===T&&n.lm++),T>g?n.lm--:T===g&&T>p&&n.lm--,T>y?n.lm++:T===y&&(y>g&&T>p||g>y&&p>T?"right"===r&&n.lm++:T>p?n.lm++:T===g&&n.lm--)}else void 0!==n.li&&void 0===n.ld&&c?(p=i.p[o],T=i.lm,_=n.p[o],_>p&&n.p[o]--,_>T&&n.p[o]++):(p=i.p[o],T=i.lm,_=n.p[o],_===p?n.p[o]=T:(_>p&&n.p[o]--,_>T?n.p[o]++:_===T&&p>T&&n.p[o]++));else if(void 0!==i.oi&&void 0!==i.od){if(n.p[o]===i.p[o]){if(void 0===n.oi||!c)return t;if("right"===r)return t;n.od=i.oi}}else if(void 0!==i.oi){if(void 0!==n.oi&&n.p[o]===i.p[o]){if("left"!==r)return t;s.append(t,{p:n.p,od:i.oi})}}else if(void 0!==i.od&&n.p[o]===i.p[o]){if(!c)return t;if(void 0===n.oi)return t;delete n.od}return s.append(t,n),t},"undefined"!=typeof u&&null!==u?(i.types||(i.types={}),i._bt(s,s.transformComponent,s.checkValidOp,s.append),i.types.json=s):(module.exports=s,require("./helpers").bootstrapTransform(s,s.transformComponent,s.checkValidOp,s.append)),"undefined"==typeof u&&(s=require("./json")),"undefined"!=typeof u&&null!==u&&(r=i.extendDoc,i.extendDoc=function(e,n){return t.prototype[e]=n,r(e,n)}),n=function(t){return 1===t.length&&t[0].constructor===Array?t[0]:t},t=function(){function t(t,e){this.doc=t,this.path=e}return t.prototype.at=function(){var t;return t=1<=arguments.length?h.call(arguments,0):[],this.doc.at(this.path.concat(n(t)))},t.prototype.parent=function(){return this.path.length?this.doc.at(this.path.slice(0,this.path.length-1)):void 0},t.prototype.get=function(){return this.doc.getAt(this.path)},t.prototype.set=function(t,e){return this.doc.setAt(this.path,t,e)},t.prototype.insert=function(t,e,n){return this.doc.insertAt(this.path,t,e,n)},t.prototype.del=function(t,e,n){return this.doc.deleteTextAt(this.path,e,t,n)},t.prototype.remove=function(t){return this.doc.removeAt(this.path,t)},t.prototype.push=function(t,e){return this.insert(this.get().length,t,e)},t.prototype.move=function(t,e,n){return this.doc.moveAt(this.path,t,e,n)},t.prototype.add=function(t,e){return this.doc.addAt(this.path,t,e)},t.prototype.on=function(t,e){return this.doc.addListener(this.path,t,e)},t.prototype.removeListener=function(t){return this.doc.removeListener(t)},t.prototype.getLength=function(){return this.get().length},t.prototype.getText=function(){return this.get()},t}(),c=function(t,e){var n,i,r,o,s,a;for(n={data:t},r="data",i=n,s=0,a=e.length;a>s;s++)if(o=e[s],i=i[r],r=o,"undefined"==typeof i)throw new Error("bad path");return{elem:i,key:r}},a=function(t,e){var n,i,r,o;if(t.length!==e.length)return!1;for(i=r=0,o=t.length;o>r;i=++r)if(n=t[i],n!==e[i])return!1;return!0},s.api={provides:{json:!0},at:function(){var e;return e=1<=arguments.length?h.call(arguments,0):[],new t(this,n(e))},get:function(){return this.snapshot},set:function(t,e){return this.setAt([],t,e)},getAt:function(t){var e,n,i;return i=c(this.snapshot,t),e=i.elem,n=i.key,e[n]},setAt:function(t,e,n){var i,r,o,s;if(s=c(this.snapshot,t),i=s.elem,r=s.key,o={p:t},i.constructor===Array)o.li=e,"undefined"!=typeof i[r]&&(o.ld=i[r]);else{if("object"!=typeof i)throw new Error("bad path");o.oi=e,"undefined"!=typeof i[r]&&(o.od=i[r])}return this.submitOp([o],n)},removeAt:function(t,e){var n,i,r,o;if(o=c(this.snapshot,t),n=o.elem,i=o.key,"undefined"==typeof n[i])throw new Error("no element at that path");if(r={p:t},n.constructor===Array)r.ld=n[i];else{if("object"!=typeof n)throw new Error("bad path");r.od=n[i]}return this.submitOp([r],e)},insertAt:function(t,e,n,i){var r,o,s,a;return a=c(this.snapshot,t),r=a.elem,o=a.key,s={p:t.concat(e)},r[o].constructor===Array?s.li=n:"string"==typeof r[o]&&(s.si=n),this.submitOp([s],i)},moveAt:function(t,e,n,i){var r;return r=[{p:t.concat(e),lm:n}],this.submitOp(r,i)},addAt:function(t,e,n){var i;return i=[{p:t,na:e}],this.submitOp(i,n)},deleteTextAt:function(t,e,n,i){var r,o,s,a;return a=c(this.snapshot,t),r=a.elem,o=a.key,s=[{p:t.concat(n),sd:r[o].slice(n,n+e)}],this.submitOp(s,i)},addListener:function(t,e,n){var i;return i={path:t,event:e,cb:n},this._listeners.push(i),i},removeListener:function(t){var e;return e=this._listeners.indexOf(t),0>e?!1:(this._listeners.splice(e,1),!0)},_register:function(){return this._listeners=[],this.on("change",function(t){var e,n,i,r,o,s,a,l,c,u,h,p;for(p=[],a=0,c=t.length;c>a;a++)if(e=t[a],void 0===e.na&&void 0===e.si&&void 0===e.sd){for(o=[],h=this._listeners,i=l=0,u=h.length;u>l;i=++l)if(r=h[i],n={p:r.path,na:0},s=this.type.transformComponent([],n,e,"left"),0===s.length)o.push(i);else{if(1!==s.length)throw new Error("Bad assumption in json-api: xforming an 'si' op will always result in 0 or 1 components.");r.path=s[0].p}o.sort(function(t,e){return e-t}),p.push(function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)i=o[t],n.push(this._listeners.splice(i,1));return n}.call(this))}return p}),this.on("remoteop",function(t){var e,n,i,r,o,s,l,c,u;for(u=[],l=0,c=t.length;c>l;l++)e=t[l],o=void 0===e.na?e.p.slice(0,e.p.length-1):e.p,u.push(function(){var t,l,c,u,h;for(c=this._listeners,h=[],t=0,l=c.length;l>t;t++)if(u=c[t],s=u.path,r=u.event,n=u.cb,a(s,o))switch(r){case"insert":void 0!==e.li&&void 0===e.ld?h.push(n(e.p[e.p.length-1],e.li)):void 0!==e.oi&&void 0===e.od?h.push(n(e.p[e.p.length-1],e.oi)):void 0!==e.si?h.push(n(e.p[e.p.length-1],e.si)):h.push(void 0);break;case"delete":void 0===e.li&&void 0!==e.ld?h.push(n(e.p[e.p.length-1],e.ld)):void 0===e.oi&&void 0!==e.od?h.push(n(e.p[e.p.length-1],e.od)):void 0!==e.sd?h.push(n(e.p[e.p.length-1],e.sd)):h.push(void 0);break;case"replace":void 0!==e.li&&void 0!==e.ld?h.push(n(e.p[e.p.length-1],e.ld,e.li)):void 0!==e.oi&&void 0!==e.od?h.push(n(e.p[e.p.length-1],e.od,e.oi)):h.push(void 0);break;case"move":void 0!==e.lm?h.push(n(e.p[e.p.length-1],e.lm)):h.push(void 0);break;case"add":void 0!==e.na?h.push(n(e.na)):h.push(void 0);break;default:h.push(void 0)}else this.type.canOpAffectOp(s,o)&&"child op"===r?(i=e.p.slice(s.length),h.push(n(i,e))):h.push(void 0);return h}.call(this));return u})}}}.call(this),function(){var t;t=function(t,e,n){var i,r;if(e!==n){for(r=0;e.charAt(r)===n.charAt(r);)r++;for(i=0;e.charAt(e.length-1-i)===n.charAt(n.length-1-i)&&i+r<e.length&&i+r<n.length;)i++;return e.length!==r+i&&t.del(r,e.length-r-i),n.length!==r+i?t.insert(r,n.slice(r,n.length-i)):void 0}},window.sharejs.extendDoc("attach_textarea",function(e){var n,i,r,o,s,a,l,c,u,h,p=this;for(i=this,e.value=this.getText(),a=e.value,l=function(t,n){var i,r;return i=[n(e.selectionStart),n(e.selectionEnd)],r=e.scrollTop,e.value=t,e.scrollTop!==r&&(e.scrollTop=r),window.document.activeElement===e?(e.selectionStart=i[0],e.selectionEnd=i[1],i):void 0},this.on("insert",s=function(t,n){var i;return i=function(e){return e>t?e+n.length:e},a=e.value.replace(/\r\n/g,"\n"),l(a.slice(0,t)+n+a.slice(t),i)}),this.on("delete",n=function(t,n){var i;return i=function(e){return e>t?e-Math.min(n.length,e-t):e},a=e.value.replace(/\r\n/g,"\n"),l(a.slice(0,t)+a.slice(t+n.length),i)}),o=function(n){var r;return(r=function(t){return setTimeout(t,0)})(function(){return e.value!==a?(a=e.value,t(i,i.getText(),e.value.replace(/\r\n/g,"\n"))):void 0})},h=["textInput","keydown","keyup","select","cut","paste"],c=0,u=h.length;u>c;c++)r=h[c],e.addEventListener?e.addEventListener(r,o,!1):e.attachEvent("on"+r,o);return e.detach_share=function(){var t,i,a,l;for(p.removeListener("insert",s),p.removeListener("delete",n),a=["textInput","keydown","keyup","select","cut","paste"],l=[],t=0,i=a.length;i>t;t++)r=a[t],e.removeEventListener?l.push(e.removeEventListener(r,o,!1)):l.push(e.detachEvent("on"+r,o));return l}})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};TC.SectionSubdocument=function(){function e(e){this._handleDelete=t(this._handleDelete,this),this._handleInsert=t(this._handleInsert,this),_.extend(this,Backbone.Events),this.subdocument=e,this._contentSubdocument().on("insert",this._handleInsert),this._contentSubdocument().on("delete",this._handleDelete)}return e.prototype.relocate=function(t){return this.subdocument=this.subdocument.doc.at("sections",t)},e.prototype.index=function(){return this.subdocument.path[1]},e.prototype.remove=function(){return this.subdocument.remove()},e.prototype.getName=function(){return this.subdocument.get().name},e.prototype.getContent=function(){return this.subdocument.get().content},e.prototype.removeContent=function(t){return this._contentSubdocument().at(t).remove()},e.prototype.insertContent=function(t){return this._contentSubdocument().insert(t.position,t.contentId)},e.prototype._handleInsert=function(t,e){return this.trigger("insert",t,e)},e.prototype._handleDelete=function(t,e){return this.trigger("delete",t)},e.prototype._contentSubdocument=function(){var t;return t=this.subdocument.path.slice(),t.push("content"),void 0===this.subdocument.get().content&&this.subdocument.doc.submitOp({p:t,oi:[]}),this.subdocument.at("content")},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};TC.SectionListSubdocument=function(){function e(e){this.each=t(this.each,this),this.move=t(this.move,this),_.extend(this,Backbone.Events),this.subdocument=e,this.subdocument.doc.on("change",function(t){return function(e){return _.each(e,function(e){return 2===e.p.length&&"sections"===e.p[0]?(e.li&&t.trigger("insert",e.p[1],new TC.SectionSubdocument(t.subdocument.at(e.p[1]))),e.ld?t.trigger("delete",e.p[1]):void 0):void 0})}}(this)),this.subdocument.on("move",function(t){return function(e,n){return t.trigger("move",e,n)}}(this))}return e.prototype.move=function(t,e){return this.subdocument.move(t,e)},e.prototype.each=function(t){return _.each(this.subdocument.get(),function(e){return function(n,i){return t(new TC.SectionSubdocument(e.subdocument.at(i)))}}(this))},e.prototype.create=function(t){return this.subdocument.insert(0,t)},e}()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};TC.CampaignDocument=function(){function e(e){this._subdocument=t(this._subdocument,this),_.extend(this,Backbone.Events),this.doc=e,null==this.doc.snapshot&&this.doc.submitOp({p:[],od:null,oi:{}}),this.doc.at().on("child op",function(t){return function(){return t.trigger("change")}}(this))}return e.pathFor=function(t){var e,n;return n=t.closest(".campaign-section-view"),n.length?(e=[],e[3]=t.index(),e[2]="content",e[1]=n.index(),e[0]="sections",e):null},e.prototype.attachEditorsNoteTo=function(t){var e;return e=this._subdocument("editors_note"),e.attach_textarea(t)},e.prototype.getSectionListSubdocument=function(){var t;return t=this._subdocument("sections",[]),new TC.SectionListSubdocument(t)},e.prototype._subdocument=function(t,e){return null==e&&(e=""),void 0===this.doc.get()[t]&&this.doc.submitOp({p:[t],oi:e}),this.doc.at(t)},e}()}.call(this),function(){TC.CampaignDocumentConnection=function(){function t(t){var e;_.extend(this,Backbone.Events),e=new sharejs.Connection(""+TC.config.sharejsUrl+"/channel"),e.once("ok",function(n){return function(){return console.log(t),e.open(t,"json",function(t,e){return console.log(t),console.log("sharejs:connected"),n.trigger("sharejs:connected",e)}),e.on("ok",function(){return console.log("sharejs:reconnected"),n.trigger("sharejs:reconnected")})}}(this)),e.on("error",function(t){return function(e){return console.log("sharejs:disconnected"),t.trigger("sharejs:disconnected",e)}}(this))}return t}()}.call(this),function(){navigator.platform.match("Win")&&/WebKit/.test(navigator.userAgent)&&$(document.body).css("font-family","helvetica, arial, sans-serif")}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ControlView=function(e){function i(){return this._click=t(this._click,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.delay=5e3,i.prototype.initialize=function(t){return $(this.el).click(this._click)},i.prototype.disabled=function(t,e){var n;return null==e&&(e=!1),n=$(this.el).hasClass("disabled"),null!=t&&t!==n?($(this.el).toggleClass("disabled",t),e||this.trigger("change:disabled",this,t),t):n},i.prototype.state=function(t,e){var n;return null==e&&(e=!1),n=$(this.el).hasClass("on"),null!=t&&t!==n?($(this.el).toggleClass("on",t),e||this.trigger("change:state",this,t),t):n},i.prototype.visible=function(t,e){var n;return null==e&&(e=!1),n=$(this.el).is(":visible"),null!=t?(t?$(this.el).show():$(this.el).hide(),e||t===n||this.trigger("change:visible",this,t),t):n},i.prototype.hide=function(){return this.visible(!1)},i.prototype.show=function(){return this.visible(!0)},i.prototype.toggleEnabled=function(){var t;return t=this.disabled(),this.disabled(!t)},i.prototype.toggleState=function(){var t;return t=this.state(),this.state(!t)},i.prototype._click=function(t){var e;return t&&(e=$(t.target).attr("href"),e&&"#"===e&&t.preventDefault()),this.disabled()?void 0:this.trigger("click",this,t)},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.ButtonView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="button",n.prototype.tagName="a",n.prototype.initialize=function(t){return null==t&&(t={}),this.action=t.action,this.label=t.label,this.title=t.title,this.icon=t.icon,null==this.title&&this.label&&(this.title=this.label),this.render(),n.__super__.initialize.call(this,t)},n.prototype.render=function(){return this.$el.attr("href","#"),null!=this.action&&this.$el.attr("data-action",this.action),null!=this.label&&this.$el.html(this.label),null!=this.title&&this.$el.attr("title",this.title),null!=this.icon?this.$el.prepend('<i class="'+this.icon+'"></i> '):void 0},n.prototype.setTitle=function(t){return this.title=t,this.label=t,this.render()},n}(TC.ControlView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.SpinnerView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="yet-another-spinner",n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),null!=t&&(t.size&&this.$el.css("font-size",t.size),null!=t.centered==!0&&this.$el.addClass("centered"),null!=t.fixed==!0&&this.$el.addClass("fixed"),t.backgroundColor&&t.foregroundColor&&(this.$el.css("border-color",t.backgroundColor),this.$el.css("border-top-color",t.foregroundColor))),this.render()},n.prototype.show=function(t){return this.$el.show(),this.visible()?"function"==typeof t?t():void 0:(_.defer(function(t){return function(){return t.$el.removeClass("hidden")}}(this)),null!=t?_.delay(t,500):void 0)},n.prototype.hide=function(t){return this.visible()?(_.defer(function(t){return function(){return t.$el.addClass("hidden")}}(this)),null!=t&&_.delay(t,500)):"function"==typeof t&&t(),_.delay(function(t){return function(){return t.$el.hide()}}(this),500)},n.prototype.visible=function(){return!this.$el.hasClass("hidden")},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.SuperLightboxView=function(e){function i(){return this._keydown=t(this._keydown,this),this._click=t(this._click,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.className="lightbox",i.prototype.tagName="section",i.prototype.leaveWhenEscapePressed=!0,i.prototype.leaveWhenMaskClicked=!0,i.prototype.escapeKeyCode=27,i.prototype.initialize=function(t){return null==t&&(t={}),this.bindings=[],this._bindTo($(document),"keydown",this._keydown),this.build(),i.__super__.initialize.call(this,t)},i.prototype.build=function(){return this.$innerEl=$('<div class="lightbox-inner"></div>').appendTo(this.el),this.innerEl=this.$innerEl.get(0),$("body").addClass("lightbox-open")},i.prototype._click=function(t){var e,n;return e=$(t.target),n=e.attr("href"),n&&"#"===n&&t.preventDefault(),this.leaveWhenMaskClicked&&e.is(".lightbox")&&this.visible()?this._leave():i.__super__._click.call(this,t)},i.prototype._keydown=function(t){return this.leaveWhenEscapePressed&&t.keyCode===this.escapeKeyCode&&this.visible()?(t.preventDefault(),this._leave()):void 0},i.prototype._leave=function(t){return t&&t.preventDefault(),this._unbindFromAll(),this.off(),this.remove(),$("body").removeClass("lightbox-open")},i.prototype._bindTo=function(t,e,n){return t.bind(e,n),this.bindings.push({source:t,event:e,callback:n})},i.prototype._unbindFromAll=function(){return _.each(this.bindings,function(t){return t.source.unbind(t.event,t.callback)}),this.bindings=[]},i}(TC.ControlView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.ShowUpdatedAtLightboxView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="lightbox clearfix",n.prototype.events={"click a.yes":"_showAndRepublish","click a.no":"_republish","click a.close":"_leave"},n.prototype.template=_.template('<div>\n  <h2 class="page-header"><%- i18n.t(\'draft.heading.significant_update\') %></h2>\n  <p><%- i18n.t(\'draft.label.updated_at_question\') %></p>\n</div>\n<footer class="button-row">\n  <a href="#" class="button primary green no"><%- i18n.t(\'draft.button.no\') %></a>\n  <a href="#" class="button primary green yes"><%- i18n.t(\'draft.button.yes\') %></a>\n  <a href="#" class="button secondary close"><%- i18n.t(\'draft.button.cancel\') %></a>\n</footer>'),n.prototype.initialize=function(t){return null==t&&(t={}),n.__super__.initialize.call(this,t),this.draft=t.draft,this.render(),this.spinnerYes=new TC.SpinnerView({foregroundColor:"#ccc",backgroundColor:"#aaa"}),this.spinnerYes.hide(function(t){return function(){return t.spinnerYes.prependedTo(t.$el.find(".button.primary.yes"))}}(this)),this.spinnerNo=new TC.SpinnerView({foregroundColor:"#ccc",backgroundColor:"#aaa"}),this.spinnerNo.hide(function(t){return function(){return t.spinnerNo.prependedTo(t.$el.find(".button.primary.no"))}}(this))},n.prototype.render=function(){return $(this.innerEl).html(this.template()),n.__super__.render.call(this)},n.prototype._showAndRepublish=function(){return $(this.innerEl).find(".button.primary").addClass("disabled"),this.spinnerYes.show(function(t){return function(){return t.draft.finalise("republish",!0)}}(this))},n.prototype._republish=function(){return $(this.innerEl).find(".button.primary").addClass("disabled"),this.spinnerNo.show(function(t){return function(){return t.draft.finalise("republish")}}(this))},n}(TC.SuperLightboxView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.DraftRepublishButtonView=function(e){function i(){return this.render=t(this.render,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return this.draft=t.draft,this.render()},i.prototype.render=function(){return this.republishButtonView=new TC.ButtonView({label:i18n.t("draft.button.republish"),className:"primary dark green button"}),this.republishButtonView.$el.append(" \u2192"),this.$el.append(this.republishButtonView.$el),this.listenTo(this.republishButtonView,"click",function(){return new TC.ShowUpdatedAtLightboxView({draft:this.draft}).appendedTo(document.body)})},i.prototype.setState=function(t){return"published"===t?this.republishButtonView.$el.show():this.republishButtonView.$el.hide()},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.DraftPublishButtonView=function(e){function i(){return this.render=t(this.render,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return this.draft=t.draft,this.render()},i.prototype.render=function(){return this.publishButtonView=new TC.ButtonView({label:i18n.t("draft.button.publish"),className:"primary dark green button"}),this.publishButtonView.$el.append(" \u2192"),this.$el.append(this.publishButtonView.$el),this.listenTo(this.publishButtonView,"click",function(){return this.draft.finalise("publish")})},i.prototype.setState=function(t){return"published"!==t?this.publishButtonView.$el.show():this.publishButtonView.$el.hide()},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.EditorPostActionButtonsView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="editor-post-action-buttons actions-button",n.prototype.initialize=function(t){return this.draft=t.draft,this.render()},n.prototype.render=function(){return this.republishButton=new TC.DraftRepublishButtonView({draft:this.draft}),this.$el.append(this.republishButton.$el),this.publishButton=new TC.DraftPublishButtonView({draft:this.draft}),this.$el.append(this.publishButton.$el),this.approvalOptionsButton=new TC.DraftEditorApprovalOptionsButtonView({draft:this.draft}),this.$el.append(this.approvalOptionsButton.$el)},n.prototype.setState=function(t){return this.republishButton.setState(t),this.publishButton.setState(t),this.approvalOptionsButton.setState(t)},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,
e.__super__=n.prototype,e};TC.AuthorSelfPublishingPostActionButtonsView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="editor-post-action-buttons actions-button",n.prototype.initialize=function(t){return this.draft=t.draft,this.render()},n.prototype.render=function(){return this.republishButton=new TC.DraftRepublishButtonView({draft:this.draft}),this.$el.append(this.republishButton.$el),this.publishButton=new TC.DraftPublishButtonView({draft:this.draft}),this.$el.append(this.publishButton.$el)},n.prototype.setState=function(t){return this.republishButton.setState(t),this.publishButton.setState(t)},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.AuthorPostActionButtonsView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return this.draft=t.draft,this.render()},n.prototype.render=function(){return this.approvalOptionsButton=new TC.DraftAuthorApprovalOptionsButtonView({draft:this.draft}),this.$el.append(this.approvalOptionsButton.$el)},n.prototype.setState=function(t){return this.approvalOptionsButton.setState(t)},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.DraftFinishButtonView=function(e){function i(){return this.render=t(this.render,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return this.draft=t.draft,this.render()},i.prototype.render=function(){return this.finishButtonView=new TC.ButtonView({label:i18n.t("draft.button.finish"),className:"primary dark green button"}),this.finishButtonView.$el.append(" \u2192"),this.listenTo(this.finishButtonView,"click",function(){return this.draft.finalise("finish")}),this.$el.html(this.finishButtonView.$el)},i.prototype.setState=function(t){return"published"===t?this.finishButtonView.$el.hide():this.finishButtonView.$el.show()},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.AuthorApprovalView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="submit-for-publication lightbox clearfix",n.prototype.events={"click footer a[data-action=close]":"_leave","click footer a[data-action=submit]":"_submit"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.render(),this.submitButtonEl=$("a[data-action=submit]",this.el)},n.prototype.render=function(){return $(this.innerEl).html(this.template()),n.__super__.render.call(this)},n.prototype.template=_.template('<header>\n  <hgroup>\n    <h1><%- i18n.t(\'draft_approval.title.approve_for_publication\') %></h1>\n  </hgroup>\n</header>\n<div class="clearfix">\n  <p><%- i18n.t(\'draft_approval.blurb.send_a_note\') %></p>\n  <p><strong><%= i18n.t(\'draft_approval.blurb.please_ensure\', {\n    terms_and_conditions: i18n.t(\'draft_approval.label.terms_and_conditions\')\n  })%></strong></p>\n  <textarea name="note" class="note" value="" placeholder=""></textarea>\n</div>\n<footer class="button-row">\n  <a href="#" data-action="close" class="button secondary"><%- i18n.t(\'draft_approval.button.close\') %></a>\n  <a href="#" data-action="submit" class="button primary"><%- i18n.t(\'draft_approval.button.accept_approve\') %></a>\n</footer>'),n.prototype._submit=function(){return this.submitButtonEl.hasClass("disabled")?void 0:this.trigger("approval:submit",$("textarea.note").val())},n}(TC.SuperLightboxView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.DisclosureErrorLightboxView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="add-interviewee lightbox clearfix",n.prototype.events={"click a.close":"_leave"},n.prototype.template=_.template('<div>\n  <h2 class="page-header">Cannot approve draft yet</h2>\n  <p>The following collaborators have not submitted a disclosure statement yet:</p>\n  <ul><%= collaborators_missing_disclosure %></ul>\n</div>\n<footer class="button-row">\n  <a href="#" class="close button">Close</a>\n</footer>'),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.collaborators_missing_disclosure=_.select(t.collaborators.authors(),function(t){return null===t.get("disclosure")}),this.render()},n.prototype.render=function(){return $(this.innerEl).html(this.template({collaborators_missing_disclosure:this._markupFor(this.collaborators_missing_disclosure)}))},n.prototype._markupFor=function(t){return _.map(t,function(t){return"<li>"+_.escape(t.get("full_name"))+"</li>"}).join("\n")},n}(TC.SuperLightboxView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.DraftApprovalOptionsButtonView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return this.draft=t.draft,this.render()},n.prototype.render=function(){return this.approvalButtonView=new TC.ButtonView({label:i18n.t("draft.button.approvals"),className:"button primary dark green"}),this.approvalButtonView.$el.append(" \u25be"),this.listenTo(this.approvalButtonView,"click",function(){return publish("/toggle/draftApprovalOptions",[]),!1}),this.$el.append(this.approvalButtonView.$el)},n}(Backbone.View)}.call(this),function(){var t,e,n;t=null,e=function(){return $("p.flash").animate({top:"-200px"},1e3,function(){return $(this).remove()})},n=function(){return $("p.flash").css({top:"-200px"}).show().animate({top:"0px"},500).click(e),null!=t&&clearTimeout(t),t=setTimeout(e,5e3)},$.flash=function(t,e){return $("<p class='flash "+t+"'>"+_.escape(e)+"</p>").appendTo("body").hide(),n()},$(function(){var t,e,i,r,o;for(n(),t=["notice","alert","warning"],o=[],i=0,r=t.length;r>i;i++)e=t[i],$.cookie("flash_"+e)?($.flash(e,unescape($.cookie("flash_"+e).replace(/\+/g," "))),o.push($.removeCookie("flash_"+e))):o.push(void 0);return o})}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.RequestApprovalView=function(e){function i(){return this._handleApprovalFailure=t(this._handleApprovalFailure,this),this._handleApprovalSuccess=t(this._handleApprovalSuccess,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.className="request-approval lightbox clearfix",i.prototype.events={"click footer a[data-action=close]":"_leave","click footer a[data-action=submit]":"_handleSubmit"},i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.render(),this.model.on("draft:editorRequestApproval:success",this._handleApprovalSuccess),this.model.on("draft:editorRequestApproval:failure",this._handleApprovalFailure),this.spinner=new TC.SpinnerView({foregroundColor:"#ccc",backgroundColor:"#aaa"}),this.spinner.hide(function(t){return function(){return t.spinner.prependedTo(t.$el.find(".button.primary"))}}(this))},i.prototype.render=function(){return $(this.innerEl).html(this.template({approval_requested_at:this.approvalRequestedAt()})),i.__super__.render.call(this)},i.prototype.template=_.template('<header>\n  <hgroup>\n    <h1><%- i18n.t(\'draft_approval.title.request_approval\') %></h1>\n  </hgroup>\n</header>\n<div class="clearfix">\n  <p class="approval-required"><%- i18n.t(\'draft_approval.blurb.lead_author_reapproval\') %></p>\n  <p><%- i18n.t(\'draft_approval.blurb.approval_last_requested\', { last_approval_time: approval_requested_at }) %></p>\n  <textarea name="note" class="note" value="" placeholder=""></textarea>\n</div>\n<footer class="button-row">\n  <a href="#" data-action="close" class="button secondary"><%- i18n.t(\'draft_approval.button.close\') %></a>\n  <a href="#" data-action="submit" class="button primary"><%- i18n.t(\'draft_approval.button.request_approval\') %></a>\n</footer>'),i.prototype.approvalRequestedAt=function(){return null!=this.model.get("approval_requested_at")?TC.time.formatted(this.model.get("approval_requested_at"),"tc_date_with_time"):i18n.t("draft_approval.label.never")},i.prototype._leave=function(t){return this.model.off("draft:editorRequestApproval:success",this._handleApprovalSuccess),this.model.off("draft:editorRequestApproval:failure",this._handleApprovalFailure),i.__super__._leave.call(this,t)},i.prototype._handleSubmit=function(){return $(this.innerEl).find(".button.primary").addClass("disabled"),this.spinner.show(function(t){return function(){var e;return e=$("textarea.note").val(),t.model.editorRequestApproval(e)}}(this))},i.prototype._handleApprovalSuccess=function(t){return $.flash("notice",t.message),this._leave()},i.prototype._handleApprovalFailure=function(t){return this.spinner.hide(function(e){return function(){var n;return $(e.innerEl).find(".button.primary").removeClass("disabled"),n="Could not submit your request for approval, try again in a moment.",t&&t.message&&(n=t.message),$.flash("alert",n)}}(this))},i}(TC.SuperLightboxView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.DraftRequestApprovalButtonView=function(e){function i(){return this.render=t(this.render,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return this.draft=t.draft,this.render()},i.prototype.render=function(){return this.requestApprovalButtonView=new TC.ButtonView({label:"",className:"button primary dark reverse"}),this.$el.append(this.requestApprovalButtonView.$el),this.listenTo(this.requestApprovalButtonView,"click",function(t){return function(){return t._clickRequestApprovalButton()}}(this))},i.prototype._clickRequestApprovalButton=function(){var t;return this.trigger("approvalButtonsWrapper:close"),t=new TC.RequestApprovalView({model:this.draft}).appendedTo(document.body)},i.prototype.setState=function(t){var e;return e="authorApproved"===t?i18n.t("draft.button.re_request_approval"):i18n.t("draft.button.request_approval"),this.requestApprovalButtonView.setTitle(e)},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.VerbalApprovalView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="verbal-approval lightbox clearfix",n.prototype.events={"click footer a[data-action=close]":"_leave","click footer a[data-action=submit]":"_verbalApproval"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.render()},n.prototype.render=function(){return $(this.innerEl).html(this.template()),n.__super__.render.call(this)},n.prototype.template=_.template('<header>\n  <hgroup>\n    <h1><%- i18n.t(\'draft_approval.title.verbal_approval\') %></h1>\n  </hgroup>\n</header>\n<div class="verbal-warning clearfix">\n  <p class="warning"><%- i18n.t(\'draft_approval.blurb.with_great_power\') %></p>\n  <p><%- i18n.t(\'draft_approval.blurb.editor_acknowledgement\', { editor_name: TC.currentUser.get("full_name")}) %></p>\n  <textarea class="note" value="" placeholder="" name="note"></textarea>\n</div>\n<footer class="button-row">\n  <a href="#" data-action="close" class="button secondary"><%- i18n.t(\'draft_approval.button.close\') %></a>\n  <a href="#" data-action="submit" class="button primary"><%- i18n.t(\'draft_approval.button.submit\') %></a>\n</footer>'),n.prototype._verbalApproval=function(){return this.trigger("approval:submit",$("textarea.note").val()),this._leave()},n}(TC.SuperLightboxView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.DraftVerbalApprovalButtonView=function(e){function i(){return this.render=t(this.render,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return this.draft=t.draft,this.render()},i.prototype.render=function(){return this.verbalApprovalButtonView=new TC.ButtonView({label:i18n.t("draft.button.verbal_approval"),className:"button primary dark reverse"}),this.$el.append(this.verbalApprovalButtonView.$el),this.listenTo(this.verbalApprovalButtonView,"click",function(t){return function(){return t._clickVerbalApprovalButton()}}(this))},i.prototype._clickVerbalApprovalButton=function(){var t;return this.trigger("approvalButtonsWrapper:close"),t=new TC.VerbalApprovalView({model:this.draft}).appendedTo(document.body),t.on("approval:submit",function(t){return function(e){return t.draft.verballyApprove(e)}}(this))},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.DraftEditorApprovalOptionsButtonView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return this.draft=t.draft,this.render()},n.prototype.render=function(){return this.approvalButtonsWrapper=$('<div class="approval-buttons tooltip bottom"></div>'),this.$el.html(this.approvalButtonsWrapper),this._initApprovalOptionsButton(),this._initRequestApprovalButton(),this._initVerbalApprovalButton()},n.prototype._initApprovalOptionsButton=function(){return this.approvalOptionsButton=new TC.DraftApprovalOptionsButtonView({draft:this.draft}),this.$el.append(this.approvalOptionsButton.$el),subscribe("/toggle/draftApprovalOptions",function(t){return function(){return t.approvalButtonsWrapper.toggleClass("show")}}(this))},n.prototype._initVerbalApprovalButton=function(){return this.verbalApprovalButton=new TC.DraftVerbalApprovalButtonView({draft:this.draft}),this.approvalButtonsWrapper.append(this.verbalApprovalButton.$el),this.listenTo(this.verbalApprovalButton,"approvalButtonsWrapper:close",function(){return this.approvalButtonsWrapper.removeClass("show")})},n.prototype._initRequestApprovalButton=function(){return this.requestApprovalButton=new TC.DraftRequestApprovalButtonView({draft:this.draft}),this.approvalButtonsWrapper.append(this.requestApprovalButton.$el),this.listenTo(this.requestApprovalButton,"approvalButtonsWrapper:close",function(){return this.approvalButtonsWrapper.removeClass("show")})},n.prototype.setState=function(t){return this.requestApprovalButton.setState(t),"approvalRequired"===t||"approvalRequested"===t||"authorApproved"===t?this.approvalOptionsButton.$el.show():this.approvalOptionsButton.$el.hide()},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.EditorAnalysisActionButtonsView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="editor-analysis-action-buttons actions-button",n.prototype.initialize=function(t){return this.draft=t.draft,this.render()},n.prototype.render=function(){return this.republishButton=new TC.DraftRepublishButtonView({draft:this.draft}),this.$el.append(this.republishButton.$el),this.finishButton=new TC.DraftFinishButtonView({draft:this.draft}),this.$el.append(this.finishButton.$el),this.approvalOptionsButton=new TC.DraftEditorApprovalOptionsButtonView({draft:this.draft}),this.$el.append(this.approvalOptionsButton.$el)},n.prototype.setState=function(t){return this.republishButton.setState(t),this.finishButton.setState(t),this.approvalOptionsButton.setState(t)},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.DraftAuthorApproveButtonView=function(e){function i(){return this._clickApprovalButton=t(this._clickApprovalButton,this),this.render=t(this.render,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return this.draft=t.draft,this.render()},i.prototype.render=function(){return this.approvalButtonView=new TC.ButtonView({label:i18n.t("draft.button.approve"),className:"button primary dark green",icon:"icon-simple-check"}),this.approvalButtonView.on("click",this._clickApprovalButton),this.$el.append(this.approvalButtonView.$el)},i.prototype._clickApprovalButton=function(){var t;return this.draft.collaborators.attributableHaveDisclosure()?(t=(new TC.AuthorApprovalView).appendedTo(document.body),t.on("approval:submit",function(t){return function(e){return t.draft.authorApprove(e)}}(this))):new TC.DisclosureErrorLightboxView({collaborators:this.draft.collaborators}).appendedTo(document.body)},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.SubmitForPublicationView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="submit-for-publication lightbox clearfix",n.prototype.events={"click footer a[data-action=close]":"_leave","click footer a[data-action=submit]":"_submit"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.render(),this.submitButtonEl=$("a[data-action=submit]",this.el)},n.prototype.render=function(){return $(this.innerEl).html(this.template()),n.__super__.render.call(this)},n.prototype.template=_.template('<header>\n  <hgroup>\n    <h1><%- i18n.t(\'draft_approval.title.submit_for_publication\') %></h1>\n  </hgroup>\n</header>\n<div class="clearfix">\n  <p><%- i18n.t(\'draft_approval.blurb.note_to_editor\') %></p>\n  <textarea name="note" class="note" value="" placeholder=""></textarea>\n</div>\n<footer class="button-row">\n  <a href="#" data-action="close" class="button secondary"><%- i18n.t(\'draft_approval.button.close\') %></a>\n  <a href="#" data-action="submit" class="button primary"><%- i18n.t(\'draft_approval.button.submit\') %></a>\n</footer>'),n.prototype._submit=function(){return this.submitButtonEl.hasClass("disabled")?void 0:this.trigger("review:submit",$("textarea.note").val())},n}(TC.SuperLightboxView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.DraftAuthorSubmitToEditorButtonView=function(e){function i(){return this._clickAuthorSubmitToEditorButton=t(this._clickAuthorSubmitToEditorButton,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return this.draft=t.draft,this.render()},i.prototype.render=function(){return this.authorSubmitToEditorButtonView=new TC.ButtonView({label:i18n.t("draft.button.submit_to_editor"),className:"button primary dark green",icon:"icon-simple-check"}),this.authorSubmitToEditorButtonView.on("click",this._clickAuthorSubmitToEditorButton),this.$el.append(this.authorSubmitToEditorButtonView.$el)},i.prototype._clickAuthorSubmitToEditorButton=function(){var t;return t=(new TC.SubmitForPublicationView).appendedTo(document.body),t.on("review:submit",function(t){return function(e){return t.draft.authorSubmitToEditor(e)}}(this))},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.DraftAuthorApprovalOptionsButtonView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return this.draft=t.draft,this.render()},n.prototype.render=function(){return this._isLeadAuthor()?(this._initAuthorApprovalButton(),this._initAuthorSubmitToEditorButton()):void 0},n.prototype._initAuthorApprovalButton=function(){return this.authorApproveButtonView=new TC.DraftAuthorApproveButtonView({draft:this.draft}),this.$el.append(this.authorApproveButtonView.$el)},n.prototype._initAuthorSubmitToEditorButton=function(){return this.authorSubmitToEditorButtonView=new TC.DraftAuthorSubmitToEditorButtonView({draft:this.draft}),this.$el.append(this.authorSubmitToEditorButtonView.$el)},n.prototype._currentCollaborator=function(){return this.draft.collaborators.get(TC.currentUser.id)||new TC.Collaborator({type:TC.currentUser.get("type")})},n.prototype._isLeadAuthor=function(){return this._currentCollaborator().isLeadAuthor()},n.prototype.setState=function(t){return this._isLeadAuthor()?"approvalRequested"===t||"authorApproved"===t?(this.authorApproveButtonView.$el.show(),this.authorSubmitToEditorButtonView.$el.hide()):(this.authorApproveButtonView.$el.hide(),this.authorSubmitToEditorButtonView.$el.show()):void 0},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.AuthorAnalysisActionButtonsView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return this.draft=t.draft,this.render()},n.prototype.render=function(){return this.approvalOptionsButton=new TC.DraftAuthorApprovalOptionsButtonView({draft:this.draft}),this.$el.append(this.approvalOptionsButton.$el)},n.prototype.setState=function(t){return this.approvalOptionsButton.setState(t)},n}(Backbone.View)}.call(this),function(){TC.DraftHeaderActions=function(){function t(){}return t["for"]=function(t,e){return e.isPost()?t.isEditor()?new TC.EditorPostActionButtonsView({draft:e}):e.isPostAndSelfPublishable()?new TC.AuthorSelfPublishingPostActionButtonsView({draft:e}):new TC.AuthorPostActionButtonsView({draft:e}):t.isEditor()?new TC.EditorAnalysisActionButtonsView({draft:e}):new TC.AuthorAnalysisActionButtonsView({draft:e})},t}()}.call(this),function(){TC.DraggableContentSummaryLoader=function(){function t(){}return t.fetch=function(t,e){return $.getJSON("/content/"+t+"/summary.json",function(t){return function(t){return e(t.full_html)}}(this))},t}()}.call(this),function(){$.easing.tcEaseOut=function(t,e,n,i,r){var o,s;return s=(e/=r)*e,o=s*e,n+i*(o+-3*s+3*e)},$(function(){var t,e,n,i,r,o,s,a,l,c,u,h;return h=$("window"),t=$("body"),e=$("html, body"),r=$(".expand-gallery"),c="function"==typeof window.history.pushState,r.length?(o=r[0].href,a=function(e){return t.append('<div class="gallery-cover hidden loading"></div>'),t.append('<div class="gallery-content hidden"><div class="gallery-content-inner">'+e+'<a href="#" class="button subtle dark close-gallery">Close</a></div></div>')},u=function(){return $(".gallery-cover, .gallery-content").remove()},l=function(t,e){var n,i;return null==e&&(e=!1),i=new RegExp("^"+document.location.href),i.test(t)&&!e?(a($(".expandomatic").html()),n=function(){return $(".gallery-cover, .gallery-content").removeClass("hidden loading")},setTimeout(n,10)):(a(""),$(".gallery-content-inner").load(""+t+" .expandomatic",function(){return $(this).append('<a href="#" class="button subtle dark close-gallery">Close</a>'),n=function(){return $(".gallery-cover, .gallery-content").removeClass("hidden loading")},setTimeout(n,10)}))},i=function(){return $("body").css("overflow","auto")},n=function(){return $("body").css("overflow","hidden")},c&&window.addEventListener("popstate",function(t){return document.location.href===o?l(o,!0):u()},!1),r.click(function(t){return t.preventDefault(),l(this.href),c&&history.pushState({},this.href,this.href),n()}),t.delegate(".gallery-cover, .gallery-content","click",function(t){return"IMG"!==t.target.nodeName&&"FIGCAPTION"!==t.target.nodeName?(t.stopPropagation(),t.preventDefault(),e.stop(),c&&history.back(1),u(),i()):void 0}),t.delegate(".gallery-item","click",function(){var t,e;return t=$(this),e=t.is(":last-child")?0:"+="+(t.outerHeight()+20),$("div.gallery-content").animate({scrollTop:e},750,"tcEaseOut")}),"#fullscreen"===document.location.hash?(s=document.location.href.replace(/#.+$/,""),c&&history.pushState({},s,s),r.click()):void 0):void 0})}.call(this),function(){$.truncate=function(t,e){return t.length>e?t.substring(0,e)+"...":t},$.titleCase=function(t){return t.replace(/\w\S*/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},$.authenticityToken=function(){return $("meta[name=csrf-token]").attr("content")},$.makeAjaxSpinner=function(){return $('<img src="/assets/loading-b8d1ebc89097cf762f5bdad895b1a1c70747be99bb37999de38ebc844eb1cdf6.gif" alt="Waiting" />')},$.timestamp=function(t){return(t||new Date).getTime()},$.fn.toggleDisabled=function(){return this.each(function(){return this.disabled=!this.disabled})}}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};$.fn.imagebox=function(){return new t(this)},t=function(){function t(t){this.showImagebox=e(this.showImagebox,this),$(t).append('<div class="enlarge_hint"></div>').click(function(t){return function(e){return e.preventDefault(),t.showImagebox($(e.currentTarget).find("a").attr("href"))}}(this))}return t.prototype.loadImage=function(t,e){var n;return n=$(new Image),n.attr("src",t),n.imagesLoaded(function(){return n.appendTo("body").hide().data("dimensions",{x:n.width(),y:n.height()}),e(n)})},t.prototype.showImagebox=function(t){return $("div.imagebox").remove(),$("<div />").addClass("imagebox").append($("<img />").addClass("spinner").data("dimensions",{x:16,y:16}).attr("src",this.spinnerImageData())).appendTo("body").click(function(){return $(this).remove()}),this.positionImagebox(),this.loadImage(t,function(t){return function(e){return $("div.imagebox").html(e.addClass("appearing").show()).click(function(){return $(window).unbind("resize",this.positionImagebox)}),setTimeout(function(){return $("div.imagebox img").removeClass("appearing")},10),t.positionImagebox(),$(window).resize(t.positionImagebox)}}(this))},t.prototype.positionImagebox=function(){var t,e,n,i,r,o;return n=18,t=$("div.imagebox img"),e=t.data("dimensions"),i={x:$(window).width()-n-n,y:$(window).height()-n-n},r={orig:e.x/e.y,page:i.x/i.y},o=r.orig>=r.page?i.x:i.x*r.orig/r.page,o>e.x&&(o=e.x),t.css({width:o+"px",left:Math.max(n,n+(i.x-o)/2)+"px",top:Math.max(n,n+(i.y-o/r.orig)/2)+"px"})},t.prototype.spinnerImageData=function(){return"data:image/gif;base64,R0lGODlhEAAQAPcAAMzMzMvLy8rKyoKCgpqamrq6uo6Ojr6+vpGRkaampsfH x8jIyMbGxra2tsLCwqKiosTExLKyspaWlomJibe3t5+fn8PDw5CQkK6uroaG hoqKiri4uJ2dnaqqqpubm42NjZ6enqSkpK+vr4iIiKysrJSUlK2trb29vcnJ ycXFxby8vLCwsKenp5eXl6Ojo5KSkoODg7m5uZmZmZOTk4WFhcDAwMHBwZiY mGJiYoSEhJycnIeHh6CgoIuLi7W1tZWVlaurq7GxsYyMjEJCQm5ubrOzs3t7 e2ZmZnZ2dkZGRnJycnNzc39/f1JSUmlpaUpKSj4+Pnl5eV1dXWNjY3p6ek5O TigoKF9fX3BwcFlZWbS0tFVVVUNDQ29vb7+/v1hYWH5+fnh4eHx8fGFhYSIi IlZWVnFxcWtra2xsbFRUVDo6Oh4eHmpqal5eXh8fHzAwMDw8PHV1dUFBQURE RGhoaB0dHSAgIAAAAKGhoXR0dDk5OUhISEdHR21tbVdXVxwcHEVFRUtLSzc3 NysrK1paWoGBgT8/PwQEBKWlpRcXFwUFBXd3dyMjIykpKRgYGAwMDBUVFSUl JWdnZ0lJSY+PjxISEhAQELu7uzIyMqioqFtbW1BQUCEhIS0tLSwsLA4ODkxM TE1NTQICAmVlZampqRsbG319fYCAgDU1NQYGBi8vLzY2NgoKCjQ0NFFRUSoq KmBgYP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAAAACwA AAAAEAAQAAAI1AABCAQgQGAJLgUHKgSwwU8HAEYqCVhQQsRCAAUagQIQJxGA BANiKNxQAMAFOy2I/AkB4wGABQUCCJC0pwWEJ0pYvMjxIcWGCxkYAIhwRs6V FEIJLuAxAEEDhQ9yJBzYwcRACTByZNBy0UIFAgQeZFCiZFGEiw5KGDBwY2AD FgEWRng6kAEHMRpQLGwxQIcDAAFmDHDhtYMFG0UkQDCRYYQCACI2YByA4QEC CgOAAKiBYaoCAxcCcNAAAESOAxcLTKAAwMOEABB6kLgYIGkICXEVTA0IACH5 BAUAAAAALAAAAAANAAsAAAhrAAEIHAiACiGCAxtcWQHgyysADODIGKjiyREA Ut4AQHKnAgAKBwB44OIBBxwMhzQJjOLEBYMpTAAQyLBGhcANA6ZEYbBA4AIH MwgC+REAoUAXLV4giGFUIAEDBhAUaErwQASqABQkoCGEakAAIfkEBQAAAAAs AAAAABAACAAACGoAAQgcCGBCF4IIAcSIQgFAnyoAHDyRkLCGEyYAlDTJaEcH wQIOACTA0YHKFhJk2ABQEETghR0YFBj5EcGFAUEAOvB55AXAAQIDLihAIVCA hSmKrCAIMLBBgoRokAwMQYAAiAMJCxiRITAgACH5BAUAAAAALAMAAAANAAoA AAhmAAEEAADgRgaCCAmqQFAAAA00ACA4SYAQwggEAHYQATDAEIuEEQaQ0NBl xRAmACxEALBiwQ8dDUjIKAMABJRWKQC8QCGg4ig7Q1okHErl4NChDdCYidLj KMEVbzi5geIUwAcJCAMCACH5BAkAAAAALAUAAAALAA0AAAhrAAEAYCEjgMCD AA4A8DAiAAMwHQ5KAMAhA4ASY1Yg9FGhUIMpLwCk0CIwwYkVLvLUSJAlEEKB DKLIaePipUANIW0KLEAnSxosNrUkUaMni00DFXQCCKDmTyGFCE1saoDEUhIG Nm8AAEIFQEAAIfkEBQAAAAAsAAAAABAAEAAACJcAAQgcCICFjAAEEwo8AMDD hAALSohQKFACAA4aACQYsIEigAE+Knw4AeMBAAYNEBL8keAEhSBCHGCIQydF QhQCBApQoAFHGBMKVQ70wMOjwgNGiJxhYlRgDBxZyhBJKFQgAhAeURAMUGWN lCIKK3Sw0GBEkgIDrFixSXAAhgddZtxBAACDgZxGA5Uq0HRgA0d0+wp0QDAg ACH5BAUAAAAALAYAAgAKAA4AAAhmAAEIHBhjoMGBCwoc/JBiw4UMDAwu4DHg Q4SDAB48wCjQiwYaMBAcPEFlyRIaBz2E4AjAyRAzFADAKILhRRUAL/hUYSDk S5IKbsAA8LFRwCQoANqQIWFwDtINem4YxHFFAICIAwMCACH5BAkAAAAALAMA BQANAAsAAAhpAAEIHEgQQQOCCDuYQMjQQgUCBB4wFOhlxIQPNwAsRJiABEFA EBAOwJHhBIASWlyFaRCBw5EDeI6wEUgAEiU6XEIM+QCgQAIAXsi0ASAFEwAk QyIMBPFmBYAvnQSoaAJioICQAJZsmRgQACH5BAUAAAAALAAAAAAQABAAAAiW AAEIHEiwoMGDCBMqXMiw4IAXKAQIFLCAxwAEDQg2SBCgYAcTBkEcMGihAgEC DwZmIGHQQQkDBm4MTDBAIsEIGQfawJGKUYqCEgbocABAgCpWRgrgEHMpRgdT DkhkGKEAwIwgAB6smSBGCgYcHgDUwGATgA04UATkqQJAw5QNBjsMIgAAy5MA NYikLBjAgkAYTiQyKBsQACH5BAUAAAAALAAABgANAAoAAAhjAAEIBGFEgMCD AnHIGRLKBUKER5IA2sPhoUUTBiwiNBMJFYOHLQQ2qdMnRhgNB1SQkADBBAA8 FTsMmfEBiYhTQBBa+EIowA4iAFrkOHCwQZMQAGicAeCgBwmEHwFIYCJQAYCA ACH5BAUAAAAALAAAAwALAA0AAAhrAAHwiACABYCDCAE8+QTGwRYOCQEUUFLH kwMUEQ9W6JJxSRk/V0hlhCVIzZwHGRGKIJDSAo0kTRRkPGIIzAEDBGzYKHIQ UQIAEXBUkIGAwgCEKZbEAdBCAwAQCCmwwQCAwAQAEFKGkBAAQEAAIfkEBQAA AAAsAAAAAAgADwAACGgAAQgEIGDgwBVWWBgEYKPOqoEkfAAAIeqDAQBDBk2A wGUMBgAk0riZA2GBQQ9LBsIgggWJiIFY0myRQmIhgAYJAgxkIOEIEZMCjYxB UINDBwsAMn2MMQDDg4EKDFwAwGFggQkUAHgICAA7"},t}()}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};$.fn.inlineEdit=function(e,n){return new t(this,e,n)},t=function(){function t(t,n,i){this.container=n,this.options=i,this.editField=e(this.editField,this),$(this.container).delegate(t.selector,"click",function(t){return function(e){var n;return n=$(e.currentTarget),t.editField(n)}}(this)),this.addPlaceholdertext(t),$(this.container).bind("elements-added",function(e){return function(n,i){return e.addPlaceholdertext($(i).find(t.selector))}}(this))}return t.prototype.isBlank=function(t){return!(null!=t&&""!==t.trim())},t.prototype.addPlaceholdertext=function(t){return t.each(function(t){return function(e,n){return t.isBlank($(n).text())?($(n).data("raw",$(n).text()),$(n).text("Click to add "+t.options.type)):void 0}}(this))},t.prototype.editField=function(t){var e,n,i,r;return this.container.find(":focus").blur(),e="rgb(255, 255, 255)"===t.css("color")?"#383838":t.css("color"),r=parseInt(t.css("margin-top"))-3,i={width:""+t.width()+"px",height:""+(t.height()+4)+"px","margin-top":""+r+"px","font-family":t.css("font-family"),"font-size":t.css("font-size"),"font-style":t.css("font-style"),"font-weight":t.css("font-weight"),"line-height":t.css("line-height"),color:e},t.hide(),n=this,$("<"+(this.options.input||'input type="text"')+" id='inline-editing' />").insertAfter(t).val(t.data("edited")||t.data("raw")).css(i).select().blur(function(){return publish("page:changed"),
t.data("edited",$(this).val()),t.text(t.data("edited")||t.data("raw")),n.addPlaceholdertext(t),t.removeAttr("style"),$(this).remove()})},t}()}.call(this),function(){TC.PageEditArticleSearcher=function(){function t(t){this.defaultsUrl="/editorial/pages/"+t+"/scheduled_content",this.searchUrl="/editorial/pages/"+t+"/placeable_content"}return t.prototype.fetch=function(t){return null==t&&(t={}),$.ajax({url:this.defaultsUrl,dataType:"html",error:function(){return t.error(i18n.t("draft.message.could_not_load_scheduled_content"))},success:function(e){return t.success(e)}})},t.prototype.search=function(t){return null==t&&(t={}),$.ajax({url:this.searchUrl,dataType:"html",data:t.data,error:function(){return t.error(i18n.t("draft.message.search_error"))},success:function(e){return t.success(e)}})},t}()}.call(this),function(){$("input[placeholder]").placeholder()}.call(this),function(){TC.RelatedArticleSearcher=function(){function t(t){this.search_url="/drafts/"+t+"/related_articles/search",this.suggested_url="/drafts/"+t+"/related_articles/recommended"}return t.prototype.fetch=function(t){return null==t&&(t={}),$.ajax({url:this.suggested_url,dataType:"html",error:function(){return t.error("Couldn't load scheduled content.")},success:function(e){return t.success(e)}})},t.prototype.search=function(t){return null==t&&(t={}),$.ajax({url:this.search_url,dataType:"html",method:"post",data:t.data,error:function(){return t.error("Search error, please try again later.")},success:function(e){return t.success(e)}})},t}()}.call(this),function(t,e){function n(e,n){var r,o,s,a=e.nodeName.toLowerCase();return"area"===a?(r=e.parentNode,o=r.name,e.href&&o&&"map"===r.nodeName.toLowerCase()?(s=t("img[usemap=#"+o+"]")[0],!!s&&i(s)):!1):(/input|select|textarea|button|object/.test(a)?!e.disabled:"a"===a?e.href||n:n)&&i(e)}function i(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}var r=0,o=/^ui-id-\d+$/;t.ui=t.ui||{},t.extend(t.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({focus:function(e){return function(n,i){return"number"==typeof n?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),i&&i.call(e)},n)}):e.apply(this,arguments)}}(t.fn.focus),scrollParent:function(){var e;return e=t.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(n){if(n!==e)return this.css("zIndex",n);if(this.length)for(var i,r,o=t(this[0]);o.length&&o[0]!==document;){if(i=o.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(r=parseInt(o.css("zIndex"),10),!isNaN(r)&&0!==r))return r;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){o.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(n){return!!t.data(n,e)}}):function(e,n,i){return!!t.data(e,i[3])},focusable:function(e){return n(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var i=t.attr(e,"tabindex"),r=isNaN(i);return(r||i>=0)&&n(e,!r)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(n,i){function r(e,n,i,r){return t.each(o,function(){n-=parseFloat(t.css(e,"padding"+this))||0,i&&(n-=parseFloat(t.css(e,"border"+this+"Width"))||0),r&&(n-=parseFloat(t.css(e,"margin"+this))||0)}),n}var o="Width"===i?["Left","Right"]:["Top","Bottom"],s=i.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+i]=function(n){return n===e?a["inner"+i].call(this):this.each(function(){t(this).css(s,r(this,n)+"px")})},t.fn["outer"+i]=function(e,n){return"number"!=typeof e?a["outer"+i].call(this,e):this.each(function(){t(this).css(s,r(this,e,!0,n)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(n){return arguments.length?e.call(this,t.camelCase(n)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.support.selectstart="onselectstart"in document.createElement("div"),t.fn.extend({disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.extend(t.ui,{plugin:{add:function(e,n,i){var r,o=t.ui[e].prototype;for(r in i)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([n,i[r]])},call:function(t,e,n){var i,r=t.plugins[e];if(r&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(i=0;i<r.length;i++)t.options[r[i][0]]&&r[i][1].apply(t.element,n)}},hasScroll:function(e,n){if("hidden"===t(e).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",r=!1;return e[i]>0?!0:(e[i]=1,r=e[i]>0,e[i]=0,r)}})}(jQuery),function(t,e){function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.dpDiv=i(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function i(e){var n="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(n,"mouseout",function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).delegate(n,"mouseover",function(){t.datepicker._isDisabledDatepicker(o.inline?e.parent()[0]:o.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))})}function r(e,n){t.extend(e,n);for(var i in n)null==n[i]&&(e[i]=n[i]);return e}t.extend(t.ui,{datepicker:{version:"1.10.4"}});var o,s="datepicker";t.extend(n.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return r(this._defaults,t||{}),this},_attachDatepicker:function(e,n){var i,r,o;i=e.nodeName.toLowerCase(),r="div"===i||"span"===i,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),r),o.settings=t.extend({},n||{}),"input"===i?this._connectDatepicker(e,o):r&&this._inlineDatepicker(e,o)},_newInst:function(e,n){var r=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:r,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:n,dpDiv:n?i(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,n){var i=t(e);n.append=t([]),n.trigger=t([]),i.hasClass(this.markerClassName)||(this._attachments(i,n),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(n),t.data(e,s,n),n.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,n){var i,r,o,s=this._get(n,"appendText"),a=this._get(n,"isRTL");n.append&&n.append.remove(),s&&(n.append=t("<span class='"+this._appendClass+"'>"+s+"</span>"),e[a?"before":"after"](n.append)),e.unbind("focus",this._showDatepicker),n.trigger&&n.trigger.remove(),i=this._get(n,"showOn"),("focus"===i||"both"===i)&&e.focus(this._showDatepicker),("button"===i||"both"===i)&&(r=this._get(n,"buttonText"),o=this._get(n,"buttonImage"),n.trigger=t(this._get(n,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:r,title:r}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:r,title:r}):r)),e[a?"before":"after"](n.trigger),n.trigger.click(function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,n,i,r,o=new Date(2009,11,20),s=this._get(t,"dateFormat");s.match(/[DM]/)&&(e=function(t){for(n=0,i=0,r=0;r<t.length;r++)t[r].length>n&&(n=t[r].length,i=r);return i},o.setMonth(e(this._get(t,s.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,n){var i=t(e);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(n.dpDiv),t.data(e,s,n),this._setDate(n,this._getDefaultDate(n),!0),this._updateDatepicker(n),this._updateAlternate(n),n.settings.disabled&&this._disableDatepicker(e),n.dpDiv.css("display","block"))},_dialogDatepicker:function(e,n,i,o,a){var l,c,u,h,p,d=this._dialogInst;return d||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),t("body").append(this._dialogInput),d=this._dialogInst=this._newInst(this._dialogInput,!1),d.settings={},t.data(this._dialogInput[0],s,d)),r(d.settings,o||{}),n=n&&n.constructor===Date?this._formatDate(d,n):n,this._dialogInput.val(n),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(c=document.documentElement.clientWidth,u=document.documentElement.clientHeight,h=document.documentElement.scrollLeft||document.body.scrollLeft,p=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[c/2-100+h,u/2-150+p]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],s,d),this},_destroyDatepicker:function(e){var n,i=t(e),r=t.data(e,s);i.hasClass(this.markerClassName)&&(n=e.nodeName.toLowerCase(),t.removeData(e,s),"input"===n?(r.append.remove(),r.trigger.remove(),i.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===n||"span"===n)&&i.removeClass(this.markerClassName).empty())},_enableDatepicker:function(e){var n,i,r=t(e),o=t.data(e,s);r.hasClass(this.markerClassName)&&(n=e.nodeName.toLowerCase(),"input"===n?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===n||"span"===n)&&(i=r.children("."+this._inlineClass),i.children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var n,i,r=t(e),o=t.data(e,s);r.hasClass(this.markerClassName)&&(n=e.nodeName.toLowerCase(),"input"===n?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===n||"span"===n)&&(i=r.children("."+this._inlineClass),i.children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;e<this._disabledInputs.length;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,s)}catch(n){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(n,i,o){var s,a,l,c,u=this._getInst(n);return 2===arguments.length&&"string"==typeof i?"defaults"===i?t.extend({},t.datepicker._defaults):u?"all"===i?t.extend({},u.settings):this._get(u,i):null:(s=i||{},"string"==typeof i&&(s={},s[i]=o),void(u&&(this._curInst===u&&this._hideDatepicker(),a=this._getDateDatepicker(n,!0),l=this._getMinMaxDate(u,"min"),c=this._getMinMaxDate(u,"max"),r(u.settings,s),null!==l&&s.dateFormat!==e&&s.minDate===e&&(u.settings.minDate=this._formatDate(u,l)),null!==c&&s.dateFormat!==e&&s.maxDate===e&&(u.settings.maxDate=this._formatDate(u,c)),"disabled"in s&&(s.disabled?this._disableDatepicker(n):this._enableDatepicker(n)),this._attachments(t(n),u),this._autoSize(u),this._setDate(u,a),this._updateAlternate(u),this._updateDatepicker(u))))},_changeDatepicker:function(t,e,n){this._optionDatepicker(t,e,n)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var n=this._getInst(t);n&&(this._setDate(n,e),this._updateDatepicker(n),this._updateAlternate(n))},_getDateDatepicker:function(t,e){var n=this._getInst(t);return n&&!n.inline&&this._setDateFromField(n,e),n?this._getDate(n):null},_doKeyDown:function(e){var n,i,r,o=t.datepicker._getInst(e.target),s=!0,a=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),s=!1;break;case 13:return r=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),r[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,r[0]),n=t.datepicker._get(o,"onSelect"),n?(i=t.datepicker._formatDate(o),n.apply(o.input?o.input[0]:null,[i,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),s=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),s=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,a?1:-1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),s=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,a?-1:1,"D"),s=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),s=e.ctrlKey||e.metaKey;break;default:s=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):s=!1;s&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var n,i,r=t.datepicker._getInst(e.target);return t.datepicker._get(r,"constrainInput")?(n=t.datepicker._possibleChars(t.datepicker._get(r,"dateFormat")),i=String.fromCharCode(null==e.charCode?e.keyCode:e.charCode),e.ctrlKey||e.metaKey||" ">i||!n||n.indexOf(i)>-1):void 0},_doKeyUp:function(e){var n,i=t.datepicker._getInst(e.target);if(i.input.val()!==i.lastVal)try{n=t.datepicker.parseDate(t.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,t.datepicker._getFormatConfig(i)),n&&(t.datepicker._setDateFromField(i),t.datepicker._updateAlternate(i),t.datepicker._updateDatepicker(i))}catch(r){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var n,i,o,s,a,l,c;n=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==n&&(t.datepicker._curInst.dpDiv.stop(!0,!0),n&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),i=t.datepicker._get(n,"beforeShow"),o=i?i.apply(e,[e,n]):{},o!==!1&&(r(n.settings,o),n.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(n),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),s=!1,t(e).parents().each(function(){return s|="fixed"===t(this).css("position"),!s}),a={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,n.dpDiv.empty(),n.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(n),a=t.datepicker._checkOffset(n,a,s),n.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":s?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px"}),n.inline||(l=t.datepicker._get(n,"showAnim"),c=t.datepicker._get(n,"duration"),n.dpDiv.zIndex(t(e).zIndex()+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[l]?n.dpDiv.show(l,t.datepicker._get(n,"showOptions"),c):n.dpDiv[l||"show"](l?c:null),t.datepicker._shouldFocusInput(n)&&n.input.focus(),t.datepicker._curInst=n))}},_updateDatepicker:function(e){this.maxRows=4,o=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var n,i=this._getNumberOfMonths(e),r=i[1],s=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),r>1&&e.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",s*r+"em"),e.dpDiv[(1!==i[0]||1!==i[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(n=e.yearshtml,setTimeout(function(){n===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),n=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,n,i){var r=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),s=e.input?e.input.outerWidth():0,a=e.input?e.input.outerHeight():0,l=document.documentElement.clientWidth+(i?0:t(document).scrollLeft()),c=document.documentElement.clientHeight+(i?0:t(document).scrollTop());return n.left-=this._get(e,"isRTL")?r-s:0,n.left-=i&&n.left===e.input.offset().left?t(document).scrollLeft():0,n.top-=i&&n.top===e.input.offset().top+a?t(document).scrollTop():0,n.left-=Math.min(n.left,n.left+r>l&&l>r?Math.abs(n.left+r-l):0),n.top-=Math.min(n.top,n.top+o>c&&c>o?Math.abs(o+a):0),n},_findPos:function(e){for(var n,i=this._getInst(e),r=this._get(i,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[r?"previousSibling":"nextSibling"];return n=t(e).offset(),[n.left,n.top]},_hideDatepicker:function(e){var n,i,r,o,a=this._curInst;!a||e&&a!==t.data(e,s)||this._datepickerShowing&&(n=this._get(a,"showAnim"),i=this._get(a,"duration"),r=function(){t.datepicker._tidyDialog(a)},t.effects&&(t.effects.effect[n]||t.effects[n])?a.dpDiv.hide(n,t.datepicker._get(a,"showOptions"),i,r):a.dpDiv["slideDown"===n?"slideUp":"fadeIn"===n?"fadeOut":"hide"](n?i:null,r),n||r(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var n=t(e.target),i=t.datepicker._getInst(n[0]);(n[0].id!==t.datepicker._mainDivId&&0===n.parents("#"+t.datepicker._mainDivId).length&&!n.hasClass(t.datepicker.markerClassName)&&!n.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||n.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==i)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,n,i){var r=t(e),o=this._getInst(r[0]);this._isDisabledDatepicker(r[0])||(this._adjustInstDate(o,n+("M"===i?this._get(o,"showCurrentAtPos"):0),i),this._updateDatepicker(o))},_gotoToday:function(e){var n,i=t(e),r=this._getInst(i[0]);this._get(r,"gotoCurrent")&&r.currentDay?(r.selectedDay=r.currentDay,r.drawMonth=r.selectedMonth=r.currentMonth,r.drawYear=r.selectedYear=r.currentYear):(n=new Date,r.selectedDay=n.getDate(),r.drawMonth=r.selectedMonth=n.getMonth(),r.drawYear=r.selectedYear=n.getFullYear()),this._notifyChange(r),this._adjustDate(i)},_selectMonthYear:function(e,n,i){var r=t(e),o=this._getInst(r[0]);o["selected"+("M"===i?"Month":"Year")]=o["draw"+("M"===i?"Month":"Year")]=parseInt(n.options[n.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(r)},_selectDay:function(e,n,i,r){var o,s=t(e);t(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||(o=this._getInst(s[0]),o.selectedDay=o.currentDay=t("a",r).html(),o.selectedMonth=o.currentMonth=n,o.selectedYear=o.currentYear=i,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var n=t(e);this._selectDate(n,"")},_selectDate:function(e,n){var i,r=t(e),o=this._getInst(r[0]);n=null!=n?n:this._formatDate(o),o.input&&o.input.val(n),this._updateAlternate(o),i=this._get(o,"onSelect"),i?i.apply(o.input?o.input[0]:null,[n,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var n,i,r,o=this._get(e,"altField");o&&(n=this._get(e,"altFormat")||this._get(e,"dateFormat"),i=this._getDate(e),r=this.formatDate(n,i,this._getFormatConfig(e)),t(o).each(function(){t(this).val(r)}))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,n=new Date(t.getTime());return n.setDate(n.getDate()+4-(n.getDay()||7)),e=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((e-n)/864e5)/7)+1},parseDate:function(e,n,i){if(null==e||null==n)throw"Invalid arguments";if(n="object"==typeof n?n.toString():n+"",""===n)return null;var r,o,s,a,l=0,c=(i?i.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),h=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,p=(i?i.dayNames:null)||this._defaults.dayNames,d=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,f=(i?i.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,y=-1,_=-1,v=!1,b=function(t){var n=r+1<e.length&&e.charAt(r+1)===t;return n&&r++,n},w=function(t){var e=b(t),i="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,r=new RegExp("^\\d{1,"+i+"}"),o=n.substring(l).match(r);if(!o)throw"Missing number at position "+l;return l+=o[0].length,parseInt(o[0],10)},C=function(e,i,r){var o=-1,s=t.map(b(e)?r:i,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(s,function(t,e){var i=e[1];return n.substr(l,i.length).toLowerCase()===i.toLowerCase()?(o=e[0],l+=i.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+l},T=function(){if(n.charAt(l)!==e.charAt(r))throw"Unexpected literal at position "+l;l++};for(r=0;r<e.length;r++)if(v)"'"!==e.charAt(r)||b("'")?T():v=!1;else switch(e.charAt(r)){case"d":y=w("d");break;case"D":C("D",h,p);break;case"o":_=w("o");break;case"m":g=w("m");break;case"M":g=C("M",d,f);break;case"y":m=w("y");break;case"@":a=new Date(w("@")),m=a.getFullYear(),g=a.getMonth()+1,y=a.getDate();break;case"!":a=new Date((w("!")-this._ticksTo1970)/1e4),m=a.getFullYear(),g=a.getMonth()+1,y=a.getDate();break;case"'":b("'")?T():v=!0;break;default:T()}if(l<n.length&&(s=n.substr(l),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===m?m=(new Date).getFullYear():100>m&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=m?0:-100)),_>-1)for(g=1,y=_;;){if(o=this._getDaysInMonth(m,g-1),o>=y)break;g++,y-=o}if(a=this._daylightSavingAdjust(new Date(m,g-1,y)),a.getFullYear()!==m||a.getMonth()+1!==g||a.getDate()!==y)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(t,e,n){if(!e)return"";var i,r=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,o=(n?n.dayNames:null)||this._defaults.dayNames,s=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,a=(n?n.monthNames:null)||this._defaults.monthNames,l=function(e){var n=i+1<t.length&&t.charAt(i+1)===e;return n&&i++,n},c=function(t,e,n){var i=""+e;if(l(t))for(;i.length<n;)i="0"+i;return i},u=function(t,e,n,i){return l(t)?i[e]:n[e]},h="",p=!1;if(e)for(i=0;i<t.length;i++)if(p)"'"!==t.charAt(i)||l("'")?h+=t.charAt(i):p=!1;else switch(t.charAt(i)){case"d":h+=c("d",e.getDate(),2);break;case"D":h+=u("D",e.getDay(),r,o);break;case"o":h+=c("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":h+=c("m",e.getMonth()+1,2);break;case"M":h+=u("M",e.getMonth(),s,a);break;case"y":h+=l("y")?e.getFullYear():(e.getYear()%100<10?"0":"")+e.getYear()%100;break;case"@":h+=e.getTime();break;case"!":h+=1e4*e.getTime()+this._ticksTo1970;break;case"'":l("'")?h+="'":p=!0;break;default:h+=t.charAt(i)}return h},_possibleChars:function(t){var e,n="",i=!1,r=function(n){var i=e+1<t.length&&t.charAt(e+1)===n;return i&&e++,i};for(e=0;e<t.length;e++)if(i)"'"!==t.charAt(e)||r("'")?n+=t.charAt(e):i=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":n+="0123456789";break;case"D":case"M":return null;case"'":r("'")?n+="'":i=!0;break;default:n+=t.charAt(e)}return n},_get:function(t,n){return t.settings[n]!==e?t.settings[n]:this._defaults[n]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var n=this._get(t,"dateFormat"),i=t.lastVal=t.input?t.input.val():null,r=this._getDefaultDate(t),o=r,s=this._getFormatConfig(t);try{o=this.parseDate(n,i,s)||r}catch(a){i=e?"":i}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=i?o.getDate():0,t.currentMonth=i?o.getMonth():0,t.currentYear=i?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,n,i){var r=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(n){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),n,t.datepicker._getFormatConfig(e))}catch(i){}for(var r=(n.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=r.getFullYear(),s=r.getMonth(),a=r.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,c=l.exec(n);c;){switch(c[2]||"d"){case"d":case"D":a+=parseInt(c[1],10);break;case"w":case"W":a+=7*parseInt(c[1],10);break;case"m":case"M":s+=parseInt(c[1],10),a=Math.min(a,t.datepicker._getDaysInMonth(o,s));break;case"y":case"Y":o+=parseInt(c[1],10),a=Math.min(a,t.datepicker._getDaysInMonth(o,s))}c=l.exec(n)}return new Date(o,s,a)},s=null==n||""===n?i:"string"==typeof n?o(n):"number"==typeof n?isNaN(n)?i:r(n):new Date(n.getTime());return s=s&&"Invalid Date"===s.toString()?i:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,n){var i=!e,r=t.selectedMonth,o=t.selectedYear,s=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=s.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=s.getMonth(),t.drawYear=t.selectedYear=t.currentYear=s.getFullYear(),r===t.selectedMonth&&o===t.selectedYear||n||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(i?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var n=this._get(e,"stepMonths"),i="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(i,-n,"M")},next:function(){t.datepicker._adjustDate(i,+n,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(i)},selectDay:function(){return t.datepicker._selectDay(i,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(i,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(i,this,"Y"),!1}};t(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,n,i,r,o,s,a,l,c,u,h,p,d,f,m,g,y,_,v,b,w,C,T,k,x,S,A,D,P,E,$,M,V,I,L,B,O,N,z,R=new Date,F=this._daylightSavingAdjust(new Date(R.getFullYear(),R.getMonth(),R.getDate())),H=this._get(t,"isRTL"),Y=this._get(t,"showButtonPanel"),U=this._get(t,"hideIfNoPrevNext"),W=this._get(t,"navigationAsDateFormat"),j=this._getNumberOfMonths(t),q=this._get(t,"showCurrentAtPos"),G=this._get(t,"stepMonths"),X=1!==j[0]||1!==j[1],K=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-q,tt=t.drawYear;if(0>Z&&(Z+=12,tt--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-j[0]*j[1]+1,J.getDate())),e=Q&&Q>e?Q:e;this._daylightSavingAdjust(new Date(tt,Z,1))>e;)Z--,0>Z&&(Z=11,tt--);for(t.drawMonth=Z,t.drawYear=tt,n=this._get(t,"prevText"),n=W?this.formatDate(n,this._daylightSavingAdjust(new Date(tt,Z-G,1)),this._getFormatConfig(t)):n,i=this._canAdjustMonth(t,-1,tt,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(H?"e":"w")+"'>"+n+"</span></a>":U?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(H?"e":"w")+"'>"+n+"</span></a>",
r=this._get(t,"nextText"),r=W?this.formatDate(r,this._daylightSavingAdjust(new Date(tt,Z+G,1)),this._getFormatConfig(t)):r,o=this._canAdjustMonth(t,1,tt,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(H?"w":"e")+"'>"+r+"</span></a>":U?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(H?"w":"e")+"'>"+r+"</span></a>",s=this._get(t,"currentText"),a=this._get(t,"gotoCurrent")&&t.currentDay?K:F,s=W?this.formatDate(s,a,this._getFormatConfig(t)):s,l=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",c=Y?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(H?l:"")+(this._isInRange(t,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(H?"":l)+"</div>":"",u=parseInt(this._get(t,"firstDay"),10),u=isNaN(u)?0:u,h=this._get(t,"showWeek"),p=this._get(t,"dayNames"),d=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),m=this._get(t,"monthNamesShort"),g=this._get(t,"beforeShowDay"),y=this._get(t,"showOtherMonths"),_=this._get(t,"selectOtherMonths"),v=this._getDefaultDate(t),b="",C=0;C<j[0];C++){for(T="",this.maxRows=4,k=0;k<j[1];k++){if(x=this._daylightSavingAdjust(new Date(tt,Z,t.selectedDay)),S=" ui-corner-all",A="",X){if(A+="<div class='ui-datepicker-group",j[1]>1)switch(k){case 0:A+=" ui-datepicker-group-first",S=" ui-corner-"+(H?"right":"left");break;case j[1]-1:A+=" ui-datepicker-group-last",S=" ui-corner-"+(H?"left":"right");break;default:A+=" ui-datepicker-group-middle",S=""}A+="'>"}for(A+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===C?H?o:i:"")+(/all|right/.test(S)&&0===C?H?i:o:"")+this._generateMonthYearHeader(t,Z,tt,Q,J,C>0||k>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead><tr>",D=h?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)P=(w+u)%7,D+="<th"+((w+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+p[P]+"'>"+d[P]+"</span></th>";for(A+=D+"</tr></thead><tbody>",E=this._getDaysInMonth(tt,Z),tt===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,E)),$=(this._getFirstDayOfMonth(tt,Z)-u+7)%7,M=Math.ceil(($+E)/7),V=X&&this.maxRows>M?this.maxRows:M,this.maxRows=V,I=this._daylightSavingAdjust(new Date(tt,Z,1-$)),L=0;V>L;L++){for(A+="<tr>",B=h?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(I)+"</td>":"",w=0;7>w;w++)O=g?g.apply(t.input?t.input[0]:null,[I]):[!0,""],N=I.getMonth()!==Z,z=N&&!_||!O[0]||Q&&Q>I||J&&I>J,B+="<td class='"+((w+u+6)%7>=5?" ui-datepicker-week-end":"")+(N?" ui-datepicker-other-month":"")+(I.getTime()===x.getTime()&&Z===t.selectedMonth&&t._keyEvent||v.getTime()===I.getTime()&&v.getTime()===x.getTime()?" "+this._dayOverClass:"")+(z?" "+this._unselectableClass+" ui-state-disabled":"")+(N&&!y?"":" "+O[1]+(I.getTime()===K.getTime()?" "+this._currentClass:"")+(I.getTime()===F.getTime()?" ui-datepicker-today":""))+"'"+(N&&!y||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(z?"":" data-handler='selectDay' data-event='click' data-month='"+I.getMonth()+"' data-year='"+I.getFullYear()+"'")+">"+(N&&!y?"&#xa0;":z?"<span class='ui-state-default'>"+I.getDate()+"</span>":"<a class='ui-state-default"+(I.getTime()===F.getTime()?" ui-state-highlight":"")+(I.getTime()===K.getTime()?" ui-state-active":"")+(N?" ui-priority-secondary":"")+"' href='#'>"+I.getDate()+"</a>")+"</td>",I.setDate(I.getDate()+1),I=this._daylightSavingAdjust(I);A+=B+"</tr>"}Z++,Z>11&&(Z=0,tt++),A+="</tbody></table>"+(X?"</div>"+(j[0]>0&&k===j[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),T+=A}b+=T}return b+=c,t._keyEvent=!1,b},_generateMonthYearHeader:function(t,e,n,i,r,o,s,a){var l,c,u,h,p,d,f,m,g=this._get(t,"changeMonth"),y=this._get(t,"changeYear"),_=this._get(t,"showMonthAfterYear"),v="<div class='ui-datepicker-title'>",b="";if(o||!g)b+="<span class='ui-datepicker-month'>"+s[e]+"</span>";else{for(l=i&&i.getFullYear()===n,c=r&&r.getFullYear()===n,b+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!l||u>=i.getMonth())&&(!c||u<=r.getMonth())&&(b+="<option value='"+u+"'"+(u===e?" selected='selected'":"")+">"+a[u]+"</option>");b+="</select>"}if(_||(v+=b+(!o&&g&&y?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!y)v+="<span class='ui-datepicker-year'>"+n+"</span>";else{for(h=this._get(t,"yearRange").split(":"),p=(new Date).getFullYear(),d=function(t){var e=t.match(/c[+\-].*/)?n+parseInt(t.substring(1),10):t.match(/[+\-].*/)?p+parseInt(t,10):parseInt(t,10);return isNaN(e)?p:e},f=d(h[0]),m=Math.max(f,d(h[1]||"")),f=i?Math.max(f,i.getFullYear()):f,m=r?Math.min(m,r.getFullYear()):m,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===n?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",v+=t.yearshtml,t.yearshtml=null}return v+=this._get(t,"yearSuffix"),_&&(v+=(!o&&g&&y?"":"&#xa0;")+b),v+="</div>"},_adjustInstDate:function(t,e,n){var i=t.drawYear+("Y"===n?e:0),r=t.drawMonth+("M"===n?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(i,r))+("D"===n?e:0),s=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(i,r,o)));t.selectedDay=s.getDate(),t.drawMonth=t.selectedMonth=s.getMonth(),t.drawYear=t.selectedYear=s.getFullYear(),("M"===n||"Y"===n)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var n=this._getMinMaxDate(t,"min"),i=this._getMinMaxDate(t,"max"),r=n&&n>e?n:e;return i&&r>i?i:r},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,n,i){var r=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(n,i+(0>e?e:r[0]*r[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var n,i,r=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),s=null,a=null,l=this._get(t,"yearRange");return l&&(n=l.split(":"),i=(new Date).getFullYear(),s=parseInt(n[0],10),a=parseInt(n[1],10),n[0].match(/[+\-].*/)&&(s+=i),n[1].match(/[+\-].*/)&&(a+=i)),(!r||e.getTime()>=r.getTime())&&(!o||e.getTime()<=o.getTime())&&(!s||e.getFullYear()>=s)&&(!a||e.getFullYear()<=a)},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,n,i){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var r=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(i,n,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),r,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).mousedown(t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var n=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(n)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(n)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(n))},t.datepicker=new n,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.10.4"}(jQuery),jQuery(function(t){t.datepicker.regional.fr={closeText:"Fermer",prevText:"Pr\xe9c\xe9dent",nextText:"Suivant",currentText:"Aujourd'hui",monthNames:["Janvier","F\xe9vrier","Mars","Avril","Mai","Juin","Juillet","Ao\xfbt","Septembre","Octobre","Novembre","D\xe9cembre"],monthNamesShort:["Janv.","F\xe9vr.","Mars","Avril","Mai","Juin","Juil.","Ao\xfbt","Sept.","Oct.","Nov.","D\xe9c."],dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim.","Lun.","Mar.","Mer.","Jeu.","Ven.","Sam."],dayNamesMin:["D","L","M","M","J","V","S"],weekHeader:"Sem.",dateFormat:"dd/mm/yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},t.datepicker.setDefaults(t.datepicker.regional.fr)}),function(){TC.TimeFormatter=function(){function t(t){this.setDatePickerLocale(),moment.lang(t,this.locales[t])}return t.prototype.formats={tc_date:"MMMM D, YYYY",tc_short_month_date:"MMM D, YYYY",tc_date_with_time:"MMMM D, YYYY h.mma",tc_time:"h.mma"},t.prototype.locales={fr_fr:{months:"janvier_f\xe9vrier_mars_avril_mai_juin_juillet_ao\xfbt_septembre_octobre_novembre_d\xe9cembre".split("_"),monthsShort:"janv._f\xe9vr._mars_avr._mai_juin_juil._ao\xfbt_sept._oct._nov._d\xe9c.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui \xe0] LT",nextDay:"[Demain \xe0] LT",nextWeek:"dddd [\xe0] LT",lastDay:"[Hier \xe0] LT",lastWeek:"dddd [dernier \xe0] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"une ann\xe9e",yy:"%d ann\xe9es"},ordinalParse:/\d{1,2}(er|\xe8me)/,ordinal:function(t){var e;return t+(null!=(e=1===t)?e:{er:"\xe8me"})},meridiemParse:/PD|MD/,isPM:function(t){return"M"===t.charAt(0)}}},t.prototype.formatted=function(t,e){return null==e&&(e="tc_date_with_time"),moment(t).format(this.formats[e])},t.prototype.setDatePickerLocale=function(){return"fr-FR"===i18n.lng()?("undefined"!=typeof Highcharts&&Highcharts.setOptions({lang:{months:this.locales.fr_fr.months,shortMonths:this.locales.fr_fr.monthsShort,weekdays:this.locales.fr_fr.weekdays,rangeSelectorFrom:"Du",rangeSelectorTo:"au"}}),$.datepicker.regional.fr={monthNames:this.locales.fr_fr.months,monthNamesShort:this.locales.fr_fr.monthsShort,dayNames:this.locales.fr_fr.weekdays,dayNamesShort:this.locales.fr_fr.weekdaysShort},$.datepicker.setDefaults($.datepicker.regional.fr)):$.datepicker.setDefaults($.datepicker.regional[""])},t}()}.call(this),function(){_.extend(Backbone.View.prototype,{hidden:function(){return this.$el.hide(),this},prependedTo:function(t){return null!=(null!=t?t.el:void 0)&&(t=t.el),this.$el.prependTo(t),this},appendedTo:function(t){return null!=(null!=t?t.el:void 0)&&(t=t.el),this.$el.appendTo(t),this}})}.call(this),function(){TC.ViewVisibility={visible:function(t,e){var n;return null==e&&(e=!1),n=this.$el.is(":visible"),null!=t&&t!==n?(this.$el.toggle(t),e||this.trigger("change:visible",this,t),t):n},show:function(){return this.visible(!0)},hide:function(){return this.visible(!1)}}}.call(this),function(){$(document.body).on("click",".readmore-button",function(t){var e;return t.preventDefault(),e=$(t.target),$(e).hide(),$(e.attr("href")).fadeIn()})}.call(this),function(){$(document.body).on("click","[data-submit]",function(t){var e,n,i,r;return t.preventDefault(),e=$(this),i=e.attr("data-submit"),r=$(i),n=$('<input type="hidden" name="button" />').attr({value:e.text()}),r.append(n).submit()})}.call(this),$.fn.hightouch=function(){function t(t){t.preventDefault(),t.stopPropagation(),r.a.x=t.originalEvent.changedTouches[0].screenX,r.a.y=t.originalEvent.changedTouches[0].screenY}function e(t){t.preventDefault(),t.stopPropagation(),r.b.x=t.originalEvent.changedTouches[0].screenX,r.b.y=t.originalEvent.changedTouches[0].screenY,n(r.a,r.b)<i&&(r.highTouchEvent.initEvent("hightouch",!1,!0),t.target.dispatchEvent(r.highTouchEvent))}function n(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}if(!document.createEvent)return this;var i=20,r=this;return r.highTouchEvent=document.createEvent("Event"),r.a={},r.b={},this.bind("touchstart",t),this.bind("touchend",e),this.bind("touchcancel",e),this},function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};TC.SmallLayout=function(){function e(){this.hideAll=t(this.hideAll,this),this.hideOverlay=t(this.hideOverlay,this),this.showOverlay=t(this.showOverlay,this),this.hideSidebar=t(this.hideSidebar,this),this.showSidebar=t(this.showSidebar,this),this.initSmallLayout=t(this.initSmallLayout,this),this.initSmallLayout()}return e.prototype.initSmallLayout=function(){return this.wrapper=$("#page-wrapper"),this.sidebar=$("#small-sidebar"),this.overlay=$("#small-sidebar-overlay"),this.editions=$("#small-region-select-dropdown"),$("#small-sidebar-open-button").hightouch().on("hightouch click",this.showSidebar),$("#small-sidebar-close-button").hightouch().on("hightouch click",this.hideAll),$("#small-sidebar-overlay").on("hightouch click",this.hideAll),this.editions.on("change",function(t){return function(t){var e;return e=$(t.target.options[t.target.selectedIndex]),window.location=t.target.value}}(this)),this.showGoogleCurrentsLinkOrNot()},e.prototype.showSidebar=function(t){return t.preventDefault(),this.sidebar[0].className="visible",this.showOverlay()},e.prototype.hideSidebar=function(){return this.sidebar.hasClass("visible")?this.sidebar[0].className="hidden":void 0},e.prototype.showOverlay=function(){return this.overlay[0].className="visible",this.wrapper[0].className="overlay-visible"},e.prototype.hideOverlay=function(){return this.overlay.hasClass("visible")?(this.overlay[0].className="hidden",this.wrapper[0].className=""):void 0},e.prototype.hideAll=function(t){return t.preventDefault(),this.hideSidebar(),this.hideOverlay()},e.prototype.showGoogleCurrentsLinkOrNot=function(){var t;try{if(navigator.userAgent.toLowerCase().indexOf("android")>-1)return $("#play-newsstand-link").show()}catch(e){return t=e,!0}},e}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.User=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.exists=function(){return this.get("type")},n.prototype.isEditor=function(){return"Editor"===this.get("type")},n.prototype.isAuthor=function(){return"Author"===this.get("type")},n.prototype.isModerator=function(){return this.get("moderator")},n.prototype.isConfirmedAuthor=function(){return"confirmed_expert"===this.get("author_profile_state")},n.prototype.hasAccessTo=function(t){return-1!==_.indexOf(this.get("beta_features"),t)?!0:!1},n.prototype.getProfileNotificationsUrl=function(){return"/profiles/"+this.get("slug")+"/notifications"},n}(Backbone.Model)}.call(this),function(t,e){t.widget("ui.draggable",t.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var n=this.options;return this.helper||n.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(t(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var n=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,n){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!n){var i=this._uiHash();if(this._trigger("drag",e,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var n=this,i=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(i=t.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1),"original"!==this.options.helper||t.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",e)!==!1&&n._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1):!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(e){var n=this.options,i=t.isFunction(n.helper)?t(n.helper.apply(this.element[0],[e])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,n,i,r=this.options;return r.containment?"window"===r.containment?void(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===r.containment?void(this.containment=[0,0,t(document).width()-this.helperProportions.width-this.margins.left,(t(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):r.containment.constructor===Array?void(this.containment=r.containment):("parent"===r.containment&&(r.containment=this.helper[0].parentNode),n=t(r.containment),i=n[0],void(i&&(e="hidden"!==n.css("overflow"),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(e?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n))):void(this.containment=null)},_convertPositionTo:function(e,n){n||(n=this.position);var i="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*i}},_generatePosition:function(e){var n,i,r,o,s=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=e.pageX,c=e.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(i=this.relative_container.offset(),n=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):n=this.containment,e.pageX-this.offset.click.left<n[0]&&(l=n[0]+this.offset.click.left),e.pageY-this.offset.click.top<n[1]&&(c=n[1]+this.offset.click.top),e.pageX-this.offset.click.left>n[2]&&(l=n[2]+this.offset.click.left),e.pageY-this.offset.click.top>n[3]&&(c=n[3]+this.offset.click.top)),s.grid&&(r=s.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,c=n?r-this.offset.click.top>=n[1]||r-this.offset.click.top>n[3]?r:r-this.offset.click.top>=n[1]?r-s.grid[1]:r+s.grid[1]:r,o=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=n?o-this.offset.click.left>=n[0]||o-this.offset.click.left>n[2]?o:o-this.offset.click.left>=n[0]?o-s.grid[0]:o+s.grid[0]:o)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,n,i){return i=i||this._uiHash(),t.ui.plugin.call(this,e,[n,i]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,n){var i=t(this).data("ui-draggable"),r=i.options,o=t.extend({},n,{item:i.element});i.sortables=[],t(r.connectToSortable).each(function(){var n=t.data(this,"ui-sortable");n&&!n.options.disabled&&(i.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",e,o))})},stop:function(e,n){var i=t(this).data("ui-draggable"),r=t.extend({},n,{item:i.element});t.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,r))})},drag:function(e,n){var i=t(this).data("ui-draggable"),r=this;t.each(i.sortables,function(){var o=!1,s=this;this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,t.each(i.sortables,function(){return this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this!==s&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(s.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(r).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",e),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",e),i.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),n=t(this).data("ui-draggable").options;e.css("cursor")&&(n._cursor=e.css("cursor")),e.css("cursor",n.cursor)},stop:function(){var e=t(this).data("ui-draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,n){var i=t(n.helper),r=t(this).data("ui-draggable").options;i.css("opacity")&&(r._opacity=i.css("opacity")),i.css("opacity",r.opacity)},stop:function(e,n){var i=t(this).data("ui-draggable").options;i._opacity&&t(n.helper).css("opacity",i._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var n=t(this).data("ui-draggable"),i=n.options,r=!1;n.scrollParent[0]!==document&&"HTML"!==n.scrollParent[0].tagName?(i.axis&&"x"===i.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-e.pageY<i.scrollSensitivity?n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop+i.scrollSpeed:e.pageY-n.overflowOffset.top<i.scrollSensitivity&&(n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-e.pageX<i.scrollSensitivity?n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft+i.scrollSpeed:e.pageX-n.overflowOffset.left<i.scrollSensitivity&&(n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(e.pageY-t(document).scrollTop()<i.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-i.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<i.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(e.pageX-t(document).scrollLeft()<i.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-i.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<i.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+i.scrollSpeed)))),r!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(n,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("ui-draggable"),n=e.options;e.snapElements=[],t(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=t(this),i=n.offset();this!==e.element[0]&&e.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:i.top,left:i.left})})},drag:function(e,n){var i,r,o,s,a,l,c,u,h,p,d=t(this).data("ui-draggable"),f=d.options,m=f.snapTolerance,g=n.offset.left,y=g+d.helperProportions.width,_=n.offset.top,v=_+d.helperProportions.height;for(h=d.snapElements.length-1;h>=0;h--)a=d.snapElements[h].left,l=a+d.snapElements[h].width,c=d.snapElements[h].top,u=c+d.snapElements[h].height,a-m>y||g>l+m||c-m>v||_>u+m||!t.contains(d.snapElements[h].item.ownerDocument,d.snapElements[h].item)?(d.snapElements[h].snapping&&d.options.snap.release&&d.options.snap.release.call(d.element,e,t.extend(d._uiHash(),{snapItem:d.snapElements[h].item})),d.snapElements[h].snapping=!1):("inner"!==f.snapMode&&(i=Math.abs(c-v)<=m,r=Math.abs(u-_)<=m,o=Math.abs(a-y)<=m,s=Math.abs(l-g)<=m,i&&(n.position.top=d._convertPositionTo("relative",{top:c-d.helperProportions.height,left:0}).top-d.margins.top),r&&(n.position.top=d._convertPositionTo("relative",{top:u,left:0}).top-d.margins.top),o&&(n.position.left=d._convertPositionTo("relative",{top:0,left:a-d.helperProportions.width}).left-d.margins.left),s&&(n.position.left=d._convertPositionTo("relative",{top:0,left:l}).left-d.margins.left)),p=i||r||o||s,"outer"!==f.snapMode&&(i=Math.abs(c-_)<=m,
r=Math.abs(u-v)<=m,o=Math.abs(a-g)<=m,s=Math.abs(l-y)<=m,i&&(n.position.top=d._convertPositionTo("relative",{top:c,left:0}).top-d.margins.top),r&&(n.position.top=d._convertPositionTo("relative",{top:u-d.helperProportions.height,left:0}).top-d.margins.top),o&&(n.position.left=d._convertPositionTo("relative",{top:0,left:a}).left-d.margins.left),s&&(n.position.left=d._convertPositionTo("relative",{top:0,left:l-d.helperProportions.width}).left-d.margins.left)),!d.snapElements[h].snapping&&(i||r||o||s||p)&&d.options.snap.snap&&d.options.snap.snap.call(d.element,e,t.extend(d._uiHash(),{snapItem:d.snapElements[h].item})),d.snapElements[h].snapping=i||r||o||s||p)}}),t.ui.plugin.add("draggable","stack",{start:function(){var e,n=this.data("ui-draggable").options,i=t.makeArray(t(n.stack)).sort(function(e,n){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(n).css("zIndex"),10)||0)});i.length&&(e=parseInt(t(i[0]).css("zIndex"),10)||0,t(i).each(function(n){t(this).css("zIndex",e+n)}),this.css("zIndex",e+i.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,n){var i=t(n.helper),r=t(this).data("ui-draggable").options;i.css("zIndex")&&(r._zIndex=i.css("zIndex")),i.css("zIndex",r.zIndex)},stop:function(e,n){var i=t(this).data("ui-draggable").options;i._zIndex&&t(n.helper).css("zIndex",i._zIndex)}})}(jQuery),LowDrag=function(t){this.initialize(t),this.dragProperties=Object.create(this.Properties)},LowDrag.prototype={initialize:function(t){this.element=t.element,this.axis=t.axis,this.containment=t.containment,handleMousedown=this._handleMousedown.bind(this),handleTouchstart=this._handleTouchstart.bind(this),this.element.addEventListener("mousedown",handleMousedown,!1),this.element.addEventListener("touchstart",handleTouchstart,!1)},setValue:function(t,e){void 0==e&&(e=!0),this.dragProperties.sliderPosition.x=t,e&&!this.dragProperties.dragging&&(translation="translate3d("+this.dragProperties.sliderPosition.x+"px, 0 , 0)",this.element.style.transform=translation,this.element.style.webkitTransform=translation)},_beginDrag:function(t){this.handleMousemove=this._handleMousemove.bind(this),this.handleTouchmove=this._handleTouchmove.bind(this),this.handleMouseup=this._handleMouseup.bind(this),document.addEventListener("mousemove",this.handleMousemove,!1),document.addEventListener("touchmove",this.handleTouchmove,!1),document.addEventListener("mouseup",this.handleMouseup,!1),document.addEventListener("touchend",this.handleMouseup,!1),this.dragProperties.dragging=!0,this.dragProperties.setNewStartPosition(this.dragProperties.sliderPosition.x,this.dragProperties.sliderPosition.y),this.containment&&"parent"==this.containment&&this.dragProperties.setContainment({xMin:0,xMax:t.parentNode.offsetWidth,yMin:0,yMax:t.parentNode.offsetHeight});var e=new CustomEvent("dragstart",{});this.element.dispatchEvent(e),requestAnimationFrame(this._renderCallback.bind(this))},_renderCallback:function(t){(this.dragProperties.previousFrameTime=0)&&(this.dragProperties.previousFrameTime=t);var e=t-this.dragProperties.previousFrameTime;for(this.dragProperties.timeAccumulator+=e;this.dragProperties.timeAccumulator>=this.dragProperties.TIME_CHUNK;)this.dragProperties.setNewTargetPosition(),this.dragProperties.timeAccumulator-=this.dragProperties.TIME_CHUNK;var n=this.dragProperties.timeAccumulator/this.dragProperties.TIME_CHUNK;this.dragProperties.interpolate(n),this.dragProperties.sliderPosition.x=this.dragProperties.interpolatedPosition.x,this.dragProperties.containment.active&&(this.dragProperties.sliderPosition.x=Math.max(this.dragProperties.containment.xMin,Math.min(this.dragProperties.containment.xMax,this.dragProperties.sliderPosition.x)));var i=new CustomEvent("drag",{detail:{position:this.dragProperties.sliderPosition}});if(this.element.dispatchEvent(i),translation="translate3d("+this.dragProperties.sliderPosition.x+"px, 0 , 0)",this.element.style.transform=translation,this.element.style.webkitTransform=translation,this.dragProperties.dragging)requestAnimationFrame(this._renderCallback.bind(this));else{var r=new CustomEvent("dragfinish",{});this.element.dispatchEvent(r)}},_finishDrag:function(t){this.dragProperties.dragging=!1},_handleMousemove:function(t){t.preventDefault(),this.dragProperties.mousePosition.x=t.pageX,this.dragProperties.mousePosition.y=t.pageY},_handleTouchmove:function(t){t.preventDefault(),this.dragProperties.mousePosition.x=t.touches[0].pageX,this.dragProperties.mousePosition.y=t.touches[0].pageY},_handleMousedown:function(t){t.preventDefault(),t.stopPropagation(),this.dragProperties.mouseStartPosition.x=t.pageX-this.dragProperties.sliderPosition.x,this.dragProperties.mouseStartPosition.y=t.pageY-this.dragProperties.sliderPosition.y,this.dragProperties.mousePosition.x=t.pageX,this.dragProperties.mousePosition.y=t.pageY,this._beginDrag(this.element)},_handleTouchstart:function(t){t.preventDefault(),t.stopPropagation(),this.dragProperties.mouseStartPosition.x=t.touches[0].pageX-this.dragProperties.sliderPosition.x,this.dragProperties.mouseStartPosition.y=t.touches[0].pageY-this.dragProperties.sliderPosition.y,this.dragProperties.mousePosition.x=t.touches[0].pageX,this.dragProperties.mousePosition.y=t.touches[0].pageY,this._beginDrag(this.element)},_handleMouseup:function(t){t.preventDefault(),document.removeEventListener("mousemove",this.handleMousemove),document.removeEventListener("touchmove",this.handleTouchmove),document.removeEventListener("mousemove",this.handleMouseup),document.removeEventListener("touchend",this.handleMouseup),this._finishDrag(this.element)},Properties:{TIME_CHUNK:5e4,dragging:!1,mouseStartPosition:{x:0,y:0},mousePosition:{x:0,y:0},startPosition:{x:0,y:0},targetPosition:{x:0,y:0},interpolatedPosition:{x:0,y:0},sliderPosition:{x:0,y:0},containment:{active:!1,xMin:0,xMax:0,yMin:0,yMax:0},timeAccumulator:0,previousFrameTime:0,setNewStartPosition:function(t,e){this.startPosition.x=t,this.startPosition.y=e,this.targetPosition.x=t,this.targetPosition.y=e},setNewTargetPosition:function(){this.copyTargetToStart(),this.targetPosition.x=this.mousePosition.x-this.mouseStartPosition.x,this.targetPosition.y=this.mousePosition.y-this.mouseStartPosition.y},copyTargetToStart:function(){this.startPosition.x=this.targetPosition.x,this.startPosition.y=this.targetPosition.y},setContainment:function(t){this.containment.active=!0,this.containment.xMin=t.xMin,this.containment.xMax=t.xMax,this.containment.yMin=t.yMin,this.containment.yMax=t.yMax},interpolate:function(t){this.interpolatedPosition.x=this.targetPosition.x*t+this.startPosition.x*(1-t),this.interpolatedPosition.y=this.targetPosition.y*t+this.startPosition.y*(1-t)}}},function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.SuperSliderView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="super-slider-view",n.prototype.template=_.template('<div class="super-slider-view-track">\n  <div class="super-slider-view-slider">\n    <div class="super-slider-view-slider-inner"></div>\n  </div>\n</div>'),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.render(),this._initTrack(),this._initSlider(),this.$el.on("mousedown",function(t){return function(e){var n;return e.preventDefault(),n=t._clampCoordsToTrackBounds(e.originalEvent.pageX),t._setSliderValue(n,!1),t.draggable._handleMousedown(e.originalEvent)}}(this)),this.$el.on("touchstart",function(t){return function(e){var n;return e.preventDefault(),n=t._clampCoordsToTrackBounds(e.originalEvent.touches[0].pageX),t._setSliderValue(n,!1),t.draggable._handleTouchstart(e.originalEvent)}}(this)),$(window).on("resize",function(t){return function(){return t._throttledResize()}}(this))},n.prototype.render=function(){return n.__super__.render.call(this),this.el.innerHTML=this.template()},n.prototype.setValue=function(t){var e;return e=t*this.trackEl.width()/100,this._setSliderValue(e)},n.prototype._clampCoordsToTrackBounds=function(t){var e,n,i;return i=this.trackEl.offset(),n=i.left,e=this.trackEl.width()+i.left,Math.max(n,Math.min(e,t))-i.left},n.prototype._setSliderValue=function(t,e){return this.draggable.setValue(t,e)},n.prototype._initTrack=function(){return this.trackEl=this.$el.find(".super-slider-view-track"),this.cachedTrackWidth=this.trackEl.width()},n.prototype._initSlider=function(){return this.sliderEl=this.$el.find(".super-slider-view-slider"),this.draggable=new LowDrag({element:this.sliderEl.get(0),axis:"x",containment:"parent"}),this.sliderEl.get(0).addEventListener("drag",function(t){return function(e){var n,i;return n=e.detail.position.x,i=t.trackEl.width(),t.percentage=n/i*100,t._throttledChange()}}(this)),this.sliderEl.on("dragstart",function(t){return function(){return t.trigger("changestart")}}(this)),this.sliderEl.on("dragfinish",function(t){return function(){return t.trigger("changefinish")}}(this))},n.prototype._throttledChange=_.throttle(function(){return this.trigger("change",this.percentage)},66),n.prototype._throttledResize=_.throttle(function(){var t;return t=this.trackEl.width(),t!==this.cachedTrackWidth&&this.setValue(this.percentage),this.cachedTrackWidth=t},66),n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.AudioPlayerView=function(e){function i(){return this._onEnded=t(this._onEnded,this),this._onTimeUpdate=t(this._onTimeUpdate,this),this._onClickPlay=t(this._onClickPlay,this),this._play=t(this._play,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.events={"click .audio-player-play":"_onClickPlay"},i.prototype.className="audio-player",i.prototype.template=_.template('<div class="audio-player-inner">\n  <div class="audio-player-middle"></div>\n</div>'),i.prototype.initialize=function(t){return this.audioEl=$(t.audioEl),this.audioEl.hasClass("initialized")?void 0:(i.__super__.initialize.call(this,t),this.render())},i.prototype.render=function(){return i.__super__.render.call(this),this.$el.append(this.template()),this.innerEl=this.$(".audio-player-inner"),this.middleEl=this.$(".audio-player-middle"),this._canPlayAudio()?this._setupSupported():this._setupUnsupported(),this.audioEl.addClass("initialized"),this.audioEl.before(this.$el)},i.prototype._play=function(){return this.audio.play(),this.timeUpdateInterval=setInterval(function(t){return function(){return $(t.audio).trigger("timeupdate")}}(this),50)},i.prototype._pause=function(){return this.audio.pause(),this.timeUpdateInterval?clearInterval(this.timeUpdateInterval):void 0},i.prototype._canPlayAudio=function(){var t;return t=document.createElement("audio"),!!t.canPlayType},i.prototype._setupSupported=function(){return this.audio=this.audioEl.get(0),$(this.audio).on("timeupdate",this._onTimeUpdate),$(this.audio).on("ended",this._onEnded),this._readData(),this._removeCaption(),this._addImage(),this._addControls(),this._addDownloadLink(),this._addTitle()},i.prototype._setupUnsupported=function(){var t;return this.audio=this.audioEl.get(0),$(this.audio).on("timeupdate",this._onTimeUpdate),$(this.audio).on("ended",this._onEnded),this._readData(),this._removeCaption(),this._addImage(),this._addLicenseWithoutControls(),this._addDownloadLink(),this._addTitle(),this.$el.addClass("no-audio"),t='<span class="unsupported">'+i18n.t("audio_player.message.unsupported")+"</span>",this.middleEl.find(".audio-player-listen").append(t),this.audioEl.next(".audio-player-caption").show()},i.prototype._readData=function(){return this.duration=this.audioEl.data("duration"),this.image=this.audioEl.data("image"),this.title=this.audioEl.data("title"),this.size=this.audioEl.data("size"),this.source=this.audioEl.data("source"),this.sourceUrl=this.audioEl.data("source-url"),this.license=this.audioEl.data("license"),this.licenseUrl=this.audioEl.data("license-url"),this.link=this.audioEl.find("source").attr("src"),this.durationFormatted=this._formatSeconds(this.duration),this.sizeFormatted=this._formatSize(this.size)},i.prototype._removeCaption=function(){return this.audioEl.next(".audio-player-caption").remove(),this.audioEl.parent().next(".audio-player-caption").remove()},i.prototype._addImage=function(){return void 0!==this.image&&""!==this.image?this.innerEl.append('<div class="audio-player-image">\n  <img src="'+this.image+'" alt="">\n</div>'):this.$el.addClass("no-image")},i.prototype._addLicenseWithoutControls=function(){var t;return t=void 0!==this.licenseUrl&&""!==this.licenseUrl?'<a href="'+this.licenseUrl+'">'+this.license+"</a>":"<span>"+this.license+"</span>",this.middleEl.append('<div class="audio-player-license audio-player-unsupported-license">'+t+"</div>")},i.prototype._addControls=function(){var t;return t=void 0!==this.licenseUrl&&""!==this.licenseUrl?'<a href="'+this.licenseUrl+'">'+this.license+"</a>":"<span>"+this.license+"</span>",this.middleEl.append('<div class="audio-player-controls">\n  <div class="audio-player-play"></div>\n\n  <div class="audio-player-bar-wrapper">\n    <div class="audio-player-current-time">00:00</div>\n    <div class="audio-player-total-time">'+this.durationFormatted+'</div>\n    <div class="audio-player-license">'+t+"</div>\n  </div>\n</div>"),this.wrapperEl=this.$(".audio-player-bar-wrapper"),this.playEl=this.$(".audio-player-controls .audio-player-play"),this.currentTimeEl=this.$(".audio-player-controls .audio-player-current-time"),this.totalTimeEl=this.$(".audio-player-controls .audio-player-total-time"),this.superSliderView=new TC.SuperSliderView,this.superSliderView.appendedTo(this.wrapperEl),this.superSliderView.on("changestart",function(t){return function(){return t.playEl.is(".playing")?(t._pause(),t.superSliderView.once("changefinish",t._play)):void 0}}(this)),this.superSliderView.on("change",function(t){return function(e){return t._updateCurrentTime(e),t._updateCurrentTimestamp(e)}}(this))},i.prototype._addDownloadLink=function(){var t;return t=this.link.split(".").pop().toUpperCase(),this.innerEl.append('<div class="audio-player-download">\n  <a href="'+this.link+'" title="Download">\n    <span class="audio-player-heading">'+i18n.t("audio_player.label.download")+'</span>\n    <span class="audio-player-download-icon"></span>\n    <span class="audio-player-download-info">'+t+" / "+this.sizeFormatted+"</span>\n  </a>\n</div>")},i.prototype._addTitle=function(){return this.middleEl.append('<div class="audio-player-listen">\n  <span class="audio-player-heading">'+i18n.t("audio_player.label.listen")+'</span>\n  <span class="audio-player-title">'+this.title+"</span>\n</div>")},i.prototype._moveSlider=function(t){return this.superSliderView.setValue(t)},i.prototype._updateCurrentTime=function(t){var e;return e=this.duration*(t>100?100:t)/100,this.audio.currentTime=e},i.prototype._updateCurrentTimestamp=function(t){var e;return e=this.duration*(t/100),this.currentTimeEl.get(0).textContent=this._formatSeconds(e)},i.prototype._onClickPlay=function(t){var e;return e=$(t.target),e.toggleClass("playing"),e.is(".playing")?this._play():this._pause()},i.prototype._onTimeUpdate=function(t){var e;return e=this._timeToPercent(this.audio.currentTime),this._moveSlider(e),this._updateCurrentTimestamp(e)},i.prototype._onEnded=function(t){return this.playEl.removeClass("playing"),this.timeUpdateInterval&&clearInterval(this.timeUpdateInterval),this._moveSlider(0),this._updateCurrentTimestamp(0)},i.prototype._formatSeconds=function(t){var e,n,i,r,o;return t=Math.round(t),i=Math.floor(t/3600),e=t%3600,r=Math.floor(e/60),n=e%60,o=Math.ceil(n),0===i?""+this._padded(r)+":"+this._padded(o):""+this._padded(i)+":"+this._padded(r)+":"+this._padded(o)},i.prototype._padded=function(t){var e;for(e=""+t;e.length<2;)e="0"+e;return e},i.prototype._formatSize=function(t){var e,n;return n=["bytes","KB","MB","GB"],0===t?"0":(e=parseInt(Math.floor(Math.log(t)/Math.log(1024))),(0===e?t/Math.pow(1024,e):(t/Math.pow(1024,e)).toFixed(0))+" "+n[e])},i.prototype._timeToPercent=function(t){var e;return e=parseFloat(t)/parseInt(this.duration)*100,e>100?100:e},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.EngagementBarView=function(e){function i(){return this._showContent=t(this._showContent,this),this._activateSectionFour=t(this._activateSectionFour,this),this._activateSectionThree=t(this._activateSectionThree,this),this._activateSectionTwo=t(this._activateSectionTwo,this),this._activateSectionOne=t(this._activateSectionOne,this),this._panelHasNoLinks=t(this._panelHasNoLinks,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.tagName="section",i.prototype.id="eb",i.prototype.events={"click .eb-parts-content .eb-part-1":"_activateSectionOne","click .eb-parts-content .eb-part-2":"_activateSectionTwo","click .eb-parts-content .eb-part-3":"_activateSectionThree","click .eb-parts-content .eb-part-4":"_activateSectionFour","click .eb-parts-bgs .eb-parts-bg-1":"_activateSectionOne","click .eb-parts-bgs .eb-parts-bg-2":"_activateSectionFour"},i.prototype.template=_.template('<div class="eb-wrapper">\n  <div class="eb-parts-content wrapper">\n    <div class="eb-part eb-part-1">\n      <h3><%- i18n.t(\'engagement_bar.first_panel.heading\') %></h3>\n\n      <div class="content <%- firstPanel %>">\n        <div class="text"><%= i18n.t(\'engagement_bar.first_panel.blurb_html\') %></div>\n        <div class="links"><%= i18n.t(\'engagement_bar.first_panel.links_html\') %></div>\n      </div>\n    </div>\n\n    <div class="eb-part eb-part-2">\n      <h3><%- i18n.t(\'engagement_bar.second_panel.heading\') %></h3>\n\n      <div class="content <%- secondPanel %>">\n        <div class="text"><%= i18n.t(\'engagement_bar.second_panel.blurb_html\') %></div>\n        <div class="links"><%= i18n.t(\'engagement_bar.second_panel.links_html\') %></div>\n      </div>\n    </div>\n\n    <div class="eb-part eb-part-3">\n      <h3><%- i18n.t(\'engagement_bar.third_panel.heading\') %></h3>\n\n      <div class="content <%- thirdPanel %>">\n        <div class="text"><%= i18n.t(\'engagement_bar.third_panel.blurb_html\') %></div>\n        <div class="links"><%= i18n.t(\'engagement_bar.third_panel.links_html\') %></div>\n      </div>\n    </div>\n\n    <div class="eb-part eb-part-4">\n      <h3><%- i18n.t(\'engagement_bar.fourth_panel.heading\') %></h3>\n\n      <div class="content <%- fourthPanel %>">\n        <div class="text"><%= i18n.t(\'engagement_bar.fourth_panel.blurb_html\') %></div>\n        <div class="links"><%= i18n.t(\'engagement_bar.fourth_panel.links_html\') %></div>\n      </div>\n    </div>\n  </div>\n\n  <div class="eb-overlay"></div>\n\n  <div class="eb-parts-bgs">\n    <div class="eb-parts-bg-1"></div>\n    <div class="eb-parts-bg-2"></div>\n  </div>\n\n  <div class="eb-parts-bg wrapper">\n    <div class="eb-part eb-part-1"></div>\n    <div class="eb-part eb-part-2"></div>\n    <div class="eb-part eb-part-3"></div>\n    <div class="eb-part eb-part-4"></div>\n  </div>\n\n  <div class="eb-bgs">\n    <div class="eb-bg-1"></div>\n    <div class="eb-bg-2"></div>\n  </div>\n</div>'),i.prototype.initialize=function(t){var e;return i.__super__.initialize.call(this,t),this.render(),e=this.$(".eb-parts-content .eb-part-4 .donate"),this._isAU()?e.removeAttr("class"):e.remove(),this.parts=this.$(".eb-parts-content .eb-part"),this.bgs=this.$(".eb-parts-bg .eb-part"),this.part1=this.$(".eb-parts-content .eb-part-1"),this.part2=this.$(".eb-parts-content .eb-part-2"),this.part3=this.$(".eb-parts-content .eb-part-3"),this.part4=this.$(".eb-parts-content .eb-part-4"),setTimeout(function(t){return function(){return t.$el.addClass("initial"),t._activateSectionFour()}}(this),500)},i.prototype.render=function(){return this.$el.html(this.template({firstPanel:this._panelHasNoLinks("first_panel"),secondPanel:this._panelHasNoLinks("second_panel"),thirdPanel:this._panelHasNoLinks("third_panel"),fourthPanel:this._panelHasNoLinks("fourth_panel")}))},i.prototype._panelHasNoLinks=function(t){return""===i18n.t("engagement_bar."+t+".links_html")?"no-links":void 0},i.prototype._activateSectionOne=function(){return this.part1.hasClass("current")||this.$el.hasClass("initial")?void 0:(this.$el.removeClass("initial"),this.parts.removeClass("current"),this.part1.addClass("current"),_.each(_.first(this.parts,1),function(t){return $(t).removeClass("inactive").addClass("active")}),_.each(_.first(this.bgs,1),function(t){return $(t).removeClass("inactive").addClass("active")}),_.each(_.last(this.parts,3),function(t){return $(t).removeClass("active").addClass("inactive")}),_.each(_.last(this.bgs,3),function(t){return $(t).removeClass("active").addClass("inactive")}),this._showContent(1))},i.prototype._activateSectionTwo=function(){return this.part2.hasClass("current")?void 0:(this.$el.removeClass("initial"),this.parts.removeClass("current"),this.part2.addClass("current"),_.each(_.first(this.parts,2),function(t){return $(t).removeClass("inactive").addClass("active")}),_.each(_.first(this.bgs,2),function(t){return $(t).removeClass("inactive").addClass("active")}),_.each(_.last(this.parts,2),function(t){return $(t).removeClass("active").addClass("inactive")}),_.each(_.last(this.bgs,2),function(t){return $(t).removeClass("active").addClass("inactive")}),this._showContent(2))},i.prototype._activateSectionThree=function(){return this.part3.hasClass("current")?void 0:(this.$el.removeClass("initial"),this.parts.removeClass("current"),this.part3.addClass("current"),_.each(_.first(this.parts,3),function(t){return $(t).removeClass("inactive").addClass("active")}),_.each(_.first(this.bgs,3),function(t){return $(t).removeClass("inactive").addClass("active")}),_.each(_.last(this.parts,1),function(t){return $(t).removeClass("active").addClass("inactive")}),_.each(_.last(this.bgs,1),function(t){return $(t).removeClass("active").addClass("inactive")}),this._showContent(3))},i.prototype._activateSectionFour=function(){return this.part4.hasClass("current")?void 0:(this.$el.removeClass("initial"),this.parts.removeClass("current"),this.part4.addClass("current"),this.parts.removeClass("inactive").addClass("active"),this.bgs.removeClass("inactive").addClass("active"),this._showContent(4))},i.prototype._showContent=function(t){return this.$(".content").removeClass("show"),setTimeout(function(e){return function(){return e.$(".eb-part-"+t+" .content").addClass("show")}}(this),200)},i.prototype._isAU=function(){return $("body").is(".region_au")},i}(Backbone.View)}.call(this),function(t){function e(){if(t.fn.ajaxSubmit.debug){var e="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(e):window.opera&&window.opera.postError&&window.opera.postError(e)}}t.fn.ajaxSubmit=function(n){function i(){function i(){var e=p.attr("target"),n=p.attr("action");o.setAttribute("target",a),"POST"!=o.getAttribute("method")&&o.setAttribute("method","POST"),o.getAttribute("action")!=s.url&&o.setAttribute("action",s.url),s.skipEncodingOverride||p.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),s.timeout&&setTimeout(function(){d=!0,r()},s.timeout);var i=[];try{if(s.extraData)for(var u in s.extraData)i.push(t('<input type="hidden" name="'+u+'" value="'+s.extraData[u]+'" />').appendTo(o)[0]);l.appendTo("body"),c.attachEvent?c.attachEvent("onload",r):c.addEventListener("load",r,!1),o.submit()}finally{o.setAttribute("action",n),e?o.setAttribute("target",e):p.removeAttr("target"),t(i).remove()}}function r(){if(y=c.contentWindow?c.contentWindow.document:c.contentDocument?c.contentDocument:c.document,y&&y.location.href!=s.iframeSrc){c.detachEvent?c.detachEvent("onload",r):c.removeEventListener("load",r,!1);var n=!0;try{if(d)throw"timeout";var i="xml"==s.dataType||y.XMLDocument||t.isXMLDoc(y);if(e("isXml="+i),!i&&window.opera&&(null==y.body||""==y.body.innerHTML)&&--_)return e("requeing onLoad callback, DOM not available"),void setTimeout(r,250);u.responseText=y.body?y.body.innerHTML:y.documentElement?y.documentElement.innerHTML:null,u.responseXML=y.XMLDocument?y.XMLDocument:y,u.getResponseHeader=function(t){var e={"content-type":s.dataType};return e[t]};var o=/(json|script)/.test(s.dataType);if(o||s.textarea){var a=y.getElementsByTagName("textarea")[0];if(a)u.responseText=a.value;else if(o){var p=y.getElementsByTagName("pre")[0],f=y.getElementsByTagName("body")[0];p?u.responseText=p.textContent:f&&(u.responseText=f.innerHTML)}}else"xml"!=s.dataType||u.responseXML||null==u.responseText||(u.responseXML=v(u.responseText));g=w(u,s.dataType,s)}catch(m){e("error caught:",m),n=!1,u.error=m,s.error.call(s.context,u,"error",m),h&&t.event.trigger("ajaxError",[u,s,m])}u.aborted&&(e("upload aborted"),n=!1),n&&(s.success.call(s.context,g,"success",u),h&&t.event.trigger("ajaxSuccess",[u,s])),h&&t.event.trigger("ajaxComplete",[u,s]),h&&!--t.active&&t.event.trigger("ajaxStop"),s.complete&&s.complete.call(s.context,u,n?"success":"error"),setTimeout(function(){l.removeData("form-plugin-onload"),l.remove(),u.responseXML=null},100)}}var o=p[0];if(t(":input[name=submit],:input[id=submit]",o).length)return void alert('Error: Form elements must not have name or id of "submit".');var s=t.extend(!0,{},t.ajaxSettings,n);s.context=s.context||s;var a="jqFormIO"+(new Date).getTime(),l=t('<iframe id="'+a+'" name="'+a+'" src="'+s.iframeSrc+'" />'),c=l[0];l.css({position:"absolute",top:"-1000px",left:"-1000px"});var u={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(){this.aborted=1,l.attr("src",s.iframeSrc)}},h=s.global;if(h&&!t.active++&&t.event.trigger("ajaxStart"),h&&t.event.trigger("ajaxSend",[u,s]),s.beforeSend&&s.beforeSend.call(s.context,u,s)===!1)return void(s.global&&t.active--);if(!u.aborted){var d=0,f=o.clk;if(f){var m=f.name;m&&!f.disabled&&(s.extraData=s.extraData||{},s.extraData[m]=f.value,"image"==f.type&&(s.extraData[m+".x"]=o.clk_x,s.extraData[m+".y"]=o.clk_y))}s.forceSync?i():setTimeout(i,10);var g,y,_=50,v=t.parseXML||function(t,e){return window.ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t)):e=(new DOMParser).parseFromString(t,"text/xml"),e&&e.documentElement&&"parsererror"!=e.documentElement.nodeName?e:null},b=t.parseJSON||function(t){return window.eval("("+t+")")},w=function(e,n,i){var r=e.getResponseHeader("content-type")||"",o="xml"===n||!n&&r.indexOf("xml")>=0,s=o?e.responseXML:e.responseText;return o&&"parsererror"===s.documentElement.nodeName&&t.error&&t.error("parsererror"),i&&i.dataFilter&&(s=i.dataFilter(s,n)),"string"==typeof s&&("json"===n||!n&&r.indexOf("json")>=0?s=b(s):("script"===n||!n&&r.indexOf("javascript")>=0)&&t.globalEval(s)),s}}}if(!this.length)return e("ajaxSubmit: skipping submit process - no element selected"),this;"function"==typeof n&&(n={success:n});var r=this.attr("action"),o="string"==typeof r?t.trim(r):"";o&&(o=(o.match(/^([^#]+)/)||[])[1]),o=o||window.location.href||"",n=t.extend(!0,{url:o,type:this[0].getAttribute("method")||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},n);var s={};if(this.trigger("form-pre-serialize",[this,n,s]),s.veto)return e("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(n.beforeSerialize&&n.beforeSerialize(this,n)===!1)return e("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var a,l,c=this.formToArray(n.semantic);if(n.data){n.extraData=n.data;for(a in n.data)if(n.data[a]instanceof Array)for(var u in n.data[a])c.push({name:a,value:n.data[a][u]});else l=n.data[a],l=t.isFunction(l)?l():l,c.push({name:a,value:l})}if(n.beforeSubmit&&n.beforeSubmit(c,this,n)===!1)return e("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[c,this,n,s]),s.veto)return e("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var h=t.param(c);"GET"==n.type.toUpperCase()?(n.url+=(n.url.indexOf("?")>=0?"&":"?")+h,n.data=null):n.data=h;var p=this,d=[];if(n.resetForm&&d.push(function(){p.resetForm()}),n.clearForm&&d.push(function(){p.clearForm()}),!n.dataType&&n.target){var f=n.success||function(){};d.push(function(e){var i=n.replaceTarget?"replaceWith":"html";t(n.target)[i](e).each(f,arguments)})}else n.success&&d.push(n.success);n.success=function(t,e,i){for(var r=n.context||n,o=0,s=d.length;s>o;o++)d[o].apply(r,[t,e,i||p,p])};var m=t("input:file",this).length>0,g="multipart/form-data",y=p.attr("enctype")==g||p.attr("encoding")==g;return n.iframe!==!1&&(m||n.iframe||y)?n.closeKeepAlive?t.get(n.closeKeepAlive,i):i():t.ajax(n),this.trigger("form-submit-notify",[this,n]),this},t.fn.ajaxForm=function(n){if(0===this.length){var i={s:this.selector,c:this.context};return!t.isReady&&i.s?(e("DOM not ready, queuing ajaxForm"),t(function(){t(i.s,i.c).ajaxForm(n)}),this):(e("terminating; zero elements found by selector"+(t.isReady?"":" (DOM not ready)")),this)}return this.ajaxFormUnbind().bind("submit.form-plugin",function(e){e.isDefaultPrevented()||(e.preventDefault(),t(this).ajaxSubmit(n))}).bind("click.form-plugin",function(e){var n=e.target,i=t(n);if(!i.is(":submit,input:image")){var r=i.closest(":submit");if(0==r.length)return;n=r[0]}var o=this;if(o.clk=n,"image"==n.type)if(void 0!=e.offsetX)o.clk_x=e.offsetX,o.clk_y=e.offsetY;else if("function"==typeof t.fn.offset){var s=i.offset();o.clk_x=e.pageX-s.left,o.clk_y=e.pageY-s.top}else o.clk_x=e.pageX-n.offsetLeft,o.clk_y=e.pageY-n.offsetTop;setTimeout(function(){o.clk=o.clk_x=o.clk_y=null},100)})},t.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},t.fn.formToArray=function(e){var n=[];if(0===this.length)return n;var i=this[0],r=e?i.getElementsByTagName("*"):i.elements;if(!r)return n;var o,s,a,l,c,u,h;for(o=0,u=r.length;u>o;o++)if(c=r[o],a=c.name)if(e&&i.clk&&"image"==c.type)c.disabled||i.clk!=c||(n.push({name:a,value:t(c).val()}),n.push({name:a+".x",value:i.clk_x},{name:a+".y",value:i.clk_y}));else if(l=t.fieldValue(c,!0),l&&l.constructor==Array)for(s=0,h=l.length;h>s;s++)n.push({name:a,value:l[s]});else null!==l&&"undefined"!=typeof l&&n.push({name:a,value:l});if(!e&&i.clk){var p=t(i.clk),d=p[0];a=d.name,a&&!d.disabled&&"image"==d.type&&(n.push({name:a,value:p.val()}),n.push({name:a+".x",value:i.clk_x},{name:a+".y",value:i.clk_y}))}return n},t.fn.formSerialize=function(e){return t.param(this.formToArray(e))},t.fn.fieldSerialize=function(e){var n=[];return this.each(function(){var i=this.name;if(i){var r=t.fieldValue(this,e);if(r&&r.constructor==Array)for(var o=0,s=r.length;s>o;o++)n.push({name:i,value:r[o]});else null!==r&&"undefined"!=typeof r&&n.push({name:this.name,value:r})}}),t.param(n)},t.fn.fieldValue=function(e){for(var n=[],i=0,r=this.length;r>i;i++){var o=this[i],s=t.fieldValue(o,e);null===s||"undefined"==typeof s||s.constructor==Array&&!s.length||(s.constructor==Array?t.merge(n,s):n.push(s))}return n},t.fieldValue=function(e,n){var i=e.name,r=e.type,o=e.tagName.toLowerCase();if(void 0===n&&(n=!0),n&&(!i||e.disabled||"reset"==r||"button"==r||("checkbox"==r||"radio"==r)&&!e.checked||("submit"==r||"image"==r)&&e.form&&e.form.clk!=e||"select"==o&&-1==e.selectedIndex))return null;if("select"==o){var s=e.selectedIndex;if(0>s)return null;for(var a=[],l=e.options,c="select-one"==r,u=c?s+1:l.length,h=c?s:0;u>h;h++){var p=l[h];if(p.selected){var d=p.value;if(d||(d=p.attributes&&p.attributes.value&&!p.attributes.value.specified?p.text:p.value),c)return d;a.push(d)}}return a}return t(e).val()},t.fn.clearForm=function(){return this.each(function(){t("input,select,textarea",this).clearFields()})},t.fn.clearFields=t.fn.clearInputs=function(){return this.each(function(){var t=this.type,e=this.tagName.toLowerCase();"text"==t||"password"==t||"textarea"==e?this.value="":"checkbox"==t||"radio"==t?this.checked=!1:"select"==e&&(this.selectedIndex=-1)})},t.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},t.fn.enable=function(t){return void 0===t&&(t=!0),this.each(function(){this.disabled=!t})},t.fn.selected=function(e){return void 0===e&&(e=!0),this.each(function(){var n=this.type;if("checkbox"==n||"radio"==n)this.checked=e;else if("option"==this.tagName.toLowerCase()){
var i=t(this).parent("select");e&&i[0]&&"select-one"==i[0].type&&i.find("option").selected(!1),this.selected=e}})}}(jQuery),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.NewsletterSignupFormView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"submit form":"_submitSignup"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t)},n.prototype._submitSignup=function(t){var e;return t.preventDefault(),e=$(t.currentTarget),e.removeClass("success").removeClass("failure").addClass("submitting"),e.find("input.button").addClass("disabled"),$(e).ajaxSubmit({url:"/subscriptions",type:"POST",dataType:"json",success:function(t){return e.removeClass("submitting").addClass("success"),$.flash("notice",t.msg),TC.analytics.track("Newsletter signups",document.location.pathname,"",1)},error:function(t){return e.removeClass("submitting").addClass("failure"),$.flash("alert",$.parseJSON(t.responseText).msg)},complete:function(t){return e.find("input.button").removeClass("disabled")}})},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.OuterView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return this.makeRoomForFooter(),$(window).resize(_.bind(this.makeRoomForFooter,this))},n.prototype.makeRoomForFooter=function(){return this.$el.css({minHeight:$(window).height()-this.options.topbar.outerHeight()-this.options.footers.outerHeight()-parseInt(this.$el.css("padding-top"))})},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.TopbarToggleMenu=function(e){function i(){return this._documentClickHandler=t(this._documentClickHandler,this),this._closeMenu=t(this._closeMenu,this),this._openMenu=t(this._openMenu,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return null==t&&(t={}),this.menuButtonOpen=this.$el.find(".menu-button-open"),this.menuButtonOpen.show(),this.menuButtonOpen.hightouch().on("hightouch click",this._openMenu),this.menuButtonOpen.after("<a class='menu-button-close' href='#'></a>"),this.menuButtonClose=this.$el.find(".menu-button-close"),this.menuButtonClose.hightouch().on("hightouch click",this._closeMenu),i.__super__.initialize.call(this,t)},i.prototype._openMenu=function(t){return t.preventDefault(),this.$el.addClass("open"),this.menuButtonOpen.hide(),this.menuButtonClose.show(),_.defer(function(t){return function(){return $(document).on("click",t._documentClickHandler)}}(this))},i.prototype._closeMenu=function(t){return null!=t&&t.preventDefault(),this.$el.removeClass("open"),this.menuButtonOpen.show(),this.menuButtonClose.hide(),_.defer(function(t){return function(){return $(document).off("click",t._documentClickHandler)}}(this))},i.prototype._documentClickHandler=function(t){return t.stopPropagation(),this._closeMenu()},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.EditorialMenu=function(e){function i(){return this._toggle=t(this._toggle,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return null==t&&(t={}),this.editorialMenu=this.$el.find(".editorial-menu"),this.editorialMenu.find(".toggle").hightouch().on("hightouch click",this._toggle)},i.prototype._toggle=function(t){return t.preventDefault(),this.editorialMenu.toggleClass("opened")},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.EditorialSidebarMenu=function(e){function i(){return this._toggle=t(this._toggle,this),this._open=t(this._open,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return null==t&&(t={}),this.editorialGrid=this.$el.find(".editorial-grid"),this.editorialMenu=this.editorialGrid.find(".editorial-sidebar"),this.editorialMenu.append("<a href='#' class='cover'></a>"),this.editorialMenu.find("h3 a").hightouch().on("hightouch click",this._open),this.editorialMenu.find(".cover").hightouch().on("hightouch click",this._toggle)},i.prototype._open=function(t){var e;return t.preventDefault(),this.editorialGrid.addClass("editorial-sidebar-opened"),e=$(t.currentTarget).parents(".editorial-sidebar-group"),e.toggleClass("opened")},i.prototype._toggle=function(t){return t.preventDefault(),this.$el.find(".editorial-sidebar-group").removeClass("opened"),this.editorialGrid.toggleClass("editorial-sidebar-opened")},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.BasePage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.el=document.body,n.prototype.initialize=function(t){return echo.init({offset:500,throttle:250,debounce:!1}),this.topbar=this.$("#topbar"),this.footers=this.$("#footers"),this.newsletterSignUpForm=this.$(".newsletter-signup-form").each(function(t){return function(e,n){return t.newsletterSignUpFormView=new TC.NewsletterSignupFormView({el:n})}}(this)),this.audioPlayers=this.$("audio").each(function(t){return function(t,e){return new TC.AudioPlayerView({audioEl:e})}}(this)),this.outer=this.$("#outer").first().each(function(t){return function(e,n){return t.outerView=new TC.OuterView({el:n,topbar:t.topbar,footers:t.footers})}}(this)),this.editorialSidebarMenu=new TC.EditorialSidebarMenu({el:this.$el}),this.editorialMenu=new TC.EditorialMenu({el:this.$el}),this._initSVGHandling(),this._initJSHandling(),this._initLocalTimes(),this._initRelativeTimes(),this._initTopbarMenu(),new TC.SmallLayout},n.prototype._initLocalTimes=function(){return $("time[data-format]").each(function(t,e){var n,i,r;return n=$(e).data("format"),r=$(e).attr("datetime"),n&&r?(i=moment(r),$(e).html(TC.time.formatted(i,n)),$(e).attr("title",i.toDate())):void 0})},n.prototype._initRelativeTimes=function(){return $("time[data-relative]").each(function(t,e){var n,i;return i=$(e).attr("datetime"),i?(n=moment(i),$(e).html(n.fromNow()),$(e).attr("title",n.toDate())):void 0})},n.prototype._initSVGHandling=function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")?$("html").addClass("svg"):$("html").addClass("no-svg")},n.prototype._initJSHandling=function(){return $("html").addClass("js").removeClass("no-js")},n.prototype._initTopbarMenu=function(){return new TC.TopbarToggleMenu({el:this.$(".topbar-edition-selector")}),new TC.TopbarToggleMenu({el:this.$(".topbar-account-nav")})},n}(Backbone.View)}.call(this),function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():window.pym=t.call(this)}(function(){var t="xPYMx",e={},n=function(t){var e=new RegExp("[\\?&]"+t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)"),n=e.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},i=function(t,e){return"*"===e.xdomain||t.origin.match(new RegExp(e.xdomain+"$"))?!0:void 0},r=function(e,n,i){var r=["pym",e,n,i];return r.join(t)},o=function(e){var n=["pym",e,"(\\S+)","(.+)"];return new RegExp("^"+n.join(t)+"$")},s=function(){for(var t=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])"),n=t.length,i=0;n>i;++i){var r=t[i];r.setAttribute("data-pym-auto-initialized",""),""===r.id&&(r.id="pym-"+i);var o=r.getAttribute("data-pym-src"),s=r.getAttribute("data-pym-xdomain"),a={};s&&(a.xdomain=s),new e.Parent(r.id,o,a)}};return e.Parent=function(t,e,n){this.id=t,this.url=e,this.el=document.getElementById(t),this.iframe=null,this.settings={xdomain:"*"},this.messageRegex=o(this.id),this.messageHandlers={},n=n||{},this._constructIframe=function(){var t=this.el.offsetWidth.toString();this.iframe=document.createElement("iframe");var e="",n=this.url.indexOf("#");n>-1&&(e=this.url.substring(n,this.url.length),this.url=this.url.substring(0,n)),this.url.indexOf("?")<0?this.url+="?":this.url+="&",this.iframe.src=this.url+"initialWidth="+t+"&childId="+this.id+"&parentUrl="+encodeURIComponent(window.location.href)+e,this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("frameborder","0"),this.settings.title&&this.iframe.setAttribute("title",this.settings.title),this.el.appendChild(this.iframe),window.addEventListener("resize",this._onResize)},this._onResize=function(){this.sendWidth()}.bind(this),this._fire=function(t,e){if(t in this.messageHandlers)for(var n=0;n<this.messageHandlers[t].length;n++)this.messageHandlers[t][n].call(this,e)},this.remove=function(){window.removeEventListener("message",this._processMessage),window.removeEventListener("resize",this._onResize),this.el.removeChild(this.iframe)},this._processMessage=function(t){if(i(t,this.settings)&&"string"==typeof t.data){var e=t.data.match(this.messageRegex);if(!e||3!==e.length)return!1;var n=e[1],r=e[2];this._fire(n,r)}}.bind(this),this._onHeightMessage=function(t){var e=parseInt(t);this.iframe.setAttribute("height",e+"px")},this._onNavigateToMessage=function(t){document.location.href=t},this.onMessage=function(t,e){t in this.messageHandlers||(this.messageHandlers[t]=[]),this.messageHandlers[t].push(e)},this.sendMessage=function(t,e){this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(r(this.id,t,e),"*")},this.sendWidth=function(){var t=this.el.offsetWidth.toString();this.sendMessage("width",t)};for(var s in n)this.settings[s]=n[s];return this.onMessage("height",this._onHeightMessage),this.onMessage("navigateTo",this._onNavigateToMessage),window.addEventListener("message",this._processMessage,!1),this._constructIframe(),this},e.Child=function(e){this.parentWidth=null,this.id=null,this.parentUrl=null,this.settings={renderCallback:null,xdomain:"*",polling:0},this.messageRegex=null,this.messageHandlers={},e=e||{},this.onMessage=function(t,e){t in this.messageHandlers||(this.messageHandlers[t]=[]),this.messageHandlers[t].push(e)},this._fire=function(t,e){if(t in this.messageHandlers)for(var n=0;n<this.messageHandlers[t].length;n++)this.messageHandlers[t][n].call(this,e)},this._processMessage=function(t){if(i(t,this.settings)&&"string"==typeof t.data){var e=t.data.match(this.messageRegex);if(e&&3===e.length){var n=e[1],r=e[2];this._fire(n,r)}}}.bind(this),this._onWidthMessage=function(t){var e=parseInt(t);e!==this.parentWidth&&(this.parentWidth=e,this.settings.renderCallback&&this.settings.renderCallback(e),this.sendHeight())},this.sendMessage=function(t,e){window.parent.postMessage(r(this.id,t,e),"*")},this.sendHeight=function(){var t=document.getElementsByTagName("body")[0].offsetHeight.toString();this.sendMessage("height",t)}.bind(this),this.scrollParentTo=function(t){this.sendMessage("navigateTo","#"+t)},this.navigateParentTo=function(t){this.sendMessage("navigateTo",t)},this.id=n("childId")||e.id,this.messageRegex=new RegExp("^pym"+t+this.id+t+"(\\S+)"+t+"(.+)$");var o=parseInt(n("initialWidth"));this.parentUrl=n("parentUrl"),this.onMessage("width",this._onWidthMessage);for(var s in e)this.settings[s]=e[s];return window.addEventListener("message",this._processMessage,!1),this.settings.renderCallback&&this.settings.renderCallback(o),this.sendHeight(),this.settings.polling&&window.setInterval(this.sendHeight,this.settings.polling),this},s(),e}),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.Comments=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.url=function(){return"/comments?content_id="+this.content_id},n.prototype.initialize=function(t){return this.content_id=t.content_id},n}(Backbone.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.CommentsRecommends=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.url="/comments/recommends",n.prototype.initialize=function(t,e){var n;return n=null!=e,this.content_id=n.content_id,n},n}(Backbone.Collection)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.Comment=function(e){function i(){return this.remove=t(this.remove,this),this.restore=t(this.restore,this),this["delete"]=t(this["delete"],this),this.unrecommend=t(this.unrecommend,this),this.recommend=t(this.recommend,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.urlRoot="/comments",i.prototype.recommend=function(){return $.ajax({url:this._recommendUrl(),type:"POST"})},i.prototype.unrecommend=function(){return $.ajax({url:this._unrecommendUrl(),type:"DELETE"})},i.prototype["delete"]=function(){return $.ajax({url:this._deleteUrl(),type:"POST",dataType:"json",success:function(t){return function(e){return t.trigger("comment:deleted",e.message)}}(this),error:function(t){return function(e){return t.trigger("comment:deleted:failure",e.message)}}(this)})},i.prototype.restore=function(){return $.ajax({url:this._restoreUrl(),type:"POST",dataType:"json",success:function(t){return function(e){return t.trigger("comment:restored",e.message)}}(this),error:function(t){return function(e){return t.trigger("comment:restored:failure",e.message)}}(this)})},i.prototype.remove=function(t){return $.ajax({url:this._removeUrl(),type:"POST",dataType:"json",data:t,success:function(t){return function(e){return t.trigger("comment:removed",e.message)}}(this),error:function(t){return function(e){return t.trigger("comment:removed:failure",e.message)}}(this)})},i.prototype._deleteUrl=function(){return"editorial"+this.url()+"/remove"},i.prototype._restoreUrl=function(){return"editorial"+this.url()+"/restore"},i.prototype._removeUrl=function(){return""+this.url()+"/remove"},i.prototype._recommendUrl=function(){return""+this.url()+"/recommends?thrust=positive"},i.prototype._unrecommendUrl=function(){return""+this.url()+"/unrecommend"},i}(Backbone.Model)}.call(this),function(){TC.PermissionsBase=function(){function t(){}return t.prototype.validate=function(t){return this.permissions[t]||!1},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.CommentsSignedInPermissions=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.permissions={_renderCommentRecommendsView:!0,_renderSignInToCommentButtonView:!1,_renderNewCommentButtonView:!0,_renderContentSubscriptionIndicatorView:!0,_renderReportButton:!0,_renderReplyButton:!0,_renderModeratorControls:!1,_renderEditorControls:!1},n}(TC.PermissionsBase)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.CommentsEditorPermissions=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.permissions={_renderCloseCommentsButtonView:!0,_renderOpenCommentsButtonView:!0,_renderCommentRecommendsView:!0,_renderContentSubscriptionIndicatorView:!0,_renderSignInToCommentButtonView:!1,_renderNewCommentButtonView:!0,_renderReportButton:!0,_renderReplyButton:!0,_renderModeratorControls:!1,_renderEditorControls:!0},n}(TC.PermissionsBase)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.CommentsModeratorPermissions=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.permissions={_renderModeratorControls:!0,_renderCommentRecommendsView:!0,_renderContentSubscriptionIndicatorView:!0,_renderNewCommentButtonView:!0,_renderReportButton:!0,_renderReplyButton:!0},n}(TC.PermissionsBase)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.CommentsUnauthedPermissions=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.permissions={_renderSignInToCommentButtonView:!0,_renderNewCommentButtonView:!1,_renderContentSubscriptionIndicatorView:!1,_renderReportButton:!0,_renderModeratorControls:!1,_renderEditorControls:!1},n}(TC.PermissionsBase)}.call(this),function(t){function e(t,e,n){switch(arguments.length){case 2:return null!=t?t:e;case 3:return null!=t?t:null!=e?e:n;default:throw new Error("Implement me")}}function n(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function i(t,e){function n(){pt.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}var i=!0;return c(function(){return i&&(n(),i=!1),e.apply(this,arguments)},e)}function r(t,e){return function(n){return p(t.call(this,n),e)}}function o(t,e){return function(n){return this.lang().ordinal(t.call(this,n),e)}}function s(){}function a(t){x(t),c(this,t)}function l(t){var e=_(t),n=e.year||0,i=e.quarter||0,r=e.month||0,o=e.week||0,s=e.day||0,a=e.hour||0,l=e.minute||0,c=e.second||0,u=e.millisecond||0;this._milliseconds=+u+1e3*c+6e4*l+36e5*a,this._days=+s+7*o,this._months=+r+3*i+12*n,this._data={},this._bubble()}function c(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return e.hasOwnProperty("toString")&&(t.toString=e.toString),e.hasOwnProperty("valueOf")&&(t.valueOf=e.valueOf),t}function u(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&St.hasOwnProperty(e)&&(n[e]=t[e]);return n}function h(t){return 0>t?Math.ceil(t):Math.floor(t)}function p(t,e,n){for(var i=""+Math.abs(t),r=t>=0;i.length<e;)i="0"+i;return(r?n?"+":"":"-")+i}function d(t,e,n,i){var r=e._milliseconds,o=e._days,s=e._months;i=null==i?!0:i,r&&t._d.setTime(+t._d+r*n),o&&at(t,"Date",st(t,"Date")+o*n),s&&ot(t,st(t,"Month")+s*n),i&&pt.updateOffset(t,o||s)}function f(t){return"[object Array]"===Object.prototype.toString.call(t)}function m(t){return"[object Date]"===Object.prototype.toString.call(t)||t instanceof Date}function g(t,e,n){var i,r=Math.min(t.length,e.length),o=Math.abs(t.length-e.length),s=0;for(i=0;r>i;i++)(n&&t[i]!==e[i]||!n&&b(t[i])!==b(e[i]))&&s++;return s+o}function y(t){if(t){var e=t.toLowerCase().replace(/(.)s$/,"$1");t=ee[t]||ne[e]||e}return t}function _(t){var e,n,i={};for(n in t)t.hasOwnProperty(n)&&(e=y(n),e&&(i[e]=t[n]));return i}function v(e){var n,i;if(0===e.indexOf("week"))n=7,i="day";else{if(0!==e.indexOf("month"))return;n=12,i="month"}pt[e]=function(r,o){var s,a,l=pt.fn._lang[e],c=[];if("number"==typeof r&&(o=r,r=t),a=function(t){var e=pt().utc().set(i,t);return l.call(pt.fn._lang,e,r||"")},null!=o)return a(o);for(s=0;n>s;s++)c.push(a(s));return c}}function b(t){var e=+t,n=0;return 0!==e&&isFinite(e)&&(n=e>=0?Math.floor(e):Math.ceil(e)),n}function w(t,e){return new Date(Date.UTC(t,e+1,0)).getUTCDate()}function C(t,e,n){return et(pt([t,11,31+e-n]),e,n).week}function T(t){return k(t)?366:365}function k(t){return t%4===0&&t%100!==0||t%400===0}function x(t){var e;t._a&&-2===t._pf.overflow&&(e=t._a[vt]<0||t._a[vt]>11?vt:t._a[bt]<1||t._a[bt]>w(t._a[_t],t._a[vt])?bt:t._a[wt]<0||t._a[wt]>23?wt:t._a[Ct]<0||t._a[Ct]>59?Ct:t._a[Tt]<0||t._a[Tt]>59?Tt:t._a[kt]<0||t._a[kt]>999?kt:-1,t._pf._overflowDayOfYear&&(_t>e||e>bt)&&(e=bt),t._pf.overflow=e)}function S(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length)),t._isValid}function A(t){return t?t.toLowerCase().replace("_","-"):t}function D(t,e){return e._isUTC?pt(t).zone(e._offset||0):pt(t).local()}function P(t,e){return e.abbr=t,xt[t]||(xt[t]=new s),xt[t].set(e),xt[t]}function E(t){delete xt[t]}function $(t){var e,n,i,r,o=0,s=function(t){if(!xt[t]&&At)try{require("./lang/"+t)}catch(e){}return xt[t]};if(!t)return pt.fn._lang;if(!f(t)){if(n=s(t))return n;t=[t]}for(;o<t.length;){for(r=A(t[o]).split("-"),e=r.length,i=A(t[o+1]),i=i?i.split("-"):null;e>0;){if(n=s(r.slice(0,e).join("-")))return n;if(i&&i.length>=e&&g(r,i,!0)>=e-1)break;e--}o++}return pt.fn._lang}function M(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function V(t){var e,n,i=t.match($t);for(e=0,n=i.length;n>e;e++)ae[i[e]]?i[e]=ae[i[e]]:i[e]=M(i[e]);return function(r){var o="";for(e=0;n>e;e++)o+=i[e]instanceof Function?i[e].call(r,t):i[e];return o}}function I(t,e){return t.isValid()?(e=L(e,t.lang()),ie[e]||(ie[e]=V(e)),ie[e](t)):t.lang().invalidDate()}function L(t,e){function n(t){return e.longDateFormat(t)||t}var i=5;for(Mt.lastIndex=0;i>=0&&Mt.test(t);)t=t.replace(Mt,n),Mt.lastIndex=0,i-=1;return t}function B(t,e){var n,i=e._strict;switch(t){case"Q":return Yt;case"DDDD":return Wt;case"YYYY":case"GGGG":case"gggg":return i?jt:Lt;case"Y":case"G":case"g":return Gt;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?qt:Bt;case"S":if(i)return Yt;case"SS":if(i)return Ut;case"SSS":if(i)return Wt;case"DDD":return It;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Nt;case"a":case"A":return $(e._l)._meridiemParse;case"X":return Ft;case"Z":case"ZZ":return zt;case"T":return Rt;case"SSSS":return Ot;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?Ut:Vt;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Vt;case"Do":return Ht;default:return n=new RegExp(W(U(t.replace("\\","")),"i"))}}function O(t){t=t||"";var e=t.match(zt)||[],n=e[e.length-1]||[],i=(n+"").match(Zt)||["-",0,0],r=+(60*i[1])+b(i[2]);return"+"===i[0]?-r:r}function N(t,e,n){var i,r=n._a;switch(t){case"Q":null!=e&&(r[vt]=3*(b(e)-1));break;case"M":case"MM":null!=e&&(r[vt]=b(e)-1);break;case"MMM":case"MMMM":i=$(n._l).monthsParse(e),null!=i?r[vt]=i:n._pf.invalidMonth=e;break;case"D":case"DD":null!=e&&(r[bt]=b(e));break;case"Do":null!=e&&(r[bt]=b(parseInt(e,10)));break;case"DDD":case"DDDD":null!=e&&(n._dayOfYear=b(e));break;case"YY":r[_t]=pt.parseTwoDigitYear(e);break;case"YYYY":case"YYYYY":case"YYYYYY":r[_t]=b(e);break;case"a":case"A":n._isPm=$(n._l).isPM(e);break;case"H":case"HH":case"h":case"hh":r[wt]=b(e);break;case"m":case"mm":r[Ct]=b(e);break;case"s":case"ss":r[Tt]=b(e);break;case"S":case"SS":case"SSS":case"SSSS":r[kt]=b(1e3*("0."+e));break;case"X":n._d=new Date(1e3*parseFloat(e));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=O(e);break;case"dd":case"ddd":case"dddd":i=$(n._l).weekdaysParse(e),null!=i?(n._w=n._w||{},n._w.d=i):n._pf.invalidWeekday=e;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":t=t.substr(0,1);case"gggg":case"GGGG":case"GGGGG":t=t.substr(0,2),e&&(n._w=n._w||{},n._w[t]=b(e));break;case"gg":case"GG":n._w=n._w||{},n._w[t]=pt.parseTwoDigitYear(e)}}function z(t){var n,i,r,o,s,a,l,c;n=t._w,null!=n.GG||null!=n.W||null!=n.E?(s=1,a=4,i=e(n.GG,t._a[_t],et(pt(),1,4).year),r=e(n.W,1),o=e(n.E,1)):(c=$(t._l),s=c._week.dow,a=c._week.doy,i=e(n.gg,t._a[_t],et(pt(),s,a).year),r=e(n.w,1),null!=n.d?(o=n.d,s>o&&++r):o=null!=n.e?n.e+s:s),l=nt(i,r,o,a,s),t._a[_t]=l.year,t._dayOfYear=l.dayOfYear}function R(t){var n,i,r,o,s=[];if(!t._d){for(r=H(t),t._w&&null==t._a[bt]&&null==t._a[vt]&&z(t),t._dayOfYear&&(o=e(t._a[_t],r[_t]),t._dayOfYear>T(o)&&(t._pf._overflowDayOfYear=!0),i=Q(o,0,t._dayOfYear),t._a[vt]=i.getUTCMonth(),t._a[bt]=i.getUTCDate()),n=0;3>n&&null==t._a[n];++n)t._a[n]=s[n]=r[n];for(;7>n;n++)t._a[n]=s[n]=null==t._a[n]?2===n?1:0:t._a[n];t._d=(t._useUTC?Q:K).apply(null,s),null!=t._tzm&&t._d.setUTCMinutes(t._d.getUTCMinutes()+t._tzm)}}function F(t){var e;t._d||(e=_(t._i),t._a=[e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond],R(t))}function H(t){var e=new Date;return t._useUTC?[e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]:[e.getFullYear(),e.getMonth(),e.getDate()]}function Y(t){if(t._f===pt.ISO_8601)return void q(t);t._a=[],t._pf.empty=!0;var e,n,i,r,o,s=$(t._l),a=""+t._i,l=a.length,c=0;for(i=L(t._f,s).match($t)||[],e=0;e<i.length;e++)r=i[e],n=(a.match(B(r,t))||[])[0],n&&(o=a.substr(0,a.indexOf(n)),o.length>0&&t._pf.unusedInput.push(o),a=a.slice(a.indexOf(n)+n.length),c+=n.length),ae[r]?(n?t._pf.empty=!1:t._pf.unusedTokens.push(r),N(r,n,t)):t._strict&&!n&&t._pf.unusedTokens.push(r);t._pf.charsLeftOver=l-c,a.length>0&&t._pf.unusedInput.push(a),t._isPm&&t._a[wt]<12&&(t._a[wt]+=12),t._isPm===!1&&12===t._a[wt]&&(t._a[wt]=0),R(t),x(t)}function U(t){return t.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,n,i,r){return e||n||i||r})}function W(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function j(t){var e,i,r,o,s;if(0===t._f.length)return t._pf.invalidFormat=!0,void(t._d=new Date(NaN));for(o=0;o<t._f.length;o++)s=0,e=c({},t),e._pf=n(),e._f=t._f[o],Y(e),S(e)&&(s+=e._pf.charsLeftOver,s+=10*e._pf.unusedTokens.length,e._pf.score=s,(null==r||r>s)&&(r=s,i=e));c(t,i||e)}function q(t){var e,n,i=t._i,r=Xt.exec(i);if(r){for(t._pf.iso=!0,e=0,n=Qt.length;n>e;e++)if(Qt[e][1].exec(i)){t._f=Qt[e][0]+(r[6]||" ");break}for(e=0,n=Jt.length;n>e;e++)if(Jt[e][1].exec(i)){t._f+=Jt[e][0];break}i.match(zt)&&(t._f+="Z"),Y(t)}else t._isValid=!1}function G(t){q(t),t._isValid===!1&&(delete t._isValid,pt.createFromInputFallback(t))}function X(e){var n=e._i,i=Dt.exec(n);n===t?e._d=new Date:i?e._d=new Date(+i[1]):"string"==typeof n?G(e):f(n)?(e._a=n.slice(0),R(e)):m(n)?e._d=new Date(+n):"object"==typeof n?F(e):"number"==typeof n?e._d=new Date(n):pt.createFromInputFallback(e)}function K(t,e,n,i,r,o,s){var a=new Date(t,e,n,i,r,o,s);return 1970>t&&a.setFullYear(t),a}function Q(t){var e=new Date(Date.UTC.apply(null,arguments));return 1970>t&&e.setUTCFullYear(t),e}function J(t,e){if("string"==typeof t)if(isNaN(t)){if(t=e.weekdaysParse(t),"number"!=typeof t)return null}else t=parseInt(t,10);return t}function Z(t,e,n,i,r){return r.relativeTime(e||1,!!n,t,i)}function tt(t,e,n){var i=yt(Math.abs(t)/1e3),r=yt(i/60),o=yt(r/60),s=yt(o/24),a=yt(s/365),l=i<re.s&&["s",i]||1===r&&["m"]||r<re.m&&["mm",r]||1===o&&["h"]||o<re.h&&["hh",o]||1===s&&["d"]||s<=re.dd&&["dd",s]||s<=re.dm&&["M"]||s<re.dy&&["MM",yt(s/30)]||1===a&&["y"]||["yy",a];return l[2]=e,l[3]=t>0,l[4]=n,Z.apply({},l)}function et(t,e,n){var i,r=n-e,o=n-t.day();return o>r&&(o-=7),r-7>o&&(o+=7),i=pt(t).add("d",o),{week:Math.ceil(i.dayOfYear()/7),year:i.year()}}function nt(t,e,n,i,r){var o,s,a=Q(t,0,1).getUTCDay();return a=0===a?7:a,n=null!=n?n:r,o=r-a+(a>i?7:0)-(r>a?7:0),s=7*(e-1)+(n-r)+o+1,{year:s>0?t:t-1,dayOfYear:s>0?s:T(t-1)+s}}function it(e){var n=e._i,i=e._f;return null===n||i===t&&""===n?pt.invalid({nullInput:!0}):("string"==typeof n&&(e._i=n=$().preparse(n)),pt.isMoment(n)?(e=u(n),e._d=new Date(+n._d)):i?f(i)?j(e):Y(e):X(e),new a(e))}function rt(t,e){var n,i;if(1===e.length&&f(e[0])&&(e=e[0]),!e.length)return pt();for(n=e[0],i=1;i<e.length;++i)e[i][t](n)&&(n=e[i]);return n}function ot(t,e){var n;return"string"==typeof e&&(e=t.lang().monthsParse(e),"number"!=typeof e)?t:(n=Math.min(t.date(),w(t.year(),e)),t._d["set"+(t._isUTC?"UTC":"")+"Month"](e,n),t)}function st(t,e){return t._d["get"+(t._isUTC?"UTC":"")+e]()}function at(t,e,n){return"Month"===e?ot(t,n):t._d["set"+(t._isUTC?"UTC":"")+e](n)}function lt(t,e){return function(n){return null!=n?(at(this,t,n),pt.updateOffset(this,e),this):st(this,t)}}function ct(t){pt.duration.fn[t]=function(){return this._data[t]}}function ut(t,e){pt.duration.fn["as"+t]=function(){return+this/e}}function ht(t){"undefined"==typeof ender&&(dt=gt.moment,t?gt.moment=i("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",pt):gt.moment=pt)}for(var pt,dt,ft,mt="2.7.0",gt="undefined"!=typeof global?global:this,yt=Math.round,_t=0,vt=1,bt=2,wt=3,Ct=4,Tt=5,kt=6,xt={},St={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_tzm:null,_isUTC:null,_offset:null,_pf:null,_lang:null},At="undefined"!=typeof module&&module.exports,Dt=/^\/?Date\((\-?\d+)/i,Pt=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Et=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,$t=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,Mt=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,Vt=/\d\d?/,It=/\d{1,3}/,Lt=/\d{1,4}/,Bt=/[+\-]?\d{1,6}/,Ot=/\d+/,Nt=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,zt=/Z|[\+\-]\d\d:?\d\d/gi,Rt=/T/i,Ft=/[\+\-]?\d+(\.\d{1,3})?/,Ht=/\d{1,2}/,Yt=/\d/,Ut=/\d\d/,Wt=/\d{3}/,jt=/\d{4}/,qt=/[+-]?\d{6}/,Gt=/[+-]?\d+/,Xt=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Kt="YYYY-MM-DDTHH:mm:ssZ",Qt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],Jt=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Zt=/([\+\-]|\d\d)/gi,te=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),ee={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},ne={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ie={},re={s:45,m:45,h:22,dd:25,dm:45,dy:345},oe="DDD w W M D d".split(" "),se="M D H h m s w W".split(" "),ae={M:function(){return this.month()+1},MMM:function(t){return this.lang().monthsShort(this,t)},MMMM:function(t){return this.lang().months(this,t)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(t){return this.lang().weekdaysMin(this,t)},ddd:function(t){return this.lang().weekdaysShort(this,t)},dddd:function(t){return this.lang().weekdays(this,t)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return p(this.year()%100,2)},YYYY:function(){return p(this.year(),4)},YYYYY:function(){return p(this.year(),5)},YYYYYY:function(){var t=this.year(),e=t>=0?"+":"-";return e+p(Math.abs(t),6)},gg:function(){return p(this.weekYear()%100,2)},gggg:function(){return p(this.weekYear(),4)},ggggg:function(){return p(this.weekYear(),5)},GG:function(){return p(this.isoWeekYear()%100,2)},GGGG:function(){return p(this.isoWeekYear(),4)},GGGGG:function(){return p(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes();
},s:function(){return this.seconds()},S:function(){return b(this.milliseconds()/100)},SS:function(){return p(b(this.milliseconds()/10),2)},SSS:function(){return p(this.milliseconds(),3)},SSSS:function(){return p(this.milliseconds(),3)},Z:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+p(b(t/60),2)+":"+p(b(t)%60,2)},ZZ:function(){var t=-this.zone(),e="+";return 0>t&&(t=-t,e="-"),e+p(b(t/60),2)+p(b(t)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},le=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];oe.length;)ft=oe.pop(),ae[ft+"o"]=o(ae[ft],ft);for(;se.length;)ft=se.pop(),ae[ft+ft]=r(ae[ft],2);for(ae.DDDD=r(ae.DDD,3),c(s.prototype,{set:function(t){var e,n;for(n in t)e=t[n],"function"==typeof e?this[n]=e:this["_"+n]=e},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(t){return this._months[t.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(t){return this._monthsShort[t.month()]},monthsParse:function(t){var e,n,i;for(this._monthsParse||(this._monthsParse=[]),e=0;12>e;e++)if(this._monthsParse[e]||(n=pt.utc([2e3,e]),i="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[e]=new RegExp(i.replace(".",""),"i")),this._monthsParse[e].test(t))return e},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(t){return this._weekdays[t.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(t){return this._weekdaysShort[t.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(t){return this._weekdaysMin[t.day()]},weekdaysParse:function(t){var e,n,i;for(this._weekdaysParse||(this._weekdaysParse=[]),e=0;7>e;e++)if(this._weekdaysParse[e]||(n=pt([2e3,1]).day(e),i="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[e]=new RegExp(i.replace(".",""),"i")),this._weekdaysParse[e].test(t))return e},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(t){var e=this._longDateFormat[t];return!e&&this._longDateFormat[t.toUpperCase()]&&(e=this._longDateFormat[t.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t]=e),e},isPM:function(t){return"p"===(t+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(t,e,n){return t>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(t,e){var n=this._calendar[t];return"function"==typeof n?n.apply(e):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(t,e,n,i){var r=this._relativeTime[n];return"function"==typeof r?r(t,e,n,i):r.replace(/%d/i,t)},pastFuture:function(t,e){var n=this._relativeTime[t>0?"future":"past"];return"function"==typeof n?n(e):n.replace(/%s/i,e)},ordinal:function(t){return this._ordinal.replace("%d",t)},_ordinal:"%d",preparse:function(t){return t},postformat:function(t){return t},week:function(t){return et(t,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),pt=function(e,i,r,o){var s;return"boolean"==typeof r&&(o=r,r=t),s={},s._isAMomentObject=!0,s._i=e,s._f=i,s._l=r,s._strict=o,s._isUTC=!1,s._pf=n(),it(s)},pt.suppressDeprecationWarnings=!1,pt.createFromInputFallback=i("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(t){t._d=new Date(t._i)}),pt.min=function(){var t=[].slice.call(arguments,0);return rt("isBefore",t)},pt.max=function(){var t=[].slice.call(arguments,0);return rt("isAfter",t)},pt.utc=function(e,i,r,o){var s;return"boolean"==typeof r&&(o=r,r=t),s={},s._isAMomentObject=!0,s._useUTC=!0,s._isUTC=!0,s._l=r,s._i=e,s._f=i,s._strict=o,s._pf=n(),it(s).utc()},pt.unix=function(t){return pt(1e3*t)},pt.duration=function(t,e){var n,i,r,o=t,s=null;return pt.isDuration(t)?o={ms:t._milliseconds,d:t._days,M:t._months}:"number"==typeof t?(o={},e?o[e]=t:o.milliseconds=t):(s=Pt.exec(t))?(n="-"===s[1]?-1:1,o={y:0,d:b(s[bt])*n,h:b(s[wt])*n,m:b(s[Ct])*n,s:b(s[Tt])*n,ms:b(s[kt])*n}):(s=Et.exec(t))&&(n="-"===s[1]?-1:1,r=function(t){var e=t&&parseFloat(t.replace(",","."));return(isNaN(e)?0:e)*n},o={y:r(s[2]),M:r(s[3]),d:r(s[4]),h:r(s[5]),m:r(s[6]),s:r(s[7]),w:r(s[8])}),i=new l(o),pt.isDuration(t)&&t.hasOwnProperty("_lang")&&(i._lang=t._lang),i},pt.version=mt,pt.defaultFormat=Kt,pt.ISO_8601=function(){},pt.momentProperties=St,pt.updateOffset=function(){},pt.relativeTimeThreshold=function(e,n){return re[e]===t?!1:(re[e]=n,!0)},pt.lang=function(t,e){var n;return t?(e?P(A(t),e):null===e?(E(t),t="en"):xt[t]||$(t),n=pt.duration.fn._lang=pt.fn._lang=$(t),n._abbr):pt.fn._lang._abbr},pt.langData=function(t){return t&&t._lang&&t._lang._abbr&&(t=t._lang._abbr),$(t)},pt.isMoment=function(t){return t instanceof a||null!=t&&t.hasOwnProperty("_isAMomentObject")},pt.isDuration=function(t){return t instanceof l},ft=le.length-1;ft>=0;--ft)v(le[ft]);pt.normalizeUnits=function(t){return y(t)},pt.invalid=function(t){var e=pt.utc(NaN);return null!=t?c(e._pf,t):e._pf.userInvalidated=!0,e},pt.parseZone=function(){return pt.apply(null,arguments).parseZone()},pt.parseTwoDigitYear=function(t){return b(t)+(b(t)>68?1900:2e3)},c(pt.fn=a.prototype,{clone:function(){return pt(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var t=pt(this).utc();return 0<t.year()&&t.year()<=9999?I(t,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):I(t,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var t=this;return[t.year(),t.month(),t.date(),t.hours(),t.minutes(),t.seconds(),t.milliseconds()]},isValid:function(){return S(this)},isDSTShifted:function(){return this._a?this.isValid()&&g(this._a,(this._isUTC?pt.utc(this._a):pt(this._a)).toArray())>0:!1},parsingFlags:function(){return c({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(t){var e=I(this,t||pt.defaultFormat);return this.lang().postformat(e)},add:function(t,e){var n;return n="string"==typeof t&&"string"==typeof e?pt.duration(isNaN(+e)?+t:+e,isNaN(+e)?e:t):"string"==typeof t?pt.duration(+e,t):pt.duration(t,e),d(this,n,1),this},subtract:function(t,e){var n;return n="string"==typeof t&&"string"==typeof e?pt.duration(isNaN(+e)?+t:+e,isNaN(+e)?e:t):"string"==typeof t?pt.duration(+e,t):pt.duration(t,e),d(this,n,-1),this},diff:function(t,e,n){var i,r,o=D(t,this),s=6e4*(this.zone()-o.zone());return e=y(e),"year"===e||"month"===e?(i=432e5*(this.daysInMonth()+o.daysInMonth()),r=12*(this.year()-o.year())+(this.month()-o.month()),r+=(this-pt(this).startOf("month")-(o-pt(o).startOf("month")))/i,r-=6e4*(this.zone()-pt(this).startOf("month").zone()-(o.zone()-pt(o).startOf("month").zone()))/i,"year"===e&&(r/=12)):(i=this-o,r="second"===e?i/1e3:"minute"===e?i/6e4:"hour"===e?i/36e5:"day"===e?(i-s)/864e5:"week"===e?(i-s)/6048e5:i),n?r:h(r)},from:function(t,e){return pt.duration(this.diff(t)).lang(this.lang()._abbr).humanize(!e)},fromNow:function(t){return this.from(pt(),t)},calendar:function(t){var e=t||pt(),n=D(e,this).startOf("day"),i=this.diff(n,"days",!0),r=-6>i?"sameElse":-1>i?"lastWeek":0>i?"lastDay":1>i?"sameDay":2>i?"nextDay":7>i?"nextWeek":"sameElse";return this.format(this.lang().calendar(r,this))},isLeapYear:function(){return k(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(t){var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?(t=J(t,this.lang()),this.add({d:t-e})):e},month:lt("Month",!0),startOf:function(t){switch(t=y(t)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t?this.weekday(0):"isoWeek"===t&&this.isoWeekday(1),"quarter"===t&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=y(t),this.startOf(t).add("isoWeek"===t?"week":t,1).subtract("ms",1)},isAfter:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)>+pt(t).startOf(e)},isBefore:function(t,e){return e="undefined"!=typeof e?e:"millisecond",+this.clone().startOf(e)<+pt(t).startOf(e)},isSame:function(t,e){return e=e||"ms",+this.clone().startOf(e)===+D(t,this).startOf(e)},min:i("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(t){return t=pt.apply(null,arguments),this>t?this:t}),max:i("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(t){return t=pt.apply(null,arguments),t>this?this:t}),zone:function(t,e){var n=this._offset||0;return null==t?this._isUTC?n:this._d.getTimezoneOffset():("string"==typeof t&&(t=O(t)),Math.abs(t)<16&&(t=60*t),this._offset=t,this._isUTC=!0,n!==t&&(!e||this._changeInProgress?d(this,pt.duration(n-t,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,pt.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(t){return t=t?pt(t).zone():0,(this.zone()-t)%60===0},daysInMonth:function(){return w(this.year(),this.month())},dayOfYear:function(t){var e=yt((pt(this).startOf("day")-pt(this).startOf("year"))/864e5)+1;return null==t?e:this.add("d",t-e)},quarter:function(t){return null==t?Math.ceil((this.month()+1)/3):this.month(3*(t-1)+this.month()%3)},weekYear:function(t){var e=et(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==t?e:this.add("y",t-e)},isoWeekYear:function(t){var e=et(this,1,4).year;return null==t?e:this.add("y",t-e)},week:function(t){var e=this.lang().week(this);return null==t?e:this.add("d",7*(t-e))},isoWeek:function(t){var e=et(this,1,4).week;return null==t?e:this.add("d",7*(t-e))},weekday:function(t){var e=(this.day()+7-this.lang()._week.dow)%7;return null==t?e:this.add("d",t-e)},isoWeekday:function(t){return null==t?this.day()||7:this.day(this.day()%7?t:t-7)},isoWeeksInYear:function(){return C(this.year(),1,4)},weeksInYear:function(){var t=this._lang._week;return C(this.year(),t.dow,t.doy)},get:function(t){return t=y(t),this[t]()},set:function(t,e){return t=y(t),"function"==typeof this[t]&&this[t](e),this},lang:function(e){return e===t?this._lang:(this._lang=$(e),this)}}),pt.fn.millisecond=pt.fn.milliseconds=lt("Milliseconds",!1),pt.fn.second=pt.fn.seconds=lt("Seconds",!1),pt.fn.minute=pt.fn.minutes=lt("Minutes",!1),pt.fn.hour=pt.fn.hours=lt("Hours",!0),pt.fn.date=lt("Date",!0),pt.fn.dates=i("dates accessor is deprecated. Use date instead.",lt("Date",!0)),pt.fn.year=lt("FullYear",!0),pt.fn.years=i("years accessor is deprecated. Use year instead.",lt("FullYear",!0)),pt.fn.days=pt.fn.day,pt.fn.months=pt.fn.month,pt.fn.weeks=pt.fn.week,pt.fn.isoWeeks=pt.fn.isoWeek,pt.fn.quarters=pt.fn.quarter,pt.fn.toJSON=pt.fn.toISOString,c(pt.duration.fn=l.prototype,{_bubble:function(){var t,e,n,i,r=this._milliseconds,o=this._days,s=this._months,a=this._data;a.milliseconds=r%1e3,t=h(r/1e3),a.seconds=t%60,e=h(t/60),a.minutes=e%60,n=h(e/60),a.hours=n%24,o+=h(n/24),a.days=o%30,s+=h(o/30),a.months=s%12,i=h(s/12),a.years=i},weeks:function(){return h(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*b(this._months/12)},humanize:function(t){var e=+this,n=tt(e,!t,this.lang());return t&&(n=this.lang().pastFuture(e,n)),this.lang().postformat(n)},add:function(t,e){var n=pt.duration(t,e);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(t,e){var n=pt.duration(t,e);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(t){return t=y(t),this[t.toLowerCase()+"s"]()},as:function(t){return t=y(t),this["as"+t.charAt(0).toUpperCase()+t.slice(1)+"s"]()},lang:pt.fn.lang,toIsoString:function(){var t=Math.abs(this.years()),e=Math.abs(this.months()),n=Math.abs(this.days()),i=Math.abs(this.hours()),r=Math.abs(this.minutes()),o=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(t?t+"Y":"")+(e?e+"M":"")+(n?n+"D":"")+(i||r||o?"T":"")+(i?i+"H":"")+(r?r+"M":"")+(o?o+"S":""):"P0D"}});for(ft in te)te.hasOwnProperty(ft)&&(ut(ft,te[ft]),ct(ft.toLowerCase()));ut("Weeks",6048e5),pt.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},pt.lang("en",{ordinal:function(t){var e=t%10,n=1===b(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n}}),At?module.exports=pt:"function"==typeof define&&define.amd?(define("moment",function(t,e,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(gt.moment=dt),pt}),ht(!0)):ht()}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.CommentEditorControlsView=function(e){function i(){return this._handleDelete=t(this._handleDelete,this),this._handleRestore=t(this._handleRestore,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.className="comment-editor-controls-view",i.prototype.events={"click .restore":"_handleRestore","click .delete":"_handleDelete"},i.prototype.template=_.template('<a class="moderation-control" href="mailto:<%- comment_user_email %>"><%- i18n.t(\'comment.button.email\') %></a>\n<a class="moderation-control" href="<%- editorial_comments_path %>"><%- i18n.t(\'comment.button.all_comments\') %></a>\n<a class="moderation-control restore" href="#"><%- i18n.t(\'comment.button.restore\') %></a>\n<a class="moderation-control delete" href="#"><%- i18n.t(\'comment.button.delete\') %></a>'),i.prototype.initialize=function(t){return this.comment_user_email=t.comment_user_email,this.comment_user_id=t.comment_user_id,this.render()},i.prototype.render=function(){return this.$el.html(this.template({comment_user_email:this.comment_user_email,editorial_comments_path:this._editorialCommentsPathFor(this.comment_user_id)}))},i.prototype._handleRestore=function(t){return t.preventDefault(),confirm(i18n.t("comment.messages.restore_comment"))?this.trigger("comment:restore"):void 0},i.prototype._handleDelete=function(t){return t.preventDefault(),confirm(i18n.t("comment.messages.remove_comment"))?this.trigger("comment:delete"):void 0},i.prototype._editorialCommentsPathFor=function(t){return"/editorial/comments?user_id="+t},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.LargeTooltipView=function(e){function i(){return this._listenToOutsideClick=t(this._listenToOutsideClick,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t)},i.prototype.show=function(){return this.$el.show()},i.prototype.hide=function(){return this.$el.hide()},i.prototype.toggle=function(){return this.$el.is(":visible")?this.hide():(this.show(),this._listenToOutsideClick())},i.prototype._listenToOutsideClick=function(){return _.defer(function(t){return function(){var e;return e=t.$el[0].className.split(" ")[0],$("body").one("click.tooltip focusin.tooltip",function(n){return $(n.target).hasClass(e)||$(n.target).parents("."+e).length>0?t._listenToOutsideClick():($("body").off("click.tooltip focusin.tooltip"),t.hide())})}}(this))},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.CommentModeratorReasonView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="comment-moderator-reason-view large-tooltip arrow-left",n.prototype.events={"submit form":"_handleSubmit"},n.prototype.reasons=["Personal abuse","Defamatory","Misinformation","Offensive","Threatening","Trolling","Discriminatory","Discredited research","Copyright infringement","Spam","Off topic"],n.prototype.template=_.template('<h4>\n  Comment removal\n</h4>\n\n<p>This comment will be temporarily hidden from public view and placed in a moderation queue.</p>\n<p>Please provide a reason why this comment should be removed.</p>\n\n<form action="#">\n  <select name="reason">\n  <% _.each(reasons, function(reason) { %>\n    <option value="<%- reason %>"><%- reason %></option>\n  <% }); %>\n  </select>\n  <button class="button right" type="submit">Confirm removal</button>\n</form>'),n.prototype.alreadyApprovedTemplate=_.template("<h4>\n  Comment removal\n</h4>\n\n<p>This comment has already been approved by the Community Manager.</p>"),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.link=t.link,this.comment=t.comment,this.removalReason=this.comment.get("removal_reason"),this.removedAt=this.comment.get("removed_at"),this.render()},n.prototype.render=function(){var t;return t=this.link.position(),!this.removedAt&&this.removalReason?(this.$el.html(this.alreadyApprovedTemplate()),this.$el.css("left",t.left+70),this.$el.css("top",t.top-51)):(this.$el.html(this.template({reasons:this.reasons})),this.$el.css("left",t.left+70),this.$el.css("top",t.top-88)),this._listenToOutsideClick()},n.prototype._handleSubmit=function(t){return t.preventDefault(),this.trigger("reason:selected",$(t.target).serializeArray()),this.remove()},n}(TC.LargeTooltipView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.CommentModeratorControlsView=function(e){function i(){return this._handleRemove=t(this._handleRemove,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.className="comment-editor-controls-view",i.prototype.events={"click .remove":"_handleRemove"},i.prototype.template=_.template('<a class="moderation-control remove" href="#"><%- i18n.t(\'comment.button.remove\') %></a>'),i.prototype.initialize=function(t){return this.render(),this.comment=t.comment},i.prototype.render=function(){return this.$el.html(this.template())},i.prototype._handleRemove=function(t){return t.preventDefault(),this.commentModeratorReasonView=new TC.CommentModeratorReasonView({link:this.$el.find(".remove"),comment:this.comment}),this.commentModeratorReasonView.appendedTo(this.$el),this.commentModeratorReasonView.on("reason:selected",function(t){return function(e){return t.trigger("comment:remove",e)}}(this))},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.CommentRecommendsView=function(e){function i(){return this._handleRecommend=t(this._handleRecommend,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.tagName="div",i.prototype.className="comment-recommends-view",i.prototype.highlyRecommendedTemplate=_.template('<i class="icon-favourite"></i>\n<div class="hover tooltip bottom">\n  <p><%= i18n.t(\'comment.label.highly_recommended\') %></p>\n</div>'),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.recommended=null!=t?t.recommended:void 0,this.highlyRecommended=null!=t?t.highlyRecommended:void 0,this.highlyRecommended&&this.$el.addClass("highly-recommended"),this.recommendButtonView=new TC.ButtonView({label:this._buttonText(),className:this._buttonClass()}),this.recommendButtonView.on("click",this._handleRecommend),this.render()},i.prototype.render=function(){return this.highlyRecommended?this.el.innerHTML=this.highlyRecommendedTemplate():this.el.innerHTML="",this.recommendButtonView.appendedTo(this.$el)},i.prototype._updateButton=function(){return this.recommendButtonView.setTitle(this._buttonText()),this.recommendButtonView.el.className=this._buttonClass()},i.prototype._buttonClass=function(){return this.recommended?"button slim primary":"button slim"},i.prototype._buttonText=function(){return this.recommended?i18n.t("comment.button.recommended"):i18n.t("comment.button.recommend")},i.prototype._handleRecommend=function(t){return this.recommended=!this.recommended,this._updateButton(),this.recommended?this.trigger("comment:recommend"):this.trigger("comment:unrecommend")},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.CommentBodyView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="comment-body-view",n.prototype.events={"click .show-comment":"_showFullComment"},n.prototype.template=_.template('<div class="comment-body-wrapper">\n  <%= fullBody %>\n</div>\n<a class="show-comment" href="#"><%= i18n.t(\'comment.button.read_more\') %></a>'),n.prototype.initialize=function(t){return this.fullBody=t.fullBody,this.render()},n.prototype.render=function(){return this.el.innerHTML=this.template({fullBody:this.fullBody}),this.fullBody.length>1e3?$(this.el).addClass("truncated"):void 0},n.prototype._showFullComment=function(t){return t.preventDefault(),$(this.el).removeClass("truncated"),$(this.el).find(".show-comment").remove()},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.CommentView=function(e){function i(){return this._handleReply=t(this._handleReply,this),this._recursiveRenderReplies=t(this._recursiveRenderReplies,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.tagName="li",i.prototype.className="comment-view",i.prototype.template=_.template('<article id="comment_<%- id %>" class="comment <%- user_type %>">\n  <header class="meta">\n    <section class="attribution author-avatar large">\n      <img class="comment avatar rounded" data-echo="<%- user_avatar_url %>"\n        src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="">\n      <h3 class="fn">\n        <% if (user_profile_url) { %>\n          <a href="<%- user_profile_url %>"><%- user_full_name %></a>\n        <% } else { %>\n          <%- user_full_name %>\n        <% } %>\n        <% if (user_friend_of_tc) { %>\n          <a href="<%- this._donationUrl() %>" class="friend-of-the-conversation-badge">\n            <span>\n              <i class="icon-friend-of-tc-outer"></i>\n              <i class="icon-friend-of-tc-heart"></i>\n              <div class="hover tooltip bottom">\n                <%- i18n.t(\'comment.label.friend_of_the_conversation\', { name: user_full_name }) %>\n              </div>\n            </span>\n          </a>\n        <% } %>\n      </h3>\n      <p>\n        <% if (institution_name && institution_path) { %>\n          <% if (user_occupation) { %>\n            <%- user_occupation %>,\n          <% } %>\n\n          <a href="<%- institution_path %>"><%- institution_name %></a>\n        <% } else { %>\n          <%- user_occupation %>\n        <% } %>\n      </p>\n    </section>\n  </header>\n  <% if (parent_id != undefined) { %>\n    <section class="comment-in-reply-to">\n      <%- i18n.t(\'comment.label.in_reply_to\') %>\n      <a class="comment-in-reply-to-link" href="#comment_<%- parent_id %>">\n        <%- parent_user_full_name%>\n      </a>\n    </section>\n  <% } %>\n  <section class="comment-body">\n    <div class="full-comment">\n      <div class="more">\n        <a class="comment-reference-link" href="#comment_<%- id %>">\n          <time datetime="<%- created_at %>"><%- moment(created_at).fromNow() %></time>\n        </a>\n        <div class="comment-actions"></div>\n      </div>\n    </div>\n  </section>\n</article>\n<ol class="comment-replies"></ol>'),i.prototype.removedCommentTemplate=_.template('<article id="comment_<%- id %>">\n  <p><%- i18n.t(\'comment.label.comment_removed_by_moderator\') %></p>\n</article>\n<ol class="comment-replies"></ol>'),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.renderNext=t.renderNext||function(){return{}},this.permissions=t.permissions,this.userRecommendedCommentIds=t.userRecommendedCommentIds,t.comment&&(this.model=new TC.Comment(t.comment)),this._initCommentRecommendsView(),this.render(),this.commentActionsEl=this.$el.find(".comment-actions"),this.permissions.validate("_renderCommentRecommendsView")&&this._renderCommentRecommendsView(),this.permissions.validate("_renderReplyButton")&&this._renderReplyButton(),this.permissions.validate("_renderReportButton")&&this._renderReportButton(),this.permissions.validate("_renderModeratorControls")&&this._renderModeratorControls(),this.permissions.validate("_renderEditorControls")&&this._renderEditorControls(),t.renderChildren?this._renderReplies(this.model.get("children")):this.renderNext(),this.model.on("comment:deleted",function(t){return function(e){return $.flash("notice",e),t.$el.children(".comment").removeClass("pending").addClass("removed")}}(this)),this.model.on("comment:deleted:failure",function(t){return $.flash("alert","Could not remove the comment, try again")}),this.model.on("comment:restored",function(t){return function(e){return $.flash("notice",e),t.$el.children(".comment").removeClass("removed pending")}}(this)),this.model.on("comment:restored:failure",function(t){return $.flash("alert","Could not restore the comment, try again")}),this.model.on("comment:removed",function(t){return function(e){return $.flash("notice",e),t.$el.children(".comment").addClass("removed pending")}}(this)),this.model.on("comment:removed:failure",function(t){return $.flash("alert",t)})},i.prototype.render=function(){return this.model.get("hidden")?this.el.innerHTML=this.removedCommentTemplate(this.model.attributes):(this.el.innerHTML=this.template(this.model.attributes),this._renderCommentBodyView()),this.model.get("removed_at")&&this.$el.children(".comment").addClass("removed"),this.model.get("removal_reason")?this.$el.children(".comment").addClass("pending"):void 0},i.prototype.renderFirstChildForTeaser=function(){var t;return t=this.model.get("children"),0===t.length?!1:this._renderReplies([t[0]])},i.prototype._renderCommentBodyView=function(){return this.commentBodyContainer=this.$el.find(".full-comment"),this.commentBodyView=new TC.CommentBodyView({fullBody:this.model.get("full_body")}),this.commentBodyView.prependedTo(this.commentBodyContainer)},i.prototype._renderCommentRecommendsView=function(){return this.model.get("hidden")?void 0:this.commentRecommendsView.prependedTo(this.$el)},i.prototype._renderReportButton=function(){var t;return t=this.model.url()+"/abuses/new",this.commentActionsEl.append($('<a class="moderation-control report" title="'+i18n.t("comment.button.report_comment")+'" href="'+t+'">'+i18n.t("comment.button.report")+"</a>"))},i.prototype._renderReplyButton=function(){return this.replyButton=new TC.ButtonView({label:i18n.t("comment.button.reply"),className:"button subtle comment-reply"}),this.replyButton.on("click",this._handleReply),this.replyButton.appendedTo(this.$el.find(".more"))},i.prototype._renderModeratorControls=function(){return this.commentModeratorControlsView=new TC.CommentModeratorControlsView({comment:this.model}),this.commentModeratorControlsView.appendedTo(this.commentActionsEl),this.commentModeratorControlsView.on("comment:remove",this.model.remove)},i.prototype._renderEditorControls=function(){return this.commentEditorControlsView=new TC.CommentEditorControlsView({comment_user_id:this.model.get("user_id"),comment_user_email:this.model.get("user_email")}),this.commentEditorControlsView.appendedTo(this.commentActionsEl),this.commentEditorControlsView.on("comment:delete",this.model["delete"]),this.commentEditorControlsView.on("comment:restore",this.model.restore)},i.prototype._initCommentRecommendsView=function(){return this.commentRecommendsView=new TC.CommentRecommendsView({recommended:this._isRecommended(),highlyRecommended:this.model.get("highly_recommended")}),this.commentRecommendsView.on("comment:recommend",this.model.recommend),this.commentRecommendsView.on("comment:unrecommend",this.model.unrecommend)},i.prototype._isRecommended=function(){return-1!==_(this.userRecommendedCommentIds).indexOf(this.model.get("id"))},i.prototype._renderReplies=function(t){return this._recursiveRenderReplies(t)},i.prototype._recursiveRenderReplies=function(t){var e,n;return t.length?(e=t.shift(),n=function(e){return function(){return _.defer(e._recursiveRenderReplies,t)}}(this),new TC.CommentView({comment:e,userRecommendedCommentIds:this.userRecommendedCommentIds,permissions:this.permissions,renderNext:n}).appendedTo(this.$el.children(".comment-replies"))):_.defer(this.renderNext)},i.prototype._handleReply=function(t){return publish("comment:new",[this.model.get("id")])},i.prototype._donationUrl=function(){var t,e;return t=this.model.get("donation_url"),TC.currentUser.exists()?(e=TC.currentUser.get("id"),""+t+"&user_id="+e):t},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.CommentsListView=function(e){function i(){return this._commentsFragmentReady=t(this._commentsFragmentReady,this),this._renderCommentsFragment=t(this._renderCommentsFragment,this),this.recursiveRender=t(this.recursiveRender,this),this.renderTeaser=t(this.renderTeaser,this),this.renderComments=t(this.renderComments,this),this.renderAllComments=t(this.renderAllComments,this),this.renderNoComments=t(this.renderNoComments,this),this.createNewComment=t(this.createNewComment,this),this.addComment=t(this.addComment,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.className="comments-list-view",i.prototype.tagName="ol",i.prototype.noCommentsTemplate=_.template("<li class=\"information prominent no-comments\">\n  <strong><%= i18n.t('comment.label.no_comments_yet') %></strong>\n  <br />\n  <%= i18n.t('comment.label.have_your_say') %>\n</li>"),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.contentSubscription=t.contentSubscription,this.permissions=t.permissions,this.order="#oldest",this.spinner=new TC.SpinnerView({tagName:"li",centered:!0}),this.el.appendChild(this.spinner.el)},i.prototype.addComment=function(t){var e,n,i;return this.model.set("comment_count",this.model.get("comment_count")+1),publish("comments:count:updated",[this.model.get("comment_count")]),i=t.get("parent_id"),e=new TC.CommentView({model:t,permissions:this.permissions}),n=this._getContainerFor(i),e.prependedTo(n),echo.render()},i.prototype.createNewComment=function(t,e){var n,i,r;return r=this._getContainerFor(e),i=new TC.Comment({content_id:t,parent_id:e}),n=new TC.CommentFormView({model:i,contentSubscription:this.contentSubscription
}),this._addReplyForm(n,r)},i.prototype.renderNoComments=function(){return this.$el.html(this.noCommentsTemplate()),subscribe("comment:new",function(t){return function(){return t.$el.find(".information.no-comments").remove()}}(this))},i.prototype.renderAllComments=function(t){return this.commentsFragmentReady?(this._renderCommentsFragment(this.commentsFragment),echo.render(),"function"==typeof t?t():void 0):subscribe("comments:fragment:loaded",function(e){return function(n){return e._renderCommentsFragment(n),"function"==typeof t?t():void 0}}(this))},i.prototype.renderComments=function(t,e,n){var i,r;return this.userRecommendedCommentIds=e,r=t.get("comments"),i=t.get("comment_count"),publish("comments:count:updated",[i]),this.commentsFragment=document.createDocumentFragment(),this.commentsFragmentReady=!1,n?subscribe("comments:fragment:loaded",this._renderCommentsFragment):(subscribe("comments:teaser:fragment:loaded",this._renderCommentsFragment),subscribe("comments:fragment:loaded",this._commentsFragmentReady),this.renderTeaser(t.get("comments"))),this.recursiveRender(t.get("comments"))},i.prototype.renderTeaser=function(t){var e,n;return t=_(t).first(2),n=document.createDocumentFragment(),t.length>=1&&(e=new TC.CommentView({comment:t[0],userRecommendedCommentIds:this.userRecommendedCommentIds,permissions:this.permissions,renderChildren:!1}).appendedTo(n),!e.renderFirstChildForTeaser()&&t.length>=2&&(e=new TC.CommentView({comment:t[1],userRecommendedCommentIds:this.userRecommendedCommentIds,permissions:this.permissions,renderChildren:!1}).appendedTo(n))),publish("comments:teaser:fragment:loaded",[n])},i.prototype.recursiveRender=function(t){var e,n;return t.length?(e=t.shift(),n=function(e){return function(){return _.defer(e.recursiveRender,t)}}(this),new TC.CommentView({comment:e,userRecommendedCommentIds:this.userRecommendedCommentIds,permissions:this.permissions,renderChildren:!0,renderNext:n}).appendedTo(this.commentsFragment)):publish("comments:fragment:loaded",[this.commentsFragment])},i.prototype.sortComments=function(t){return this.order!==t?(this._changeSortOrder(),this.order=t):void 0},i.prototype._changeSortOrder=function(){return this.$el.animate({opacity:.25},100,function(t){return function(){return t.$el.children("li").each(function(){return $(this).prependTo($(this).parent())}),t.$el.css({opacity:1})}}(this))},i.prototype._renderCommentsFragment=function(t){return this.spinner.hide(function(e){return function(){var n;return n=$(window).scrollTop(),e.$el.find(".comment-view").remove(),e.$el.prepend(t),$(window).scrollTop(n),publish("comments:fragment:ready")}}(this))},i.prototype._commentsFragmentReady=function(){return this.commentsFragmentReady=!0},i.prototype._addReplyForm=function(t,e){var n;return n=e||this.$el,t.prependedTo(n)},i.prototype._getContainerFor=function(t){return $("#comment_"+t).siblings(".comment-replies").get(0)||this.$el},i}(Backbone.View)}.call(this),this.JSON||(JSON=function(){function f(t){return 10>t?"0"+t:t}function stringify(t,e){var n,i,r,o,s,a=/["\\\x00-\x1f\x7f-\x9f]/g;switch(typeof t){case"string":return a.test(t)?'"'+t.replace(a,function(t){var e=m[t];return e?e:(e=t.charCodeAt(),"\\u00"+Math.floor(e/16).toString(16)+(e%16).toString(16))})+'"':'"'+t+'"';case"number":return isFinite(t)?String(t):"null";case"boolean":case"null":return String(t);case"object":if(!t)return"null";if("function"==typeof t.toJSON)return stringify(t.toJSON());if(n=[],"number"==typeof t.length&&!t.propertyIsEnumerable("length")){for(o=t.length,i=0;o>i;i+=1)n.push(stringify(t[i],e)||"null");return"["+n.join(",")+"]"}if(e)for(o=e.length,i=0;o>i;i+=1)r=e[i],"string"==typeof r&&(s=stringify(t[r],e),s&&n.push(stringify(r)+":"+s));else for(r in t)"string"==typeof r&&(s=stringify(t[r],e),s&&n.push(stringify(r)+":"+s));return"{"+n.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"};var m={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:stringify,parse:function(text,filter){function walk(t,e){var n,i;if(e&&"object"==typeof e)for(n in e)Object.prototype.hasOwnProperty.apply(e,[n])&&(i=walk(n,e[n]),void 0!==i&&(e[n]=i));return filter(t,e)}var j;if(/^[\],:{}\s]*$/.test(text.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof filter?walk("",j):j;throw new SyntaxError("parseJSON")}}}()),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.CommentFormattingHelpView=function(e){function i(){return this._onTabClick=t(this._onTabClick,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.tagName="form",i.prototype.className="comment-formatting-help-view large-tooltip arrow-right",i.prototype.events={"click .tabbed .tab":"_onTabClick"},i.prototype.template=_.template("<h4><%= i18n.t('comment.label.formatting_help') %></h4>\n<p>\n  <%= i18n.t('comment.label.allowed_formatting_options') %><br>\n  <%= i18n.t('comment.label.markdown', { \n      markdown: '<a href=\"http://daringfireball.net/projects/markdown/syntax\" target=\"_blank\">Markdown</a>'\n    }) \n  %>.\n</p>\n\n<nav class=\"tabbed tabbed-condensed\">\n  <a href=\"#basic\" class=\"active tab\"><%= i18n.t('comment.label.formatting_basic') %></a>\n  <a href=\"#lists\" class=\"tab\"><%= i18n.t('comment.label.formatting_lists') %></a>\n</nav>\n\n<div id=\"comment-format-basic\">\n  <dl>\n    <dt><strong><%= i18n.t('comment.label.formatting_basic_bold') %></strong></dt>\n    <dd><code>**<%= i18n.t('comment.label.formatting_basic_text') %>**</code></dd>\n    <dt><em><%= i18n.t('comment.label.formatting_basic_italic') %></em></dt>\n    <dd><code>*<%= i18n.t('comment.label.formatting_basic_text') %>*</code></dd>\n    <dt><%= i18n.t('comment.label.formatting_basic_quote') %></dt>\n    <dd><code>&gt; <%= i18n.t('comment.label.formatting_basic_text') %></code></dd>\n    <dt><%= i18n.t('comment.label.formatting_basic_link') %></dt>\n    <dd><code>[<%= i18n.t('comment.label.formatting_basic_text') %>](http://website.com)</code></dd>\n  </dl>\n</div>\n\n<div id=\"comment-format-lists\">\n  <dl>\n    <dt>\n      <ul>\n        <li><%= i18n.t('comment.label.formatting_lists_item') %></li>\n        <li><%= i18n.t('comment.label.formatting_lists_item') %></li>\n      </ul>\n    </dt>\n    <dd>\n      <code>* <%= i18n.t('comment.label.formatting_lists_item') %><br>* <%= i18n.t('comment.label.formatting_lists_item') %></code>\n    </dd>\n    <dt>\n      <ol>\n        <li><%= i18n.t('comment.label.formatting_lists_numbered_item') %></li>\n        <li><%= i18n.t('comment.label.formatting_lists_numbered_item') %></li>\n      </ol>\n    </dt>\n    <dd>\n      <code>1. <%= i18n.t('comment.label.formatting_lists_numbered_item') %><br>2. <%= i18n.t('comment.label.formatting_lists_numbered_item') %></code>\n    </dd>\n  </dl>\n</div>"),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.render()},i.prototype.render=function(){return this.$el.html(this.template()),this.hide()},i.prototype._onTabClick=function(t){return t.preventDefault(),$(t.target).is(".active")?void 0:(this.$(".tab").removeClass("active"),$(t.target).addClass("active"),$("#comment-format-basic").toggle(),$("#comment-format-lists").toggle())},i}(TC.LargeTooltipView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.CommentPreviewView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="li",n.prototype.className="comment-view",n.prototype.template=_.template('<article class="comment preview">\n  <header class="meta">\n    <div class="preview-message"><%= i18n.t(\'comment.messages.preview_comment\') %></div>\n    <section class="attribution author-avatar">\n      <img class="comment avatar" height="36" width="36" src="<%- user_avatar_url %>" alt="">\n      <h3 class="fn">\n        <% if (user_profile_url) { %>\n          <a href="<%- user_profile_url %>"><%- user_full_name %></a>\n        <% } else { %>\n          <%- user_full_name %>\n        <% } %>\n        <% if (user_friend_of_tc) { %>\n          <a href="<%- this._donationUrl() %>" class="friend-of-the-conversation-badge">\n            <span>\n              <i class="icon-friend-of-tc-outer"></i>\n              <i class="icon-friend-of-tc-heart"></i>\n              <div class="hover tooltip bottom">\n                <%-i18n.t(\'comment.label.friend_of_the_conversation\', { name: user_full_name}) %>\n              </div>\n            </span>\n          </a>\n        <% } %>\n      </h3>\n      <p>\n        <% if (institution_name && institution_path) { %>\n          <% if (user_occupation) { %>\n            <%- user_occupation %>,\n          <% } %>\n\n          <a href="<%- institution_path %>"><%- institution_name %></a>\n        <% } else { %>\n          <%- user_occupation %>\n        <% } %>\n      </p>\n    </section>\n  </header>\n  <section class="comment-body">\n    <div class="full-comment"><%= full_body %></div>\n  </section>\n</article>'),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),t.comment&&(this.model=new TC.Comment(t.comment)),this.render()},n.prototype.render=function(){return this.el.innerHTML=this.template(this.model.attributes)},n.prototype._donationUrl=function(){var t,e;return t=this.model.get("donation_url"),TC.currentUser.exists()?(e=TC.currentUser.get("id"),""+t+"&user_id="+e):t},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.UserNotificationSettingsView=function(e){function i(){return this._updateCheckbox=t(this._updateCheckbox,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.tagName="form",i.prototype.className="user-notification-settings-view large-tooltip arrow-right",i.prototype.template=_.template('<h4>\n  <%= i18n.t(\'comment.label.notification_settings\') %>\n</h4>\n<fieldset>\n  <input type="checkbox" id="notify_when_new_comments" name="notify_when_new_comments">\n  <label for="notify_when_new_comments">\n    <%= i18n.t(\'comment.label.notify_me_when_there_are_updates\') %>\n  </label>\n</fieldset>'),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.contentSubscription=t.contentSubscription,this.$el.html(this.template()),this.checkbox=this.$el.find("#notify_when_new_comments"),this.checkbox.on("click",function(t){return function(){return t.contentSubscription.toggle(),t._trackAnalytics(t.contentSubscription.get("subscription_type"))}}(this)),this.contentSubscription.on("change",this._updateCheckbox),this._updateCheckbox(),this.hide()},i.prototype._updateCheckbox=function(){return this.checkbox.prop("checked",this.contentSubscription.isSubscribed())},i.prototype._trackAnalytics=function(t){return TC.analytics.track("ContentSubscription",t,"UserNotificationSettingsView")},i}(TC.LargeTooltipView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.CommentFormView=function(e){function i(){return this._onTextareaBlur=t(this._onTextareaBlur,this),this._onTextareaFocus=t(this._onTextareaFocus,this),this._loadPreview=t(this._loadPreview,this),this._onTabClick=t(this._onTabClick,this),this._handleSubmissionComplete=t(this._handleSubmissionComplete,this),this._handleSubmissionError=t(this._handleSubmissionError,this),this._handleSubmissionSuccess=t(this._handleSubmissionSuccess,this),this.remove=t(this.remove,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.tagName="li",i.prototype.events={"focus textarea":"_onTextareaFocus","blur textarea":"_onTextareaBlur","keyup textarea":"_handleKeyUp","input textarea":"_handleKeyUp","paste textarea":"_handleKeyUp","click .submit":"_handleSubmit","click .toggle-comment-help":"_handleClickToggleCommentHelp","click .toggle-comment-options":"_handleClickToggleCommentOptions","click #comment-form-reply > .tabbed .tab":"_onTabClick"},i.prototype.template=_.template('<div id="comment-form-reply">\n  <div class="comment-errors"></div>\n\n  <nav class="tabbed">\n    <a href="#write" class="active tab"><%= i18n.t(\'comment.button.write\') %></a>\n    <a href="#preview" class="tab"><%= i18n.t(\'comment.button.preview\') %></a>\n  </nav>\n\n  <div class="comment-form-reply-options">\n    <a href="#" class="toggle-comment-options" title="<%= i18n.t(\'comment.label.notification_settings\') %>">\n      <i class="icon-cog"></i>\n    </a>\n\n    <a href="#" class="toggle-comment-help" title="<%= i18n.t(\'comment.label.formatting_help\') %>">\n      <i class="icon-help"></i>\n    </a>\n  </div>\n\n  <div class="comment-form-reply-write">\n    <form id="new_comment" class="new_comment">\n      <label for="comment-form-reply-body"><%= i18n.t(\'comment.label.body\') %></label>\n      <textarea id="comment-form-reply-body" class="comment-body"></textarea>\n\n      <span class="community-standards-link">\n        <a href="/community_standards" target="_blank">\n          <%= i18n.t(\'comment.label.review_community_standards\') %>\n        </a>\n      </span>\n\n      <a href="#" class="submit button primary"><%= i18n.t(\'comment.button.post_comment\') %></a>\n    </form>\n  </div>\n\n  <div class="comment-form-reply-preview"></div>\n</div>'),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.user_full_name=TC.currentUser.get("full_name"),this.render(),this.commentBodyEl=this.$el.find("textarea.comment-body"),this.submitButtonEl=this.$el.find(".button.primary"),this.errorEl=this.$el.find(".comment-errors"),this.contentSubscription=t.contentSubscription,subscribe("comment:new",this.remove),this.userNoticationSettingsView=new TC.UserNotificationSettingsView({contentSubscription:this.contentSubscription}),this.commentFormattingHelpView=new TC.CommentFormattingHelpView,this.$el.find(".toggle-comment-help").after(this.commentFormattingHelpView.el),this.$el.find(".toggle-comment-options").after(this.userNoticationSettingsView.el),_.defer(function(t){return function(){return t.commentBodyEl.focus()}}(this))},i.prototype.render=function(){return $(this.el).html(this.template({user_full_name:this.user_full_name}))},i.prototype.remove=function(){return unsubscribe("comment:new",this.remove),i.__super__.remove.call(this)},i.prototype._displayErrorMessage=function(t){return this.errorEl.html($('<p class="information error">').html(t))},i.prototype._disableSubmitButton=function(){return this.submitButtonEl.attr("disabled","disabled")},i.prototype._enableSubmitButton=function(){return this.submitButtonEl.removeAttr("disabled")},i.prototype._handleClickToggleCommentOptions=function(t){return t.preventDefault(),this.commentFormattingHelpView.hide(),this.userNoticationSettingsView.toggle()},i.prototype._handleClickToggleCommentHelp=function(t){return t.preventDefault(),this.userNoticationSettingsView.hide(),this.commentFormattingHelpView.toggle()},i.prototype._handleKeyUp=function(t){return $(t.currentTarget).val().length>10?(this.errorEl.empty(),this._enableSubmitButton()):void 0},i.prototype._handleSubmit=function(t){return t.preventDefault(),this.submitButtonEl.html(i18n.t("comment.messages.posting")),this._disableSubmitButton(),this.model.save({body:this.commentBodyEl.val()},{wait:!0,success:this._handleSubmissionSuccess,error:this._handleSubmissionError,complete:this._handleSubmissionComplete})},i.prototype._handleSubmissionSuccess=function(){return TC.analytics.track("Comment Created",window.location.pathname,""),publish("comment:created",[this.model]),this.remove()},i.prototype._handleSubmissionError=function(t,e){return 422===e.status?(this._displayErrorMessage(e.responseJSON.detailed_error_message),$.flash("alert",e.responseJSON.message)):(this._displayErrorMessage(i18n.t("comment.messages.error")),this._enableSubmitButton())},i.prototype._handleSubmissionComplete=function(){return this.submitButtonEl.html(i18n.t("comment.button.post_comment"))},i.prototype._onTabClick=function(t){var e,n;return t.preventDefault(),$(t.target).is(".active")?void 0:(n=t.target.href.split("#").pop(),e=$(t.target),"write"===n?(this.$el.find(".tab").removeClass("active"),e.addClass("active"),e.parent().removeClass("preview"),this.$(".comment-form-reply-preview").hide(),this.$(".comment-form-reply-write").show(),this.$(".comment-form-reply-write textarea").focus()):0===this.$("textarea").val().length?(alert("Please type in a comment."),this.$(".comment-form-reply-write textarea").focus()):(this._loadPreview(),this.$el.find(".tab").removeClass("active textarea-focus textarea-blur"),e.addClass("active"),e.parent().addClass("preview"),this.$(".comment-form-reply-write").hide(),this.$(".comment-form-reply-preview").show()))},i.prototype._loadPreview=function(){var t;return t=this.$(".comment-form-reply-preview"),this.currentBodyText&&this.currentBodyText===this.$("textarea").val()?void 0:(this.currentBodyText=this.$("textarea").val(),t.html("<p class='loading'>"+i18n.t("comment.messages.preview_loading")+"</p>"),$.ajax({url:"/comments/preview",type:"POST",dataType:"json",data:{comment:{content_id:this.model.get("content_id"),body:this.currentBodyText}},success:function(e){return function(e){return setTimeout(function(){var n;return t.html(""),n=new TC.CommentPreviewView({comment:e}),n.appendedTo(t)},500)}}(this),error:function(e){return function(){return t.html("<p class='loading'>"+i18n.t("comment.messages.preview_error")+"</p>")}}(this)}))},i.prototype._onTextareaFocus=function(){return this.$el.find('.tab[href="#write"]').removeClass("textarea-blur").addClass("textarea-focus")},i.prototype._onTextareaBlur=function(){return this.$el.find('.tab[href="#write"]').removeClass("textarea-focus").addClass("textarea-blur")},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ContentSubscription=function(e){function i(){return this._handleError=t(this._handleError,this),this.isSubscribed=t(this.isSubscribed,this),this.suppress=t(this.suppress,this),this.subscribe=t(this.subscribe,this),this.softSubscribe=t(this.softSubscribe,this),this.toggle=t(this.toggle,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.url=function(){return"/content/"+this.content_id+"/content_subscription"},i.prototype.initialize=function(t){return this.content_id=t.content_id},i.prototype.toggle=function(){switch(this.get("subscription_type")){case"subscribed":return this.suppress();case"suppressed":return this.subscribe();case"undetermined":return this.subscribe()}},i.prototype.softSubscribe=function(){return"undetermined"===this.get("subscription_type")?this.subscribe():void 0},i.prototype.subscribe=function(){return this.save({subscription_type:"subscribed"},{type:"PUT",error:this._handleError})},i.prototype.suppress=function(){return this.save({subscription_type:"suppressed"},{type:"PUT",error:this._handleError})},i.prototype.isSubscribed=function(){return"subscribed"===this.get("subscription_type")},i.prototype._handleError=function(){return this.set("subscription_type",this.previous("subscription_type"))},i}(Backbone.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.IndicatorButtonView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.GREEN="green",n.ORANGE="orange",n.RED="red",n.GREY="grey",n.prototype.className="button indicator",n.prototype.colors=[n.GREEN,n.ORANGE,n.RED,n.GREY],n.prototype.setColor=function(t){if(this.$el.removeClass(this.colors.join(" ")),null!=t){if(!_(this.colors).include(t))throw new Error("unknown color '"+t+"'");return this.$el.addClass(t)}},n}(TC.ButtonView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ContentSubscriptionIndicatorView=function(e){function i(){return this._getNoticeForType=t(this._getNoticeForType,this),this._getLabelForType=t(this._getLabelForType,this),this._getColorForType=t(this._getColorForType,this),this._setSubscriptionType=t(this._setSubscriptionType,this),this._flashError=t(this._flashError,this),this._flashSuccess=t(this._flashSuccess,this),this._updateView=t(this._updateView,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.contentId=t.contentId,this.contentSubscription=t.contentSubscription,this._setSubscriptionType("undetermined"),this.contentSubscription.on("change",this._updateView),this.contentSubscription.on("sync",this._flashSuccess),this.contentSubscription.on("error",this._flashError),this.contentSubscription.fetch(),this.on("click",function(t){return function(){return t.contentSubscription.toggle(),t._track(t.contentSubscription.get("subscription_type"))}}(this))},i.prototype._updateView=function(){return this._setSubscriptionType(this.contentSubscription.get("subscription_type"))},i.prototype._flashSuccess=function(){var t;return null!=this.contentSubscription.previous("subscription_type")&&(t=this.contentSubscription.get("subscription_type"),null!=this._getNoticeForType(t))?$.flash("notice",this._getNoticeForType(t)):void 0},i.prototype._flashError=function(){return $.flash("notice",this._getNoticeForType("error"))},i.prototype._setSubscriptionType=function(t){return this.setTitle(this._getLabelForType(t)),this.setColor(this._getColorForType(t))},i.prototype._getColorForType=function(t){switch(t){case"subscribed":return TC.IndicatorButtonView.GREEN;case"suppressed":return TC.IndicatorButtonView.RED;case"undetermined":return TC.IndicatorButtonView.RED;default:return void 0}},i.prototype._getLabelForType=function(t){switch(t){case"subscribed":return i18n.t("content.subscription_type.subscribed.label");case"suppressed":return i18n.t("content.subscription_type.suppressed.label");case"undetermined":return i18n.t("content.subscription_type.undetermined.label");default:return void 0}},i.prototype._getNoticeForType=function(t){switch(t){case"subscribed":return i18n.t("content.subscription_type.subscribed.notice");case"suppressed":return i18n.t("content.subscription_type.suppressed.notice");case"error":return i18n.t("content.subscription_type.error.notice");default:return void 0}},i.prototype._track=function(t){return TC.analytics.track("ContentSubscription",t,"ContentSubscriptionIndicatorView")},i}(TC.IndicatorButtonView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.CommentsActionsView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="comments-actions-view grid-four grid-last",n.prototype.tagName="div",n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.permissions=t.permissions,this.contentId=t.contentId,this.contentSubscription=t.contentSubscription,this.permissions.validate("_renderSignInToCommentButtonView")&&this._renderSignInToCommentButtonView(),this.permissions.validate("_renderNewCommentButtonView")&&this._renderNewCommentButtonView(),this.permissions.validate("_renderCloseCommentsButtonView")&&this._renderCloseCommentsButtonView(),this.permissions.validate("_renderOpenCommentsButtonView")&&this._renderOpenCommentsButtonView(),this.permissions.validate("_renderContentSubscriptionIndicatorView")?this._renderContentSubscriptionIndicatorView():void 0},n.prototype._renderSignInToCommentButtonView=function(){return this.signInToCommentButtonView=new TC.ButtonView({label:i18n.t("comment.button.sign_in_to_comment"),className:"comment-sign-in button primary moderately-huge subtle"}),this.signInToCommentButtonView.appendedTo(this.$el),this.signInToCommentButtonView.on("click",function(){return window.location="sign_in?return_to="+window.location.pathname+"#comments"})},n.prototype._renderNewCommentButtonView=function(){return this.newCommentButtonView=new TC.ButtonView({label:i18n.t("comment.button.comment_on_this_article"),className:"button moderately-huge primary new"}),this.newCommentButtonView.appendedTo(this.$el),this.newCommentButtonView.on("click",function(){return publish("comment:new")})},n.prototype._renderCloseCommentsButtonView=function(){return this.closeCommentsButtonView=new TC.ButtonView({label:i18n.t("comment.button.close_comments"),className:"button moderately-huge primary danger close"}),this.closeCommentsButtonView.appendedTo(this.$el),this.closeCommentsButtonView.on("click",function(){return confirm(i18n.t("comment.messages.close_comments"))?publish("comments:close"):void 0})},n.prototype._renderOpenCommentsButtonView=function(){return this.openCommentsButtonView=new TC.ButtonView({label:i18n.t("comment.button.re_open_comments"),className:"button moderately-huge primary open"}),this.openCommentsButtonView.appendedTo(this.$el),this.openCommentsButtonView.on("click",function(){return confirm(i18n.t("comment.messages.re_open_comments"))?publish("comments:open"):void 0})},n.prototype._renderContentSubscriptionIndicatorView=function(){return this.contentSubscriptionIndicatorView=new TC.ContentSubscriptionIndicatorView({contentId:this.contentId,contentSubscription:this.contentSubscription,className:"button moderately-huge indicator"}),this.contentSubscriptionIndicatorView.appendedTo(this.$el)},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.CommentsSectionView=function(e){function i(){return this._renderShowMoreButton=t(this._renderShowMoreButton,this),this._renderSortButtons=t(this._renderSortButtons,this),this._commentsClosed=t(this._commentsClosed,this),this._commentsOpened=t(this._commentsOpened,this),this._newComment=t(this._newComment,this),this._transitionToReady=t(this._transitionToReady,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.id="comments",i.prototype.className="comments-section-view wrapper clearfix",i.prototype.tagName="section",i.prototype.events={"click a.comment-sort":"sortComments","click .comment-moderator-remove":"showModeratorPane","click .moderation-pane-close":"hideModerationPane","submit .moderation-remove":"handleModerationRemoveSubmit"},i.prototype.sortButtonsTemplate=_.template('<div class="tabbed-button-group minimal">\n  <a class=" button comment-sort on" href="#oldest">\n    <%= i18n.t(\'comment.button.oldest\') %>\n  </a>\n\n  <a class=" button comment-sort" href="#newest">\n    <%= i18n.t(\'comment.button.newest\') %>\n  </a>\n</div>'),i.prototype.showAllCommentsButtonTemplate=_.template('<div class="comments-show-all">\n  <a href="#" class="primary button moderately-huge">\n    <%= i18n.t(\'comment.button.show_all_comments\') %>\n  </a>\n</div>'),i.prototype.template=_.template('<div class="comments-bar grid-sixteen">\n  <div class="comments-count-sort grid-four">\n    <i class="icon-comment"></i>\n    <span class="comment-count"><span></span></span>\n  </div>\n  <div class="comments-main grid-eight">\n    <div class="comment-sorting"></div>\n    <p class="information prominent closed"><%= i18n.t(\'comment.label.comments_closed\') %></p>\n  </div>\n  <div class="comments-side grid-four grid-last"></div>\n</div>'),i.prototype.initialize=function(t){var e,n;return i.__super__.initialize.call(this,t),e=$(location).attr("hash"),/comment_[0-9]+/.test(e)&&(this.referenceToComment=e),this.referenceToComment&&_.defer(function(){return $("html, body").animate({scrollTop:$("#comments").offset().top},500)}),this.permissions=function(){var t,e,n;switch(!1){case!(null!=(t=TC.currentUser)?t.isEditor():void 0):return new TC.CommentsEditorPermissions;case!(null!=(e=TC.currentUser)?e.isModerator():void 0):return new TC.CommentsModeratorPermissions;case!(null!=(n=TC.currentUser)?n.exists():void 0):return new TC.CommentsSignedInPermissions;default:return new TC.CommentsUnauthedPermissions}}(),this.contentId=t.content_id,this.comments=new TC.Comments({content_id:this.contentId}),this.contentSubscription=new TC.ContentSubscription({content_id:this.contentId}),this.commentsActionsView=new TC.CommentsActionsView({contentId:this.contentId,permissions:this.permissions,contentSubscription:this.contentSubscription}),this.commentsListView=new TC.CommentsListView({model:this.comments,permissions:this.permissions,contentSubscription:this.contentSubscription}),subscribe("comment:new",this._newComment),subscribe("comment:created",this.commentsListView.addComment),subscribe("comments:fragment:ready",this._transitionToReady),subscribe("comments:closed",this._commentsClosed),subscribe("comments:opened",this._commentsOpened),(null!=(n=TC.currentUser)?n.exists():void 0)?(this.commentsRecommends=new TC.CommentsRecommends({content_id:this.contentId}),this.commentsRecommends.on("sync",function(t){return function(){return t.comments.fetch()}}(this)),this.commentsRecommends.fetch()):this.comments.fetch(),this.displayAllComments=!1,this.comments.on("sync",function(t){return function(){return t.commentsListView.renderComments(t.comments,t._userRecommendedCommentIds(),t._displayAllComments())}}(this)),this.render(),this.$el.addClass("loading")},i.prototype.render=function(){return this.el.innerHTML=this.template(),this.commentsListView.appendedTo(this.$el.find(".comments-main"))},i.prototype.clickNewComment=function(t){return t.preventDefault(),this.addComment($("#comment-list > ol"))},i.prototype.sortComments=function(t){var e,n;return t.preventDefault(),e=$(t.currentTarget),n=e.attr("href"),this.$el.find(".comment-sort").removeClass("on"),e.addClass("on"),this.commentsListView.sortComments(n)},i.prototype._transitionToReady=function(){return this.$el.removeClass("loading"),this.comments.get("comment_count")?(this._renderSortButtons(),this._displayAllComments()||this._renderShowMoreButton()):this.commentsListView.renderNoComments(),this.commentsActionsView.appendedTo(this.$el.find(".comments-side")),this.referenceToComment&&$(this.referenceToComment).length>0?_.defer(function(t){return function(){return $("html, body").animate({scrollTop:$(t.referenceToComment).addClass("highlight").offset().top},0)}}(this)):void 0},i.prototype._newComment=function(t){return this.commentsListView.createNewComment(this.contentId,t)},i.prototype._userRecommendedCommentIds=function(){return this.commentsRecommends?_(this.commentsRecommends.models).map(function(t){return t.get("comment_id")}):void 0},i.prototype._commentsOpened=function(){return this.$el.removeClass("closed")},i.prototype._commentsClosed=function(){return this.$el.addClass("closed")},i.prototype._displayAllComments=function(){return this.displayAllComments||this.comments.get("has_current_user_comment")||this.referenceToComment||this.comments.get("comment_count")<3},i.prototype._renderSortButtons=function(){return this.$el.find(".comment-sorting").html(this.sortButtonsTemplate())},i.prototype._renderShowMoreButton=function(){var t;return t=$(this.showAllCommentsButtonTemplate()),this.$el.find(".comments-main").append(t),t.on("click",function(e){return function(n){return n.preventDefault(),t.addClass("disabled"),e.displayAllComments=!0,
e.commentsListView.renderAllComments(function(){return t.remove()})}}(this))},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.SocialButtonView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}var i;return e(n,t),n.prototype.initialize=function(t){var e;return e=$(t.el)[0],t.count&&0!==t.count?$('<span class="data-count" />').text(i(t.count)).insertAfter($(e)):void 0},i=function(t){return 1e3>t?t:Math.round(t/100)/10+"k"},n}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.RepublicationView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click .button.close":"_leave","click .tab.basic":"_showBasic","click .tab.advanced":"_showAdvanced","click input.image":"_showImageCode","click input.script":"_showScriptCode"},n.prototype.template=_.template('<%= republishContent %>\n\n<footer class="button-row">\n  <a class="button secondary close" href="#">Close</a>\n</footer>'),n.prototype.initialize=function(t){return n.__super__.initialize.call(this),this.republishContent=t.republishContent,this.copyAdvice=t.copyAdvice,this.render(),this.$el.find("section.advanced").hide(),this.$el.find("code.script").hide()},n.prototype.render=function(){return n.__super__.render.call(this),this.$innerEl.html(this.template({republishContent:this.republishContent})),this.$el.find(".copy-advice").html(this.copyAdvice)},n.prototype._showBasic=function(t){return this.$el.find(".tab.active").removeClass("active"),$(t.currentTarget).addClass("active"),this.$el.find("section.basic").show(),this.$el.find("section.advanced").hide()},n.prototype._showAdvanced=function(t){return this.$el.find(".tab.active").removeClass("active"),$(t.currentTarget).addClass("active"),this.$el.find("section.basic").hide(),this.$el.find("section.advanced").show()},n.prototype._showImageCode=function(){return this.$el.find("code.image").show(),this.$el.find("code.script").hide()},n.prototype._showScriptCode=function(){return this.$el.find("code.image").hide(),this.$el.find("code.script").show()},n}(TC.SuperLightboxView)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.TopbarMobileNewsletterSignup=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click .close":"_hideAndDontShowAgain","click .topbar-mobile-newsletter-signup-subscribe":"_subscribe"},n.prototype.initialize=function(t){return this.cookie="topbar-mobile-newsletter-signup-july-2015",$.cookie(this.cookie)?void 0:this.render()},n.prototype.template=_.template('<section class="topbar-mobile-newsletter-signup">\n  <a href="<%- newsletterUrl %>" class="topbar-mobile-newsletter-signup-subscribe">\n    <i class="icon-email"></i>\n    <span class="topbar-button-text"><%- i18n.t(\'topbar.mobile_newsletter_signup.button\') %></span>\n  </a>\n\n  <a href="#" class="close"><i class="icon-delete"></i></a>\n</section>'),n.prototype.render=function(){return this.$el.html(this.template({newsletterUrl:this._newsletterUrl()}))},n.prototype._subscribe=function(t){return t.preventDefault(),$.cookie(this.cookie,"true",{expires:6e3}),window.location=$(t.currentTarget).attr("href")},n.prototype._hideAndDontShowAgain=function(t){return t.preventDefault(),this.$el.remove(),$.cookie(this.cookie,"true",{expires:6e3})},n.prototype._newsletterUrl=function(){return"https://theconversation.com/newsletter"},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ContentPage=function(e){function i(){return this._toggleArticleSidebar=t(this._toggleArticleSidebar,this),this.openComments=t(this.openComments,this),this.closeComments=t(this.closeComments,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.events={"click .steal-button":"republish","click form.edit-user input[type=checkbox]":"checkNotificationSettings","click li.print a":"printArticle","click aside.content-share li a":"shareClickTracking","click aside.content-targeted-share li a":"shareClickTracking","click textarea.stolen-body":"selectStolenBody","click .content-authors .content-authors-toggle":"_toggleArticleSidebar"},i.prototype.initialize=function(t){var e;return i.__super__.initialize.call(this,t),navigator.platform.indexOf("iPhone")&&$("figure.zoomable").imagebox(),e=["iframe[src^='//www.youtube.com']","iframe[src^='//c15119308.ssl.cf2.rackcdn.com']","iframe[src^='https://c15119308.ssl.cf2.rackcdn.com']","iframe[src^='//maps.google.com.au/maps']","iframe[src^='//player.vimeo.com']"],$("body").fitVids({customSelector:e.join(", ")}),this.trackScrolling(),this.initResponsiveFrames(),this._initTopbarMobileNewsletterSignup(),subscribe("comments:count:updated",this.updateCommentCount),subscribe("comments:close",this.closeComments),subscribe("comments:open",this.openComments),this.commentsClosedAt=t.comments_closed_at,this.content_slug=t.content_slug,this.content_id=t.content_id,this.commentsSectionView=new TC.CommentsSectionView({content_id:this.content_id}).appendedTo($("#comments-container")),this.commentsClosedAt&&publish("comments:closed",[this.commentsClosedAt]),this.initShareButtons(),this.initPrintButton()},i.prototype.shareClickTracking=function(t){var e;return e=$(t.currentTarget).closest("li").attr("class"),TC.analytics.track("Article page - share clicks",document.location.pathname,e,1)},i.prototype.initShareButtons=function(){return $.ajax({url:"/share_counts/"+this.content_id,success:function(t){return function(e){return t.$(".twitter-button").each(function(t,n){return new TC.SocialButtonView({el:n,count:e.tweet_count})}),t.$(".facebook-button").each(function(t,n){return new TC.SocialButtonView({el:n,count:e.facebook_count})}),t.$(".linkedin-button").each(function(t,n){return new TC.SocialButtonView({el:n,count:e.linked_in_count})})}}(this)})},i.prototype.initPrintButton=function(){var t;return t="<li class='print'><a href='#'><i class='icon-print'></i> "+i18n.t("content.button.print")+"</a></li>",this.$el.find(".content-share ul").append(t),this.$el.find(".interact-with-this-article ul").append(t)},i.prototype.printArticle=function(t){return t.preventDefault(),TC.analytics.track("Article page - print button clicks",document.location.pathname,"",1),window.print()},i.prototype.trackScrolling=function(){var t,e,n,i,r,o,s,a;if(i=new Date,$("#article").length>0){for(e={},t=$("#article").height(),n=$("#article").offset().top,r=a=10;100>=a;r=a+=10)e[r]=t/100*r+n;return o=function(){var t,n,r,o,s;n=$(window).scrollTop()+$(window).height(),s=[];for(t in e)o=e[t],n>o?(TC.analytics.track("Article Page - percent scrolled",document.location.pathname,""+t+"%",1),""+t=="100"&&(r=(new Date-i)/1e3,TC.analytics.track("Article Page - article scrolled to bottom",document.location.pathname,"timeTaken",r)),s.push(delete e[t])):s.push(void 0);return s},s=_.debounce(o,50),$(window).scroll(s),o()}},i.prototype.initResponsiveFrames=function(){var t;return t=this.$el.find("iframe[responsive='true']"),_.each(t,function(t){return function(t,e){return $(t).hide(),$(t).before("<div id='responsive-iframe-"+e+"'></div>"),new pym.Parent("responsive-iframe-"+e,$(t).attr("src"),{})}}(this))},i.prototype.republish=function(t){var e;return t.preventDefault(),e=$(t.currentTarget),$.ajax({url:$(e).data("republish"),dataType:"text",success:function(t){return function(e){var n;return n=new TC.RepublicationView({republishContent:e,copyAdvice:t.copy_advice()}),n.appendedTo(document.body)}}(this)})},i.prototype.copy_advice=function(){var t,e,n;return e=!navigator.platform.indexOf("iPhone"),n=!navigator.platform.indexOf("Mac"),t=n?"\u2318":"Ctrl",e?i18n.t("content.message.copying_text_on_mobile_device"):i18n.t("content.message.key_combination_to_press_to_copy_text",{control_or_command_key:t})},i.prototype.selectStolenBody=function(t){return $(t.currentTarget).select()},i.prototype.closeComments=function(){var t;return t="/editorial/content/"+this.content_slug+"/close_comments",$.ajax({url:t,type:"PUT",success:function(t){return publish("comments:closed",[t.comments_closed_at])}})},i.prototype.openComments=function(){var t;return t="/editorial/content/"+this.content_slug+"/open_comments",$.ajax({url:t,type:"PUT",success:function(t){return publish("comments:opened",[t.comments_closed_at])}})},i.prototype.updateCommentCount=function(t){var e;return e=1!==t?i18n.t("comment.label.comment_plural"):i18n.t("comment.label.comment_singular"),$(".comment-count span").html("<span class='number-of-comments'>"+t+"</span> "+e)},i.prototype._toggleArticleSidebar=function(t){return t.preventDefault(),this.$el.find(".content-sidebar").toggleClass("open"),echo.render()},i.prototype._initTopbarMobileNewsletterSignup=function(){var t;return t=new TC.TopbarMobileNewsletterSignup,this.topbar.after(t.el)},i}(TC.BasePage)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ColumnPage=function(e){function i(){return this._toggleColumnSidebar=t(this._toggleColumnSidebar,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.events={"click .content-authors .content-authors-toggle":"_toggleColumnSidebar"},i.prototype.initialize=function(t){var e;return i.__super__.initialize.call(this,t),e=["iframe[src^='//www.youtube.com']","iframe[src^='//c15119308.ssl.cf2.rackcdn.com']","iframe[src^='https://c15119308.ssl.cf2.rackcdn.com']","iframe[src^='//maps.google.com.au/maps']","iframe[src^='//player.vimeo.com']"],$("body").fitVids({customSelector:e.join(", ")})},i.prototype._toggleColumnSidebar=function(t){return t.preventDefault(),this.$el.find(".content-sidebar").toggleClass("open"),echo.render()},i}(TC.BasePage)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ExpertDatabaseSearchFormView=function(e){function i(){return this._url=t(this._url,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.events={"submit .expert_search_form.for":"_performResearchAndExpertSearch"},i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.institutionSlug=t.institutionSlug},i.prototype._performResearchAndExpertSearch=function(t){var e;return t.preventDefault(),e=$("#expert_search_form_term").val(),""!==e?window.location.href=this._url(e):void 0},i.prototype._toSlug=function(t,e){return t.replace(/\s/g,e).toLowerCase()},i.prototype._url=function(t){return this.institutionSlug?"/experts/search/on/"+this._toSlug(t,"+")+"/from/"+this.institutionSlug:"/experts/search/on/"+this._toSlug(t,"+")},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.ExpertsPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return new TC.ExpertDatabaseSearchFormView({el:$("body")}),n.__super__.initialize.call(this,t)},n}(TC.BasePage)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};$.fn.autocomplete=function(e){var n,i,r,o;return null==e&&(e={}),r=function(){function e(e,n){this._delayedUpdate=t(this._delayedUpdate,this),this.renderCallback=n,this.setSource(e)}return e.prototype.setSource=function(t){return t instanceof Array?(this.update=this._arrayUpdate,this.sourceArray=t):t instanceof Function?(this.update=this._callbackUpdate,this.sourceCallback=t):(this.update=this._ajaxUpdate,this.sourceUrl=t)},e.prototype.cancelRequests=function(){var t;return clearTimeout(this.delayedUpdate),null!=(t=this.ajax)?t.abort():void 0},e.prototype._arrayUpdate=function(t){var e;return e=this._buildResults(t,this.sourceArray),this.renderCallback(e)},e.prototype._ajaxUpdate=function(t){return clearTimeout(this.delayedUpdate),this.delayedUpdate=setTimeout(function(e){return function(){return e._delayedUpdate(t)}}(this),300)},e.prototype._callbackUpdate=function(t){var e;return e=this._buildResults(t,this.sourceCallback()),this.renderCallback(e)},e.prototype._delayedUpdate=function(t){var e;return null!=(e=this.ajax)&&e.abort(),this.ajax=$.ajax({url:this.sourceUrl,data:{term:t},dataType:"json",success:this.renderCallback})},e.prototype._buildResults=function(t,e){return _.filter(e,function(e){var n;return n=e.label||e,-1!==n.toLowerCase().indexOf(t.toLowerCase())})},e}(),i=function(){function e(e,n,i,r){var o;null==r&&(r=!1),this._renderItem=t(this._renderItem,this),this.render=t(this.render,this),this.clear=t(this.clear,this),this.chooseSelectedItem=t(this.chooseSelectedItem,this),this.chooseItem=t(this.chooseItem,this),this.selectNextItem=t(this.selectNextItem,this),this.selectPreviousItem=t(this.selectPreviousItem,this),this.ul=document.createElement("ul"),this.ul.className="autocomplete",this.attachElement=e,this.renderInline=n,this.limit=i||20,this.autoSelect=r,this.renderInline?o=this.attachElement.parentNode:(o=document.body,this.ul.style.position="absolute"),o.appendChild(this.ul),this.clear()}return e.prototype.getSelectedIndex=function(){return this.selectedIndex},e.prototype.setSelectedIndex=function(t){return this.selectedIndex!==t?(this._clearSelection(),this.selectedIndex=t,this._updateSelection()):void 0},e.prototype.setSelectionCallback=function(t){return this.callback=t},e.prototype.selectPreviousItem=function(){return this._clearSelection(),this.validSelection()?this.selectedIndex>0&&this.selectedIndex--:this.selectedIndex=0,this._updateSelection()},e.prototype.selectNextItem=function(){return this._clearSelection(),this.validSelection()?this.selectedIndex<this.selectionLimit&&this.selectedIndex++:this.selectedIndex=0,this._updateSelection()},e.prototype.chooseItem=function(t,e){var n;return n={item:this.items[e]},"function"==typeof this.callback?this.callback(t,n):void 0},e.prototype.chooseSelectedItem=function(t){return this.chooseItem(t,this.selectedIndex),this.clear()},e.prototype.clear=function(){var t;for(this.selectedIndex=void 0;t=this.ul.firstChild;)this.ul.removeChild(t);return this.ul.style.display="none",this.opened=!1},e.prototype.render=function(t){return this.items=t.slice(0,this.limit),this.clear(),this.selectionLimit=this.items.length-1,_.each(this.items,this._renderItem),this._updateSelection(),this.renderInline||(this.position=this._getAttachmentPoint(this.attachElement),this.ul.style.top=this.position[0]+"px",this.ul.style.left=this.position[1]+"px"),this.ul.style.display="block",this.opened=!0,this.autoSelect?this.selectNextItem():void 0},e.prototype.isOpen=function(){return this.opened},e.prototype.validSelection=function(){return void 0!==this.selectedIndex},e.prototype._getAttachmentPoint=function(t){var e,n;if(e=n=0,t.offsetParent)for(n+=t.offsetHeight;;)if(n+=t.offsetTop,e+=t.offsetLeft,!(t=t.offsetParent))break;return[n,e]},e.prototype._renderItem=function(t,e){var n,i;return i=document.createElement("li"),i.className="autocomplete-item",n=t.label||t,$(i).html(n),this.ul.appendChild(i),$(i).on("mouseover",function(t){return function(){return t.setSelectedIndex(e)}}(this)),$(i).on("mouseup",function(t){return function(n){return t.chooseItem(n,e),t.clear()}}(this))},e.prototype._clearSelection=function(){var t;return null!=(t=this.ul.childNodes[this.selectedIndex])?t.className="autocomplete-item":void 0},e.prototype._updateSelection=function(){var t,e,n,i,r,o;if(i=this.ul.childNodes[this.selectedIndex])return n=$(this.ul).height(),t=$(i).outerHeight(),o=$(this.ul).scrollTop(),r=n+o,e=t*this.selectedIndex,o>=e&&$(this.ul).scrollTop(e),e>=r&&$(this.ul).scrollTop(e-(n-t)),i.className="autocomplete-item selected"},e}(),n=function(){function e(e,n){this._handleKeydown=t(this._handleKeydown,this),this._handleKeyup=t(this._handleKeyup,this),this._handleFocus=t(this._handleFocus,this),this.handleItemSelection=t(this.handleItemSelection,this),this.setSource=t(this.setSource,this),n.select&&(this.select=_.bind(n.select,e)),this.autoFocus=n.autoFocus,this.element=e,this.element.attr("autocomplete","off"),this.menu=new i(this.element.get(0),n.inline,n.limit,n.autoSelect),this.menu.setSelectionCallback(this.handleItemSelection),this.suggestions=new r(n.source,this.menu.render),this.element.on("keydown",this._handleKeydown),this.element.on("keyup",this._handleKeyup),this.element.on("focus",this._handleFocus),this.element.trigger("autocompletecreate")}return e.prototype.setSource=function(t){return this.suggestions.setSource(t)},e.prototype.handleItemSelection=function(t,e){return"function"==typeof this.select&&this.select(t,e),this.element.trigger("autocompleteselect",e),this.searchText=this.element.val()},e.prototype._handleFocus=function(t){return this.autoFocus?this.suggestions.update(""):void 0},e.prototype._handleKeyup=function(t){var e;return e=""+t.target.value,this.searchText!==e&&e.length>=2?(this.searchText=e,this.suggestions.update(e)):void 0},e.prototype._handleKeydown=function(t){switch(t.which){case 38:return t.preventDefault(),this.menu.selectPreviousItem();case 40:return t.preventDefault(),this.menu.selectNextItem();case 27:return t.preventDefault(),this.menu.clear();case 13:if(this.menu.validSelection()||(this.suggestions.cancelRequests(),this.menu.clear()),this.menu.isOpen()&&this.menu.validSelection())return t.preventDefault(),this.suggestions.cancelRequests(),this.menu.chooseSelectedItem(t)}},e}(),o=new n(this,e),this.data("autocomplete",o),this}}.call(this),!window.addEventListener&&function(t,e,n,i,r,o,s){t[i]=e[i]=n[i]=function(t,e){var n=this;s.unshift([n,t,e,function(t){t.currentTarget=n,t.preventDefault=function(){t.returnValue=!1},t.stopPropagation=function(){t.cancelBubble=!0},t.target=t.srcElement||n,e.call(n,t)}]),this.attachEvent("on"+t,s[0][3])},t[r]=e[r]=n[r]=function(t,e){for(var n,i=0;n=s[i];++i)if(n[0]==this&&n[1]==t&&n[2]==e)return this.detachEvent("on"+t,s.splice(i,1)[0][3])},t[o]=e[o]=n[o]=function(t){return this.fireEvent("on"+t.type,t)}}(Window.prototype,HTMLDocument.prototype,Element.prototype,"addEventListener","removeEventListener","dispatchEvent",[]),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ChooserView=function(e){function i(){return this._handleSelect=t(this._handleSelect,this),this._handleClick=t(this._handleClick,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.tagName="div",i.prototype.className="chooser-view",i.prototype.events={click:"_handleClick"},i.prototype.template=_.template('<div class="chooser-view-selection-pane">\n  <span class="chooser-view-title"><%- title %></span>\n  <i class="icon-caret-down closed"></i>\n  <i class="icon-caret-up opened"></i>\n  <div class="chooser-view-autocomplete-wrapper">\n    <i class="icon-search"></i>\n    <input type="text" name="autocomplete">\n  </div>\n</div>'),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.title=t.title,this.render(),this.inputEl=this.$el.find("input"),this.inputEl.on("click",function(t){return t.stopPropagation()}),this.inputEl.autocomplete({autoFocus:t.autoFocus,select:this._handleSelect,source:t.source,inline:!0,limit:t.limit||10,autoSelect:!0})},i.prototype.render=function(){return i.__super__.render.call(this),this.$el.html(this.template({title:this.title}))},i.prototype.setSource=function(t){return this.inputEl.data("autocomplete").setSource(t)},i.prototype.reset=function(){return this.label=void 0,this._updateTitle()},i.prototype.open=function(){return this.$el.addClass("open"),this.inputEl.val("").focus(),this._updateTitle(),document.addEventListener("click",this._handleClick,!0)},i.prototype.close=function(){return this.$el.removeClass("open"),this._updateTitle(),document.removeEventListener("click",this._handleClick,!0)},i.prototype._updateTitle=function(){return this.$el.find(".chooser-view-title").html(this.label||this.title)},i.prototype._handleClick=function(t){return t.stopPropagation(),t.target!==this.inputEl.get(0)?this.$el.hasClass("open")?this.close():this.open():void 0},i.prototype._handleSelect=function(t,e){return this.label=e.item.label||e.item,this.trigger("selected",e.item),this.close()},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.ExpertSearchTermView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.el=$(".experts-search-facets .explanation"),n.prototype.events={"submit .expert_search_form":"performSearch"},n.prototype.initialize=function(t){return this.searchTerm=t.searchTerm,n.__super__.initialize.call(this,t)},n.prototype.performSearch=function(t){return t.preventDefault(),this.searchTerm=$("#expert_search_form_term").val(),this._notifySubscribers()},n.prototype._notifySubscribers=function(){return _.defer(function(t){return function(){return publish("update:term",[t.searchTerm])}}(this))},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ExpertSearchInstitutionsFacetView=function(e){function i(){return this._institutionList=t(this._institutionList,this),this._initializeChooser=t(this._initializeChooser,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.events={"click .selection":"_removeSelection"},i.prototype.initialize=function(t){return this.selectedInstitutions=t.selectedInstitutions,this.render(),this._initializeChooser(),this._updateChooserUrl(),this._renderSelectedInstitutions(),i.__super__.initialize.call(this,t)},i.prototype.template=_.template('<div class="institutions grid-four">\n  <h3 class="double-bordered"><%= i18n.t(\'experts.label.refine_by_institution\') %></h3>\n  <div class="facet"></div>\n  <ul class="selections"></ul>\n</div>'),i.prototype.selectionTemplate=_.template("<li>\n  <a class=\"selection\" href='<%- slug %>' data-type='<%- type %>' data-id='<%- id %>'>\n    <i class=\"icon-delete\"></i> <%- label %>\n  </a>\n</li>"),i.prototype.render=function(){return this.$el.html(this.template())},i.prototype._removeSelection=function(t){var e;return t.preventDefault(),e=$(t.currentTarget),this.selectedInstitutions=_.reject(this.selectedInstitutions,function(t){return function(t){return t.id===e.data("id")}}(this)),this._updateChooserUrl(),this._renderSelectedInstitutions(),this._notifySubscribers()},i.prototype._initializeChooser=function(t){var e;return e=this.$el.find(".institutions .facet"),this.institutionChooser=new TC.ChooserView({title:"e.g. Monash University",source:this._institutionList()}),e.after(this.institutionChooser.$el),this.institutionChooser.on("selected",function(t){return function(e){return t.selectedInstitutions.push(e.institution),t._updateChooserUrl(),t._renderSelectedInstitutions(),t._notifySubscribers(),t.institutionChooser.reset()}}(this))},i.prototype._institutionList=function(){var t,e;return e="/institutions/search.json",t=_.map(this.selectedInstitutions,function(t){return function(t){return t.id}}(this)),t.length>0&&(e+="?ignored_institution_id="+t.join(",")),e},i.prototype._updateChooserUrl=function(){return this.institutionChooser.setSource(this._institutionList())},i.prototype._renderSelectedInstitutions=function(){var t;return t=this.$el.find(".institutions .selections"),t.empty(),_.each(this.selectedInstitutions,function(e){return function(n){return t.append(e.selectionTemplate({label:n.name,slug:n.slug,id:n.id,type:"institution"}))}}(this))},i.prototype._notifySubscribers=function(){return _.defer(function(t){return function(){return publish("update:institutions",[t.selectedInstitutions])}}(this))},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ExpertSearchCountriesFacetView=function(e){function i(){return this._initializeChooser=t(this._initializeChooser,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.events={"click .selection":"_removeSelection"},i.prototype.initialize=function(t){return this.allCountries=t.allCountries,this.selectedCountries=t.selectedCountries,this.render(),this._initializeChooser(),this._renderSelectedCountries(),this._updateChooserUrl(),i.__super__.initialize.call(this,t)},i.prototype.template=_.template('<div class="countries grid-four grid-last">\n  <h3 class="double-bordered"><%= i18n.t(\'experts.label.refine_by_country\') %></h3>\n  <div class="facet"></div>\n  <ul class="selections"></ul>\n</div>'),i.prototype.selectionTemplate=_.template("<li>\n  <a class=\"selection\" href='<%- slug %>' data-type='<%- type %>' data-id='<%- id %>'>\n    <i class=\"icon-delete\"></i> <%- label %>\n  </a>\n</li>"),i.prototype.render=function(){return this.$el.html(this.template())},i.prototype._removeSelection=function(t){var e;return t.preventDefault(),e=$(t.currentTarget),this.selectedCountries=_.reject(this.selectedCountries,function(t){return function(t){return t.slug===e.data("id")}}(this)),this._renderSelectedCountries(),this._updateChooserUrl(),this._notifySubscribers()},i.prototype._initializeChooser=function(t){var e;return e=this.$el.find(".countries .facet"),this.locationChooser=new TC.ChooserView({title:"e.g. Australia",autoFocus:!0,source:this._remainingCountries()}),e.after(this.locationChooser.$el),this.locationChooser.on("selected",function(t){return function(e){return t.selectedCountries.push(e),t._renderSelectedCountries(),t._updateChooserUrl(),t._notifySubscribers(),t.locationChooser.reset()}}(this))},i.prototype._updateChooserUrl=function(){return this.locationChooser.setSource(this._remainingCountries())},i.prototype._remainingCountries=function(){return _.reject(this.allCountries,function(t){return function(e){return _.any(t.selectedCountries,function(t){return t.slug===e.slug})}}(this))},i.prototype._renderSelectedCountries=function(){var t;return t=this.$el.find(".countries .selections"),t.empty(),_.each(this.selectedCountries,function(e){return function(n){return t.append(e.selectionTemplate({label:n.label,slug:n.slug,id:n.slug,type:"countries"}))}}(this))},i.prototype._notifySubscribers=function(){return _.defer(function(t){return function(){return publish("update:countries",[t.selectedCountries])}}(this))},i}(Backbone.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.ExpertSearchView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="expert-search-view",n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.render(t)},n.prototype.render=function(t){return this._renderTerm(t.on),this._renderInstitutions(t.from),this._renderCountries(t["in"],t.allCountries)},n.prototype._renderTerm=function(t){return this.searchTerm=t,this.termFacetView=new TC.ExpertSearchTermView({searchTerm:t}),this.termFacetView.appendedTo(this.el)},n.prototype._renderInstitutions=function(t){return this.selectedInstitutions=[],this.institutionsFacetView=new TC.ExpertSearchInstitutionsFacetView({selectedInstitutions:t||[]}),this.institutionsFacetView.appendedTo(this.el)},n.prototype._renderCountries=function(t,e){return this.selectedCountries=[],this.countriesFacetView=new TC.ExpertSearchCountriesFacetView({selectedCountries:t||[],allCountries:e}),this.countriesFacetView.appendedTo(this.el)},n}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ExpertsSearchPage=function(e){function i(){return this._updateResults=t(this._updateResults,this),this._prepareUrl=t(this._prepareUrl,this),this._fetchPaginatedResults=t(this._fetchPaginatedResults,this),this._updateUrl=t(this._updateUrl,this),this._update=t(this._update,this),this._activateSubscriber=t(this._activateSubscriber,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.events={"click .pagination a":"_fetchPaginatedResults"},i.prototype.initialize=function(t){var e;return i.__super__.initialize.call(this,t),this.pushstate_supported="function"==typeof window.history.pushState,this.spinner=new TC.SpinnerView({size:"30px",fixed:!0}).appendedTo($(".experts-search-facets")),this.spinner.hide(),e=new TC.ExpertSearchView(t),$(".experts-search-facets").append(e.$el),this.facets={term:t.on||"",interests:t["for"]||[],institutions:t.from||[],countries:t["in"]||[]},this._activateSubscriber("term"),this._activateSubscriber("interests"),this._activateSubscriber("institutions"),this._activateSubscriber("countries"),$(window).on("popstate",function(t){return function(e){return t._prepareUrl(window.location.href)}}(this))},i.prototype._activateSubscriber=function(t){return subscribe("update:"+t,function(e){return function(n){return e.facets[t]=n,e._update()}}(this))},i.prototype._update=function(){return this._updateUrl(),this._updateResults(window.location.href+".json")},i.prototype._updateUrl=function(){var t;return t="/experts/search",this.facets.term.length>0&&(t+="/on/"+this._toSlug(this.facets.term,"+")),this.facets.interests.length>0&&(t+=this._addFacetsToUrl("for",this.facets.interests)),this.facets.institutions.length>0&&(t+=this._addFacetsToUrl("from",this.facets.institutions)),this.facets.countries.length>0&&(t+=this._addFacetsToUrl("in",this.facets.countries)),this.pushstate_supported?history.pushState({},t,t):window.location.href(t)},i.prototype._fetchPaginatedResults=function(t){var e;return t.preventDefault(),e=$(t.currentTarget).attr("href"),this.pushstate_supported?(this._prepareUrl(e),history.pushState(null,null,e.replace(/\.json/,""))):window.location.href(e)},i.prototype._prepareUrl=function(t){return t.match(/\.json/)||(t.match(/\?/)?t=t.replace(/\?/,".json?"):t+=".json"),this._updateResults(t)},i.prototype._updateResults=function(t){var e;return this.spinner.show(),e=$(".experts-search-results"),e.addClass("searching"),$.ajax({type:"GET",url:t,dataType:"html",success:function(t){return function(n){return e.removeClass("searching"),t.spinner.hide(),e.html(n),$("html, body").animate({scrollTop:0},"fast")}}(this)})},i.prototype._addFacetsToUrl=function(t,e){return"/"+t+"/"+_.map(e,function(t){return function(t){return t.slug}}(this)).join("/")},i.prototype._toSentence=function(t){return t.join(", ").replace(/,\s([^,]+)$/," and $1")},i.prototype._deSlug=function(t){return t.split("+").join(" ")},i.prototype._toSlug=function(t,e){return t.replace(/\s/g,e).toLowerCase()},i}(TC.ExpertsPage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.InfoPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){
var e;return n.__super__.initialize.call(this,t),e=["iframe[src^='//www.youtube.com']","iframe[src^='//c15119308.ssl.cf2.rackcdn.com']","iframe[src^='https://c15119308.ssl.cf2.rackcdn.com']","iframe[src^='//maps.google.com.au/maps']","iframe[src^='//player.vimeo.com']"],$("body").fitVids({customSelector:e.join(", ")})},n}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.InstitutionPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click #tabbed-navigation a":"_clickHandheldTab"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.institutionSlug=window.location.pathname.replace("/institutions/",""),new TC.ExpertDatabaseSearchFormView({el:$("body"),institutionSlug:this.institutionSlug})},n.prototype._clickHandheldTab=function(t){var e;switch(t.preventDefault(),e=$(t.target).attr("href"),$("#tabbed-navigation a.active").removeClass("active"),$(t.target).addClass("active"),e){case"#articles":return $(".institution-page").removeClass("sm-display-contributors sm-display-jobs-and-events"),$(".institution-page").addClass("sm-display-articles");case"#contributors":return $(".institution-page").removeClass("sm-display-articles sm-display-jobs-and-events"),$(".institution-page").addClass("sm-display-contributors");case"#jobs-and-events":return $(".institution-page").removeClass("sm-display-articles sm-display-contributors"),$(".institution-page").addClass("sm-display-jobs-and-events")}},n}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.PagePage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click .social-media a.twitter":"_trackTwitter","click .social-media a.facebook":"_trackFaceBook","click .social-media a.linkedin":"_trackLinkedin","click #tabbed-navigation a":"_clickHandheldTab","click .page-layout.section article a":"_sectionArticleTracking"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.topbar.html().match("Sign out")||this._initDynamicContentForCachedPage(),this._initEngagementBar(),this._initTopbarMobileNewsletterSignup(),new TC.ExpertDatabaseSearchFormView({el:$("body")})},n.prototype._clickHandheldTab=function(t){var e;switch(t.preventDefault(),e=$(t.target).attr("href"),$("#tabbed-navigation a.active").removeClass("active"),$(t.target).addClass("active"),e){case"#analysis":return $(".page-layout.section").removeClass("handheld-display-research handheld-display-columns"),$(".page-layout.section").addClass("handheld-display-analysis");case"#research":return $(".page-layout.section").removeClass("handheld-display-analysis handheld-display-columns"),$(".page-layout.section").addClass("handheld-display-research");case"#columns":return $(".page-layout.section").removeClass("handheld-display-analysis handheld-display-research"),$(".page-layout.section").addClass("handheld-display-columns")}},n.prototype._initDynamicContentForCachedPage=function(){return $.ajax({url:$("div.statically-cached-resource").data("dynamic-content-uri"),success:function(t){return function(e){return e.csrf&&$("meta[name=csrf-token]").attr("content",e.csrf),e.topbar&&(window.innerShiv&&(e.topbar=innerShiv(e.topbar)),$("#topbar").replaceWith(e.topbar),t._initTopbarMenu()),e.masthead&&(window.innerShiv&&(e.masthead=innerShiv(e.masthead)),$("#masthead").replaceWith(e.masthead)),e.editorial_menu?$(".editorial-menu").replaceWith(e.editorial_menu):void 0}}(this)})},n.prototype._initEngagementBar=function(){var t;return this._isHomepage()&&!this._isOldIE()?(t=new TC.EngagementBarView,this.topbar.after(t.el)):void 0},n.prototype._isAU=function(){return $("body").is(".region_au")},n.prototype._isUK=function(){return $("body").is(".region_uk")},n.prototype._initTopbarMobileNewsletterSignup=function(){var t;return this._isHomepage()&&!this._isAU()?(t=new TC.TopbarMobileNewsletterSignup,this.topbar.after(t.el)):void 0},n.prototype._isHomepage=function(){return $("body").is(".pages-show-home-page")&&!$("body").is(".pages-edit")},n.prototype._isOldIE=function(){return $("html").is(".ie7, .ie8")},n.prototype._trackTwitter=function(t){return this.link=$(t.currentTarget),this._completeTracking("Social Media - clicks to our page","Twitter",link)},n.prototype._trackFaceBook=function(t){return this.link=$(t.currentTarget),this._completeTracking("Social Media - clicks to our page","Facebook",link)},n.prototype._trackLinkedin=function(t){return this.link=$(t.currentTarget),this._completeTracking("Social Media - clicks to our page","Linkedin",link)},n.prototype._completeTracking=function(t,e,n){return TC.analytics.track(t,e,n.attr("href"),1)},n.prototype._sectionArticleTracking=function(t){var e,n,i,r,o,s,a,l,c,u;return a=$(t.currentTarget),c=a.parents(".page-layout.section").first().data("name"),n=a.closest("article"),l=n.closest(".page-area, .article-section"),r=n.closest(".article-section"),o=r.attr("id"),u=("0"+($(".article-section").index(r)+1)).slice(-2),e=("0"+(r.find(".page-area").index(l)+1)).slice(-2),i=("0"+(l.find("article").index(n)+1)).slice(-2),s=""+c+"-"+u+"-"+o+"-"+e+"-"+i,this._completeTracking("Home/Section Page - Article clicks by position",s,a)},n}(TC.BasePage)}.call(this),function(){var t,e,n,i,r={}.hasOwnProperty,o=function(t,e){function n(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};TC.SignupProcess=function(){function n(){this.steps=[],this.current_step_index=0,this.steps_container=$("#form-steps"),this.build_steps(),this.attach_subscribers()}return n.prototype.serialise_to_json=function(){var t,e,n,i,r,o,s,a;for(e={},s=this.steps,r=0,o=s.length;o>r;r++){n=s[r],a=n.serialise_to_json();for(t in a)i=a[t],e[t]=i}return{author:e}},n.prototype.build_steps=function(){return this.steps.push(new i(this.steps.length)),this.steps.push(new e(this.steps.length)),this.steps.push(new t(this.steps.length))},n.prototype.has_previous_step=function(t){return t>0&&t<this.steps.length},n.prototype.previous_step=function(t){return this.has_previous_step(t)?this.steps[t-1]:!1},n.prototype.is_last_step=function(t){return t+1===this.steps.length},n.prototype.attach_subscribers=function(){return subscribe("/data-submission/from",function(t){return function(e){return $.ajax({type:"POST",url:t.is_last_step(e)?"/become-an-author":"/become-an-author?dry_run=true",data:t.serialise_to_json(),dataType:"json",success:function(n){return t.steps[e].restore_submit_button(),n.errors&&!t.steps[e].is_valid(n.errors)?t.steps[e].show_errors(n.errors):t.is_last_step(e)?document.location=n.redirect:t.steps[e].hide_errors(function(){return publish("/step-change/to",[e+1])})},error:function(){return t.steps[e].restore_submit_button()}})}}(this)),subscribe("/step-change/to",function(t){return function(e){return e>=0&&e<t.steps.length?(t.current_step_index=e,$("#form-steps").removeClass("stepped-1 stepped-2"),$("#form-steps").addClass("stepped-"+t.current_step_index)):void 0}}(this))},n}(),n=function(){function t(t){this.index=t,this.form=$($("#form-steps form")[this.index]),this.submit_button=this.form.find("input[type=submit]"),this.nav=$($("#nav-steps li")[this.index]),this.form.submit(function(t){return function(){return t.disable_submit_button(),publish("/data-submission/from",[t.index]),!1}}(this)),this.nav.click(function(t){return function(){return t.nav.hasClass("navigable")?publish("/step-change/to",[t.index]):void 0}}(this)),this.attach_subscribers()}return t.prototype.current_step=function(){return this.nav.hasClass("on")},t.prototype.nav_on=function(){return this.nav.addClass("on")},t.prototype.nav_off=function(){return this.nav.removeClass("on")},t.prototype.nav_clickable=function(){return this.nav.addClass("navigable")},t.prototype.nav_not_clickable=function(){return this.nav.removeClass("navigable")},t.prototype.disable_submit_button=function(){return this.submit_button.val("Processing ...").attr("disabled","disabled").addClass("disabled")},t.prototype.restore_submit_button=function(){return this.submit_button.val(this.submit_button.data("original-text")).removeAttr("disabled").removeClass("disabled")},t.prototype.text_field=function(t){return this.form.find(t).first().val()},t.prototype.attach_subscribers=function(){return subscribe("/step-change/to",function(t){return function(e){return e===t.index?t.nav_on():t.nav_off(),t.index<e?t.nav_clickable():t.nav_not_clickable()}}(this))},t.prototype.is_valid=function(t){var e,n,i,r,o;for(n=!0,o=this.fields,i=0,r=o.length;r>i;i++)e=o[i],null!=t[e]&&(n=!1);return n},t.prototype.show_errors=function(t){return this.hide_errors(function(e){return function(){var n,i,r,o,s,a;for(a=e.fields,o=0,s=a.length;s>o;o++)r=a[o],t[r]&&(i=$("input[name='author["+r+"]'], select[name='author["+r+"]']"),n=i.parents("fieldset").prev("aside.error"),0===n.find("ul").length&&$("<ul />").appendTo(n),i.addClass("error"),$("<li>"+t[r]+"</li>").appendTo(n.find("ul")));return e.form.find("aside.error").each(function(t,e){return $(e).find("ul").length>0?$(e).fadeIn(500):void 0})}}(this))},t.prototype.hide_errors=function(t){var e;return null==t&&(t=null),this.form.find("input.error, select.error").removeClass("error"),e=this.form.find("aside.error"),e.each(function(n,i){return $(i).fadeOut("fast",function(){return $(i).find("ul").remove(),null!=t&&n+1===e.length?t():void 0})})},t}(),i=function(t){function e(t){e.__super__.constructor.call(this,t),$("#email").keyup(function(t){return function(){return t.autodetectInstitution()}}(this))}return o(e,t),e.prototype.fields=["email","institution_name","byline_title","full_name"],e.prototype.serialise_to_json=function(){return{email:this.text_field("#email"),institution_name:this.text_field("#institution-name"),byline_title:this.text_field("#details-job-title"),full_name:this.text_field("#details-full-name")}},e.prototype.autodetectInstitution=function(){var t,e,n,i,r,o,s,a,l,c,u,h;for(i=$("#email").val().toLowerCase(),c=i.split("@"),n=c[c.length-1],r=$("#institution-name"),a=function(){var t;t=[];for(l in institutions)t.push(l);return t}(),t=function(t){return r.val(t),r.attr("disabled",!0),publish("/institution-name/change")},e=function(){return r.val(""),r.removeAttr("disabled"),publish("/institution-name/change")},o=!1,u=0,h=a.length;h>u;u++)s=a[u],n.match(s)&&(t(institutions[s]),o=!0);return o?void 0:e()},e}(n),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.fields=["education_year","education_award","education_institution"],e.prototype.serialise_to_json=function(){return{education_year:this.text_field("#education-year"),education_award:this.text_field("#education-award"),education_institution:this.text_field("#education-institution"),summary:this.text_field("#summary")}},e}(n),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.fields=["password","password_confirmation","regions"],e.prototype.serialise_to_json=function(){return{password:this.text_field("#password"),password_confirmation:this.text_field("#password-confirm"),regions:[$("#step-3 .regions select").val()]}},e}(n)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.NewRegistrationPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.signup=new TC.SignupProcess},n}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.EditPasswordPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.$("input#user_password").focus()},n}(TC.BasePage)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.EditProfilePage=function(e){function i(){return this._crop=t(this._crop,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.events={"change li.file.input input":"showPhoto","click li.choice input.other-radio-option":"chooseOther","change li.choice .other-option-label input[type=radio]":"focusOtherInput"},i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.autocompleteInstitution(),this.autocompleteJobTitle()},i.prototype.showPhoto=function(t){var e,n,i;return n=$(".avatar > img"),e=$(t.currentTarget).get(0),this._fileReaderExists()&&this._inputHasFiles(e)?(i=new FileReader,i.onload=function(t){return function(e){var i;return i=new Image,i.onload=function(e){return t._crop(n,e.currentTarget)},i.src=e.target.result}}(this),i.readAsDataURL(e.files[0])):void 0},i.prototype.chooseOther=function(t){var e,n,i;return n=$(t.currentTarget),i=n.siblings("label.other-radio-option").find("input[type=radio]"),e=$("input[name='"+i.attr("name")+"']"),e.prop("checked",!1),i.prop("checked",!0)},i.prototype.focusOtherInput=function(t){var e,n;return n=$(t.currentTarget),e=n.parent().siblings(".other-radio-option"),e.focus()},i.prototype.autocompleteInstitution=function(){var t,e;return e=$("#profile_form_institution"),t=new TC.ChooserView({title:e.data("label")||"Select an institution",source:"/institutions/search.json"}),e.after(t.$el),t.on("selected",function(t){return function(t){return e.val(t.institution.id)}}(this))},i.prototype.autocompleteJobTitle=function(){return $(".occupation.autocomplete").autocomplete({source:TC.AcademicTitles.list,minLength:2,autoFocus:!0,delay:200,select:function(t,e){return this.val(e.item)}})},i.prototype._fileReaderExists=function(){return"undefined"!=typeof FileReader},i.prototype._inputHasFiles=function(t){return t.files&&t.files[0]},i.prototype._getCroppedImageElementFor=function(t){var e,n;return e=t.parent(),n=e.find(".replacedAvatar"),n.length>0?n:(e.append("<div class='replacedAvatar'></div>"),e.find(".replacedAvatar"))},i.prototype._crop=function(t,e){var n;return n=this._getCroppedImageElementFor(t),n.hide(),n.css("background","url("+e.src+") no-repeat center center"),n.css("background-size","cover"),n.width(t.width()),n.height(t.height()),t.hide(),n.fadeIn()},i}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.ProfileCredentialsPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.initAutoComplete()},n.prototype.initAutoComplete=function(){return $(".research-code.autocomplete").autocomplete({source:"/field_of_researches.json",minLength:2,autoFocus:!0,delay:200,select:function(t,e){return t.preventDefault(),$(this).val(e.item.code)}}),$(".funding-source.autocomplete").autocomplete({source:"/funding_sources.json",minLength:2,autoFocus:!0,delay:200,select:function(t,e){return t.preventDefault(),$(this).val(e.item.label)}}),$(".credential-title.autocomplete").autocomplete({source:TC.AcademicTitles.list,minLength:2,autoFocus:!0,delay:200,select:function(t,e){return this.val(e.item)}}),$(".professional-membership.autocomplete").autocomplete({source:"/professional_memberships.json",select:function(t,e){return t.preventDefault(),$(this).val(e.item.label)}})},n}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.NewEventPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"change #event_country":"changeCountry"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t)},n.prototype.changeCountry=function(t){var e;return e=$(t.currentTarget).children("option:selected").text(),this.selected_state=this.$("#user_selected_event_state").val(),this.states=this.$("#event_state"),this.states.attr("disabled",!0),$.ajax({type:"GET",url:"/countries/"+e+"/states",dataType:"json",success:function(t){return function(e){var n,i,r,o;t.states.children("option").remove(),t.states.attr("disabled",!1),o=[];for(r in e)n=e[r],i=$("<option>").attr({value:r}).text(n.name),r===t.selected_state&&i.prop("selected",!0),o.push(i.appendTo(t.states));return o}}(this)})},n}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.NewPitchPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"submit form#new_pitch":"onSubmit","change input[type=radio]":"onChangeRadio","change #pitch_region":"onChangeRegion"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.formEl=this.$("form#new_pitch")},n.prototype.delegateEvents=function(){return n.__super__.delegateEvents.call(this),this.formEl.find("input[type=radio]:checked").trigger("change")},n.prototype.onChangeRadio=function(t){return t.target.checked?(this.formEl.find(".option-group").hide(),this.formEl.find(".as-"+t.target.value).show()):void 0},n.prototype.onChangeRegion=function(t){var e;return e=$(t.currentTarget).val(),$.ajax({url:"/pitches/pages",data:{for_region:e},dataType:"json",success:function(t){return function(t){return $("#pitch_page").html("<option></option>"),_.each(t,function(t){return $("#pitch_page").append("<option value='"+t[1]+"'>"+t[0]+"</option>")})}}(this)})},n.prototype.onSubmit=function(){return TC.analytics.track("Pitch submissions",document.location.pathname,"",1)},n}(TC.BasePage)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};TC.ListSearcher=function(){function e(e,n){this.filterList=t(this.filterList,this),this.listItems=$(e),this.searchBox=$(n),this.initEvents(),this.resetList()}return e.prototype.initEvents=function(){return this.searchBox.on("click keyup",_.debounce(this.filterList,250))},e.prototype.resetList=function(){return this.listItems.removeClass("no-match"),!1},e.prototype.filterList=function(t){var e,n;return n=$(t.target).val(),e=new RegExp(("(^|\\s)"+n).replace(/\s/,".*"),"i"),n.length<1?this.resetList():this.listItems.removeClass("no-match").filter(function(){return!e.test($(this).text())}).addClass("no-match")},e}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.TopicsPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.listSearcher=new TC.ListSearcher("#topics-index-list ol, #topics-index-list li","#filter-index")},n}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.TopicPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click #tabbed-navigation a":"_clickHandheldTab","click .expert-authors .more a":"_showMoreExperts"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this._initEngagementBar()},n.prototype._initEngagementBar=function(){var t;return this._isOldIE()?void 0:(t=new TC.EngagementBarView,this.topbar.after(t.el))},n.prototype._clickHandheldTab=function(t){var e;switch(t.preventDefault(),e=$(t.target).attr("href"),$("#tabbed-navigation a.active").removeClass("active"),$(t.target).addClass("active"),e){case"#articles":return $(".topic-page").removeClass("sm-display-contributors sm-display-links"),$(".topic-page").addClass("sm-display-articles");case"#contributors":return $(".topic-page").removeClass("sm-display-articles sm-display-links"),$(".topic-page").addClass("sm-display-contributors");case"#links":return $(".topic-page").removeClass("sm-display-articles sm-display-contributors"),$(".topic-page").addClass("sm-display-links")}},n.prototype._showMoreExperts=function(t){return t.preventDefault(),$(".expert-authors").addClass("show-all")},n.prototype._isOldIE=function(){return $("html").is(".ie7, .ie8")},n}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.AuthorCommunication=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.urlRoot="/author_communications",n}(Backbone.Model)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.ContactAuthorFormView=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="contact-author lightbox clearfix",n.prototype.events={"click footer a[data-action=cancel-attributions]":"_leave","click a.submit":"_contactAuthor"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.author=t.author,this.currentUser=t.currentUser,this.availableFor=t.availableFor,this.render(),this.emailEl=$("input[type=text]",this.el),_.defer(function(t){return function(){return t.emailEl.focus()}}(this))},n.prototype.render=function(){return $(this.innerEl).html(this.template({author:this.author,currentUser:this.currentUser,reasons:this.availableFor})),n.__super__.render.call(this)},n.prototype.template=_.template('<div id="contact-author">\n  <h1 class="page-header"><%- i18n.t(\'author_communication.label.contact_author\') %></h1>\n\n  <form class="formtastic newform">\n    <fieldset class="inputs">\n      <ol>\n        <input id="to_author_id" type="hidden" name="to_author_id" value="<%- author.get("id") %>">\n\n        <li class="from_name string input">\n          <label for="from_name">\n            <%- i18n.t(\'author_communication.label.your_name\') %>\n          </label>\n\n          <input\n            id="from_name"\n            name="from_name"\n            type="text"\n            autocomplete="off"\n            placeholder="<%- i18n.t(\'author_communication.placeholders.your_full_name\') %>"\n            value="<%- currentUser.get("full_name") %>"\n          >\n        </li>\n\n        <li class="from_email string input">\n          <label for="from_email">\n            <%- i18n.t(\'author_communication.label.your_email\') %>\n          </label>\n\n          <input\n            id="from_email"\n            name="from_email"\n            type="email"\n            autocomplete="off"\n            placeholder="<%- i18n.t(\'author_communication.placeholders.your_email_address\') %>"\n            value="<%- currentUser.get("email") %>"\n          >\n        </li>\n\n        <li class="reason-for-contacting select input">\n          <label for="reason">\n            <%- i18n.t(\'author_communication.label.reason_for_contacting\') %>\n          </label>\n\n          <select name="reason">\n            <% _.each(reasons, function(reason) {%>\n              <option value="<%- reason[\'slug\'] %>"><%- reason[\'label\'] %></option>\n            <% }); %>\n          </select>\n        </li>\n\n        <li class="required text input">\n          <label for="message">\n            <%- i18n.t(\'author_communication.label.your_message\') %>\n          </label>\n\n          <textarea\n            id="message"\n            name="message"\n            rows="12"\n            placeholder="<%- i18n.t(\'author_communication.placeholders.your_message\') %>"\n          ></textarea>\n        </li>\n      </ol>\n    </fieldset>\n  </form>\n</div>\n\n<footer class="button-row">\n  <a data-action="cancel-attributions" class="button secondary" href="#">\n      <%- i18n.t(\'author_communication.button.close\') %>\n    </a>\n\n  <a class="submit button primary" href="#">\n      <%- i18n.t(\'author_communication.button.contact\') %>\n    </a>\n</footer>'),n.prototype._attributesFromForm=function(){return _.object(_.map(this.$el.find("form").serializeArray(),function(t){var e,n;return e=t.name,n=t.value,[e,n]}))},n.prototype._contactAuthor=function(t){return t.preventDefault(),this.communique=new TC.AuthorCommunication,this.communique.save(this._attributesFromForm(),{wait:!0,success:function(t){return function(e,n,i){return $.flash("notice",i18n.t("author_communication.messages.success")),t._leave()}}(this),error:function(t){return function(e,n,i){return n.responseJSON&&n.responseJSON.errors&&t._displayErrors(n.responseJSON.errors),$.flash("alert",i18n.t("author_communication.messages.error"))}}(this)})},n.prototype._displayErrors=function(t){return this.$el.find("li.error").removeClass("error"),this.$el.find(".inline-errors").remove(),_.each(_.keys(t),function(e){var n;return n=$("#"+e),n.parents("li").addClass("error"),n.after("<p class='inline-errors'>"+t[e].join(", ")+"</p>")})},n}(TC.SuperLightboxView)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ContactAuthorView=function(e){function i(){return this._contactAuthor=t(this._contactAuthor,this),this._userNotSignedIn=t(this._userNotSignedIn,this),this._userBannedFromContactingAuthors=t(this._userBannedFromContactingAuthors,this),this.render=t(this.render,this),this.initialize=t(this.initialize,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.events={"click .profile-contact-button.signed-in":"_contactAuthor"},i.prototype._contactButtonTemplate=_.template('<a class="profile-contact-button signed-in button primary pretty-big" href="#">\n  <%- i18n.t(\'author_communication.button.contact\') %>\n</a>'),i.prototype._signUpToContactButtonTemplate=_.template('<a\n  class="profile-contact-button sign-up-required button primary pretty-big"\n  href="/sign_in?return_to='+window.location.pathname+"\"\n>\n  <%- i18n.t('author_communication.button.sign_in_to_contact') %>\n</a>"),i.prototype.initialize=function(t){return i.__super__.initialize.call(this,t),this.user=t.user,this.currentUser=t.currentUser,this.contactable=t.contactable,this.availableFor=t.availableFor,this.render()},i.prototype.render=function(){switch(!1){case!!this.contactable:break;case!this._userNotSignedIn():this.$el.prepend(this._signUpToContactButtonTemplate());break;case!this._userBannedFromContactingAuthors():break;default:this.$el.prepend(this._contactButtonTemplate())}return i.__super__.render.call(this)},i.prototype._userBannedFromContactingAuthors=function(){return!this.currentUser.get("allowed_to_contact_authors")},i.prototype._userNotSignedIn=function(){return $.isEmptyObject(this.currentUser.attributes)},i.prototype._contactAuthor=function(t){return t.preventDefault(),new TC.ContactAuthorFormView({author:this.user,currentUser:this.currentUser,availableFor:this.availableFor}).appendedTo(document.body)},i}(Backbone.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.ProfilePage=function(e){function i(){return this._renderContactAuthor=t(this._renderContactAuthor,this),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.prototype.initialize=function(t){return this.user=new TC.User(t.user),this.currentUser=new TC.User(t.currentUser),this.contactable=t.contactable,this.availableFor=t.availableFor,this.user.isAuthor()&&this._renderContactAuthor(),i.__super__.initialize.call(this,t)},i.prototype._renderContactAuthor=function(){var t;return t=new TC.ContactAuthorView({user:this.user,currentUser:this.currentUser,contactable:this.contactable,availableFor:this.availableFor,el:this.$el.find(".profile-user-details")}),this.$el.find(".profile-user-details").prepend(t.el)},i}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.PodcastsPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"change #podcast-sort":"changeSort"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t)},n.prototype.changeSort=function(){var t,e;return e=$("#podcast-sort").val(),t=document.location.pathname+("?sort="+e),document.location.href=t},n}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.SearchPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.showSideBar()},n.prototype.events={"change #search-sidebar li input[type=radio]":"onClickFacet"},n.prototype.onClickFacet=function(t){return $(t.currentTarget).parent().siblings().removeClass("checked"),$(t.currentTarget).parent().addClass("checked"),"custom"!==$(t.currentTarget).attr("value")?($("#search-results").fadeTo(250,.25),$("#search_form").submit()):void 0},n.prototype.showSideBar=function(){return $("#search-sidebar ul.filter-group > li").fadeIn()},n}(TC.BasePage)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};TC.NewsletterSignupPage=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click #newsletter-archive .button":"showMore"},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t)},n.prototype.showMore=function(){return $("#newsletter-archive .hidden").show(),$("#newsletter-archive .button").hide()},n}(TC.BasePage)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};TC.Chart=function(){function e(e,n){this.redraw=t(this.redraw,this),this.chart_options={colors:["#BD1348","#ED7E01","#D9CA3A","#35A67C","#1F7196"],tooltip:{enabled:!0,backgroundColor:"transparent",borderRadius:2,borderWidth:0,shadow:!1,style:{fontSize:"11px",color:"#FFFFFF"}},legend:{enabled:!1},chart:{backgroundColor:null,spacingTop:0,spacingRight:0,spacingBottom:0,spacingLeft:0,renderTo:e,shadow:!1,style:{fontFamily:'"Helvetica Neue", helvetica, arial, sans-serif',color:"#000000"}},credits:{enabled:!1}},n=_.extend(this.chart_options,n),this.target=e,this.chart=new Highcharts.Chart(n)}return e.prototype.redraw=function(){return this.chart.redraw()},e}(),TC.PieChart=function(t){function e(t,n){this.chart_options={legend:{enabled:!0,layout:"vertical",align:"center",verticalAlign:"bottom",borderColor:"#ACB5BA",borderRadius:2},tooltip:{enabled:!0,backgroundColor:"#333333",borderRadius:2,borderWidth:0,shadow:!1,formatter:function(){return"<b>"+Highcharts.numberFormat(this.percentage,1)+"%</b><br>"+this.y},style:{fontSize:"11px",color:"#FFFFFF"
}},plotOptions:{pie:{shadow:!1,allowPointSelect:!1,cursor:"pointer",showInLegend:!0,dataLabels:{enabled:!1,formatter:function(){return"<b>"+this.point.name+"</b> "+Highcharts.numberFormat(this.percentage,1)+"%"}}}}},n=_.extend(this.chart_options,n),e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.replaceSeries=function(t){return this.chart.series[0].setData(t)},e}(TC.Chart),TC.SplineChart=function(t){function e(t,n){this.chart_options={plotOptions:{spline:{lineWidth:1,states:{hover:{enabled:!1}},marker:{enabled:!1}}},tooltip:{enabled:!0,backgroundColor:"#333333",borderRadius:2,borderWidth:0,shadow:!1,formatter:function(){return""+Highcharts.dateFormat("%e %b %Y",this.x)+"<br/><b>"+this.y+"</b>"},style:{fontSize:"11px",color:"#FFFFFF"}},chart:{backgroundColor:null,type:"spline",renderTo:t,spacingTop:20,spacingRight:20,spacingBottom:20,spacingLeft:0}},n=_.extend(this.chart_options,n),e.__super__.constructor.apply(this,arguments)}return n(e,t),e}(TC.Chart),TC.GeographicalViewsChart=function(t){function e(t,n){this.chart_options={title:{text:"",style:{fontFamily:'"Helvetica Neue", helvetica, arial, sans-serif',fontSize:"14px",color:"#000000"}},series:[{name:"Location"}]},n=_.extend(this.chart_options,n),e.__super__.constructor.apply(this,arguments)}return n(e,t),e}(TC.PieChart),TC.StatisticsPieChart=function(t){function e(t,n){this.chart_options={colors:["#EAEAEA","#CCCCCC","#ADADAD","#8F8F8F","#707070","#525252","#333333"],tooltip:{formatter:function(){return"<b>"+this.point.name+"</b> ("+this.y+"%)"}},legend:{useHTML:!0,borderColor:"white",layout:"vertical",labelFormatter:function(){return"<b>"+this.name+"</b> ("+this.y+"%)"},style:{color:"#666666",font:'10px "Helvetica Neue", helvetica, arial, sans-serif'}},plotOptions:{pie:{allowPointSelect:!0,startAngle:38,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}}},n=_.extend(this.chart_options,n),e.__super__.constructor.apply(this,arguments)}return n(e,t),e}(TC.PieChart),TC.ArticleViewsChart=function(t){function e(t,n){this.chart_options={title:{text:"",style:{fontFamily:'"Helvetica Neue", helvetica, arial, sans-serif',fontSize:"14px",color:"#000000"}},xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%e. %b"},tickInterval:2===n.series[0].data.length?864e5:null,minTickInterval:864e5},yAxis:{min:0,title:{text:null}},series:[{name:"Readers",data:[1,10,40,80]}]},n=_.extend(this.chart_options,n),e.__super__.constructor.apply(this,arguments)}return n(e,t),e}(TC.SplineChart)}.call(this);